<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>osgEarth: anonymous_namespace{TextureCompositorMulti.cpp} Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">osgEarth&#160;<span id="projectnumber">2.1.1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Namespace&#160;List</span></a></li>
      <li><a href="namespacemembers.html"><span>Namespace&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>anonymous_namespace{TextureCompositorMulti.cpp} Namespace Reference</h1>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static osg::Shader *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a6eef5408e3e880b71eee8805377cf40b">s_createTextureVertexShader</a> (const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;layout, bool blending)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static osg::Shader *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#ad9d5f9bf6a00c1663a6c452815cf5508">s_createTextureFragShaderFunction</a> (const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;layout, int maxSlots, bool blending, float fadeInDuration)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a4d275306e92ddf2acc33ad07460c3c4a">makeSamplerName</a> (int slot)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static osg::Texture2D *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a1d1f12df27e645590ff9f84e17aff758">s_getTexture</a> (osg::StateSet *stateSet, <a class="el" href="namespaceosgEarth.html#afc79b9a35ed940aaee797fde114b9801">UID</a> layerUID, const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;layout, osg::StateSet *parentStateSet)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a4d275306e92ddf2acc33ad07460c3c4a"></a><!-- doxytag: member="anonymous_namespace{TextureCompositorMulti.cpp}::makeSamplerName" ref="a4d275306e92ddf2acc33ad07460c3c4a" args="(int slot)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static std::string anonymous_namespace{TextureCompositorMulti.cpp}::makeSamplerName </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slot</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="TextureCompositorMulti_8cpp_source.html#l00188">188</a> of file <a class="el" href="TextureCompositorMulti_8cpp_source.html">TextureCompositorMulti.cpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        std::stringstream buf;
        buf &lt;&lt; <span class="stringliteral">&quot;tex&quot;</span> &lt;&lt; slot;
        <span class="keywordflow">return</span> buf.str();
    }
</pre></div>
<p><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a4d275306e92ddf2acc33ad07460c3c4a_icgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a4d275306e92ddf2acc33ad07460c3c4a_icgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a4d275306e92ddf2acc33ad07460c3c4a_icgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a4d275306e92ddf2acc33ad07460c3c4a_icgraph">
<area shape="rect" id="node3" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a1d1f12df27e645590ff9f84e17aff758" title="anonymous_namespace\{TextureCompositorMulti::cpp\}::s_getTexture" alt="" coords="519,5,940,35"/><area shape="rect" id="node5" href="classosgEarth_1_1TextureCompositorMultiTexture.html#a5977d8111dd985bc6d7466c4181970b0" title="osgEarth::TextureCompositorMultiTexture::applyLayerUpdate" alt="" coords="989,5,1368,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad9d5f9bf6a00c1663a6c452815cf5508"></a><!-- doxytag: member="anonymous_namespace{TextureCompositorMulti.cpp}::s_createTextureFragShaderFunction" ref="ad9d5f9bf6a00c1663a6c452815cf5508" args="(const TextureLayout &amp;layout, int maxSlots, bool blending, float fadeInDuration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static osg::Shader* anonymous_namespace{TextureCompositorMulti.cpp}::s_createTextureFragShaderFunction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;&#160;</td>
          <td class="paramname"><em>layout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxSlots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>blending</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fadeInDuration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="TextureCompositorMulti_8cpp_source.html#l00082">82</a> of file <a class="el" href="TextureCompositorMulti_8cpp_source.html">TextureCompositorMulti.cpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keyword">const</span> <a class="code" href="classosgEarth_1_1TextureLayout.html#a9e859aeb042980571db289d9fe7248c8">TextureLayout::RenderOrderVector</a>&amp; order = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#ad5425cbe91672e29c0d93ecc88c27683">getRenderOrder</a>();

        std::stringstream buf;

        buf &lt;&lt; <span class="stringliteral">&quot;#version 120 \n&quot;</span>;

        <span class="keywordflow">if</span> ( blending )
        {
            buf &lt;&lt; <span class="stringliteral">&quot;#extension GL_ARB_shader_texture_lod : enable \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_SlotStamp[&quot;</span> &lt;&lt; maxSlots &lt;&lt; <span class="stringliteral">&quot;]; \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;uniform float osg_FrameTime; \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_LODRangeFactor; \n&quot;</span>;
        }

        buf &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_ImageLayerOpacity[&quot;</span> &lt;&lt; maxSlots &lt;&lt; <span class="stringliteral">&quot;]; \n&quot;</span>
            <span class="comment">//The enabled array is a fixed size.  Make sure this corresponds to the size definition in TerrainEngineNode.cpp</span>
            &lt;&lt; <span class="stringliteral">&quot;uniform bool  osgearth_ImageLayerEnabled[&quot;</span> &lt;&lt; 16 &lt;&lt; <span class="stringliteral">&quot;]; \n&quot;</span>  
            &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_ImageLayerRange[&quot;</span> &lt;&lt; 2 * maxSlots &lt;&lt; <span class="stringliteral">&quot;]; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_ImageLayerAttenuation; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;uniform float osgearth_CameraElevation; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;varying float osgearth_CameraRange; \n&quot;</span>;

        <span class="keyword">const</span> <a class="code" href="classosgEarth_1_1TextureLayout.html#a3e709d0e3fdf259d3f10effa27348076">TextureLayout::TextureSlotVector</a>&amp; slots = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#a6c7d8cebeb4b2b77ed8e9610001e0b09">getTextureSlots</a>();

        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; maxSlots &amp;&amp; i &lt; (int)slots.size(); ++i )
        {
            <span class="keywordflow">if</span> ( slots[i] &gt;= 0 )
            {
                buf &lt;&lt; <span class="stringliteral">&quot;uniform sampler2D tex&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
            }
        }

        buf &lt;&lt; <span class="stringliteral">&quot;void osgearth_frag_applyTexturing( inout vec4 color ) \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;{ \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    vec3 color3 = color.rgb; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    vec4 texel; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    float maxOpacity = 0.0; \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    float dmin, dmax, atten_min, atten_max, age; \n&quot;</span>;           

        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; order.size(); ++i )
        {
            <span class="keywordtype">int</span> slot = order[i];
            <span class="keywordtype">int</span> q = 2 * i;

            <span class="comment">// if this UID has a secondyar slot, LOD blending ON.</span>
            <span class="keywordtype">int</span> secondarySlot = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f">getSlot</a>( slots[slot], 1, maxSlots );

            buf &lt;&lt; <span class="stringliteral">&quot;    if (osgearth_ImageLayerEnabled[&quot;</span>&lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;]) { \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;        dmin = osgearth_CameraElevation - osgearth_ImageLayerRange[&quot;</span>&lt;&lt; q &lt;&lt; <span class="stringliteral">&quot;]; \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;        dmax = osgearth_CameraElevation - osgearth_ImageLayerRange[&quot;</span>&lt;&lt; q+1 &lt;&lt;<span class="stringliteral">&quot;]; \n&quot;</span>

                &lt;&lt; <span class="stringliteral">&quot;        if (dmin &gt;= 0 &amp;&amp; dmax &lt;= 0.0) { \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;            atten_max = -clamp( dmax, -osgearth_ImageLayerAttenuation, 0 ) / osgearth_ImageLayerAttenuation; \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;            atten_min =  clamp( dmin, 0, osgearth_ImageLayerAttenuation ) / osgearth_ImageLayerAttenuation; \n&quot;</span>;

            <span class="keywordflow">if</span> ( secondarySlot &gt;= 0 ) <span class="comment">// LOD blending enabled for this layer</span>
            {
                <span class="keywordtype">float</span> invFadeInDuration = 1.0f/fadeInDuration;

                buf &lt;&lt; <span class="stringliteral">&quot;            age = &quot;</span>&lt;&lt; invFadeInDuration &lt;&lt; <span class="stringliteral">&quot; * min( &quot;</span>&lt;&lt; fadeInDuration &lt;&lt; <span class="stringliteral">&quot;, osg_FrameTime - osgearth_SlotStamp[&quot;</span> &lt;&lt; slot &lt;&lt; <span class="stringliteral">&quot;] ); \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            age = clamp(age, 0.0, 1.0); \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            vec4 texel0 = texture2D(tex&quot;</span> &lt;&lt; slot &lt;&lt; <span class="stringliteral">&quot;, gl_TexCoord[&quot;</span>&lt;&lt; slot &lt;&lt; <span class="stringliteral">&quot;].st);\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            vec4 texel1 = texture2D(tex&quot;</span> &lt;&lt; secondarySlot &lt;&lt; <span class="stringliteral">&quot;, gl_TexCoord[&quot;</span>&lt;&lt; secondarySlot &lt;&lt; <span class="stringliteral">&quot;].st);\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            float mixval = age * osgearth_LODRangeFactor;\n&quot;</span>

                    <span class="comment">// pre-multiply alpha before mixing:</span>
                    &lt;&lt; <span class="stringliteral">&quot;            texel0.rgb *= texel0.a; \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            texel1.rgb *= texel1.a; \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            texel = mix(texel1, texel0, mixval); \n&quot;</span>

                    <span class="comment">// revert to non-pre-multiplies alpha (assumes openGL state uses non-pre-mult alpha)</span>
                    &lt;&lt; <span class="stringliteral">&quot;            if (texel.a &gt; 0.0) { \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;                texel.rgb /= texel.a; \n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;            } \n&quot;</span>;
            }
            <span class="keywordflow">else</span>
            {
                buf &lt;&lt; <span class="stringliteral">&quot;            texel = texture2D(tex&quot;</span> &lt;&lt; slot &lt;&lt; <span class="stringliteral">&quot;, gl_TexCoord[&quot;</span>&lt;&lt; slot &lt;&lt;<span class="stringliteral">&quot;].st); \n&quot;</span>;
            }
            
            buf &lt;&lt; <span class="stringliteral">&quot;            float opacity =  texel.a * osgearth_ImageLayerOpacity[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;];\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;            color3 = mix(color3, texel.rgb, opacity * atten_max * atten_min); \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;            if (opacity &gt; maxOpacity) {\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;              maxOpacity = opacity;\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;            }\n&quot;</span>                
                &lt;&lt; <span class="stringliteral">&quot;        } \n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;    } \n&quot;</span>;
        }
        
            buf &lt;&lt; <span class="stringliteral">&quot;    color = vec4(color3, maxOpacity);\n&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;} \n&quot;</span>;



        std::string str = buf.str();
        <span class="comment">//OE_INFO &lt;&lt; std::endl &lt;&lt; str;</span>
        <span class="keywordflow">return</span> <span class="keyword">new</span> osg::Shader( osg::Shader::FRAGMENT, str );
    }
</pre></div>
<p><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_cgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_cgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_cgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_cgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureLayout.html#ad5425cbe91672e29c0d93ecc88c27683" title="osgEarth::TextureLayout::getRenderOrder" alt="" coords="615,5,879,35"/><area shape="rect" id="node5" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f" title="osgEarth::TextureLayout::getSlot" alt="" coords="640,59,853,88"/><area shape="rect" id="node7" href="classosgEarth_1_1TextureLayout.html#a6c7d8cebeb4b2b77ed8e9610001e0b09" title="osgEarth::TextureLayout::getTextureSlots" alt="" coords="615,112,879,141"/></map>
</div>
</p>

<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_icgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_icgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_icgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_ad9d5f9bf6a00c1663a6c452815cf5508_icgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureCompositorMultiTexture.html#a09f36589d31ae7d0a274186a0c76dbb9" title="osgEarth::TextureCompositorMultiTexture::updateMasterStateSet" alt="" coords="613,5,1016,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6eef5408e3e880b71eee8805377cf40b"></a><!-- doxytag: member="anonymous_namespace{TextureCompositorMulti.cpp}::s_createTextureVertexShader" ref="a6eef5408e3e880b71eee8805377cf40b" args="(const TextureLayout &amp;layout, bool blending)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static osg::Shader* anonymous_namespace{TextureCompositorMulti.cpp}::s_createTextureVertexShader </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;&#160;</td>
          <td class="paramname"><em>layout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>blending</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="TextureCompositorMulti_8cpp_source.html#l00038">38</a> of file <a class="el" href="TextureCompositorMulti_8cpp_source.html">TextureCompositorMulti.cpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        std::stringstream buf;
       
        <span class="keyword">const</span> <a class="code" href="classosgEarth_1_1TextureLayout.html#a3e709d0e3fdf259d3f10effa27348076">TextureLayout::TextureSlotVector</a>&amp; slots = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#a6c7d8cebeb4b2b77ed8e9610001e0b09">getTextureSlots</a>();

        <span class="keywordflow">if</span> ( blending )
        {
            buf &lt;&lt; <span class="stringliteral">&quot;uniform mat4 osgearth_TexBlendMatrix[&quot;</span> &lt;&lt; slots.size() &lt;&lt; <span class="stringliteral">&quot;];\n&quot;</span>;
        }

        buf &lt;&lt; <span class="stringliteral">&quot;void osgearth_vert_setupTexturing() \n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;{ \n&quot;</span>;

        <span class="comment">// Set up the texture coordinates for each active slot (primary and secondary).</span>
        <span class="comment">// Primary slots are the actual image layer&#39;s texture image unit. A Secondary</span>
        <span class="comment">// slot is what an image layer uses for LOD blending, and is set on a per-layer basis.</span>
        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> slot = 0; slot &lt; (int)slots.size(); ++slot )
        {
            <span class="keywordflow">if</span> ( slots[slot] &gt;= 0 )
            {
                <a class="code" href="namespaceosgEarth.html#afc79b9a35ed940aaee797fde114b9801">UID</a> uid = slots[slot];
                <span class="keywordtype">int</span> primarySlot = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f">getSlot</a>(uid, 0);

                <span class="keywordflow">if</span> ( slot == primarySlot )
                {
                    <span class="comment">// normal unit:</span>
                    buf &lt;&lt; <span class="stringliteral">&quot;    gl_TexCoord[&quot;</span>&lt;&lt; slot &lt;&lt;<span class="stringliteral">&quot;] = gl_MultiTexCoord&quot;</span> &lt;&lt; slot &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
                }
                <span class="keywordflow">else</span>
                {
                    <span class="comment">// secondary (blending) unit:</span>
                    buf &lt;&lt; <span class="stringliteral">&quot;    gl_TexCoord[&quot;</span>&lt;&lt; slot &lt;&lt;<span class="stringliteral">&quot;] = osgearth_TexBlendMatrix[&quot;</span>&lt;&lt; primarySlot &lt;&lt; <span class="stringliteral">&quot;] * gl_MultiTexCoord&quot;</span> &lt;&lt; primarySlot &lt;&lt; <span class="stringliteral">&quot;;\n&quot;</span>;
                }
            }
        }
            
        buf &lt;&lt; <span class="stringliteral">&quot;} \n&quot;</span>;

        std::string str = buf.str();
        <span class="keywordflow">return</span> <span class="keyword">new</span> osg::Shader( osg::Shader::VERTEX, str );
    }
</pre></div>
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_cgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_cgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_cgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_cgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f" title="osgEarth::TextureLayout::getSlot" alt="" coords="600,5,813,35"/><area shape="rect" id="node5" href="classosgEarth_1_1TextureLayout.html#a6c7d8cebeb4b2b77ed8e9610001e0b09" title="osgEarth::TextureLayout::getTextureSlots" alt="" coords="575,59,839,88"/></map>
</div>
</p>

<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_icgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_icgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_icgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a6eef5408e3e880b71eee8805377cf40b_icgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureCompositorMultiTexture.html#a09f36589d31ae7d0a274186a0c76dbb9" title="osgEarth::TextureCompositorMultiTexture::updateMasterStateSet" alt="" coords="573,5,976,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1d1f12df27e645590ff9f84e17aff758"></a><!-- doxytag: member="anonymous_namespace{TextureCompositorMulti.cpp}::s_getTexture" ref="a1d1f12df27e645590ff9f84e17aff758" args="(osg::StateSet *stateSet, UID layerUID, const TextureLayout &amp;layout, osg::StateSet *parentStateSet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static osg::Texture2D* anonymous_namespace{TextureCompositorMulti.cpp}::s_getTexture </td>
          <td>(</td>
          <td class="paramtype">osg::StateSet *&#160;</td>
          <td class="paramname"><em>stateSet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceosgEarth.html#afc79b9a35ed940aaee797fde114b9801">UID</a>&#160;</td>
          <td class="paramname"><em>layerUID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classosgEarth_1_1TextureLayout.html">TextureLayout</a> &amp;&#160;</td>
          <td class="paramname"><em>layout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osg::StateSet *&#160;</td>
          <td class="paramname"><em>parentStateSet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="TextureCompositorMulti_8cpp_source.html#l00196">196</a> of file <a class="el" href="TextureCompositorMulti_8cpp_source.html">TextureCompositorMulti.cpp</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordtype">int</span> slot = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f">getSlot</a>( layerUID, 0 );
        <span class="keywordflow">if</span> ( slot &lt; 0 )
            <span class="keywordflow">return</span> 0L;

        osg::Texture2D* tex = <span class="keyword">static_cast&lt;</span>osg::Texture2D*<span class="keyword">&gt;</span>(
            stateSet-&gt;getTextureAttribute( slot, osg::StateAttribute::TEXTURE ) );

        <span class="keywordflow">if</span> ( !tex )
        {
            tex = <span class="keyword">new</span> osg::Texture2D();

            <span class="comment">// configure the mipmapping</span>

            tex-&gt;setMaxAnisotropy( 16.0f );

            tex-&gt;setResizeNonPowerOfTwoHint(<span class="keyword">false</span>);
            tex-&gt;setFilter( osg::Texture::MAG_FILTER, osg::Texture::LINEAR );
            tex-&gt;setFilter( osg::Texture::MIN_FILTER, osg::Texture::LINEAR_MIPMAP_LINEAR );

            <span class="comment">// configure the wrapping</span>
            tex-&gt;setWrap( osg::Texture::WRAP_S, osg::Texture::CLAMP_TO_EDGE );
            tex-&gt;setWrap( osg::Texture::WRAP_T, osg::Texture::CLAMP_TO_EDGE );

            stateSet-&gt;setTextureAttributeAndModes( slot, tex, osg::StateAttribute::ON );
            
            <span class="comment">// install the slot attribute</span>
            std::string name = <a class="code" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a4d275306e92ddf2acc33ad07460c3c4a">makeSamplerName</a>(slot);
            stateSet-&gt;getOrCreateUniform( name.c_str(), osg::Uniform::SAMPLER_2D )-&gt;<span class="keyword">set</span>( slot );
        }

        <span class="comment">// see if we need an LOD blending secondary texture:</span>
        <span class="keywordtype">int</span> secondarySlot = layout.<a class="code" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f">getSlot</a>( layerUID, 1 );
        <span class="keywordflow">if</span> ( secondarySlot &gt;= 0 )
        {
            osg::Texture2D* parentTex = 0;

            <span class="comment">//int parentSlot = slot + layout.getRenderOrder().size();</span>
            std::string parentSampler = <a class="code" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a4d275306e92ddf2acc33ad07460c3c4a">makeSamplerName</a>( secondarySlot );
            <span class="keywordflow">if</span> (parentStateSet)
            {
                parentTex = <span class="keyword">static_cast&lt;</span>osg::Texture2D*<span class="keyword">&gt;</span>(
                    parentStateSet-&gt;getTextureAttribute( slot, osg::StateAttribute::TEXTURE ) );

                <span class="keywordflow">if</span> (parentTex)
                {
                    stateSet-&gt;setTextureAttributeAndModes(secondarySlot, parentTex, osg::StateAttribute::ON );
                    stateSet-&gt;getOrCreateUniform(parentSampler.c_str(),
                                                 osg::Uniform::SAMPLER_2D )-&gt;<span class="keyword">set</span>( secondarySlot );
                }
            }

            <span class="keywordflow">if</span> ( !parentTex )
            {
                <span class="comment">// Bind the main texture as the secondary texture and</span>
                <span class="comment">// set the scaling factors appropriately.</span>
                stateSet-&gt;getOrCreateUniform(
                    parentSampler.c_str(), osg::Uniform::SAMPLER_2D)-&gt;<span class="keyword">set</span>(slot);
            }

        }
        <span class="keywordflow">return</span> tex;
    }
</pre></div>
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_cgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_cgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_cgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_cgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureLayout.html#ad47e758523f496ca5cf4af789e87b42f" title="osgEarth::TextureLayout::getSlot" alt="" coords="603,5,816,35"/><area shape="rect" id="node5" href="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03.html#a4d275306e92ddf2acc33ad07460c3c4a" title="anonymous_namespace\{TextureCompositorMulti::cpp\}::makeSamplerName" alt="" coords="479,59,940,88"/></map>
</div>
</p>

<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_icgraph.png" border="0" usemap="#namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_icgraph" alt=""/></div>
<map name="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_icgraph" id="namespaceanonymous__namespace_02TextureCompositorMulti_8cpp_03_a1d1f12df27e645590ff9f84e17aff758_icgraph">
<area shape="rect" id="node3" href="classosgEarth_1_1TextureCompositorMultiTexture.html#a5977d8111dd985bc6d7466c4181970b0" title="osgEarth::TextureCompositorMultiTexture::applyLayerUpdate" alt="" coords="477,5,856,35"/></map>
</div>
</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jan 18 2012 15:02:49 for osgEarth by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
