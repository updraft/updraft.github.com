<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>osgEarth: /home/cube/sources/osgearth/src/osgEarthSymbology/AGG.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">osgEarth&#160;<span id="projectnumber">2.1.1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/home/cube/sources/osgearth/src/osgEarthSymbology/AGG.h</h1>  </div>
</div>
<div class="contents">
<a href="AGG_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// Anti-Grain Geometry - Version 2.1 Lite </span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (C) 2002-2003 Maxim Shemanarev (McSeem)</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Permission to copy, use, modify, sell and distribute this software </span>
<a name="l00006"></a>00006 <span class="comment">// is granted provided this copyright notice appears in all copies. </span>
<a name="l00007"></a>00007 <span class="comment">// This software is provided &quot;as is&quot; without express or implied</span>
<a name="l00008"></a>00008 <span class="comment">// warranty, and with no claim as to its suitability for any purpose.</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">// The author gratefully acknowleges the support of David Turner, </span>
<a name="l00011"></a>00011 <span class="comment">// Robert Wilhelm, and Werner Lemberg - the authors of the FreeType </span>
<a name="l00012"></a>00012 <span class="comment">// libray - in producing this work. See http://www.freetype.org for details.</span>
<a name="l00013"></a>00013 <span class="comment">//</span>
<a name="l00014"></a>00014 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00015"></a>00015 <span class="comment">// Contact: mcseem@antigrain.com</span>
<a name="l00016"></a>00016 <span class="comment">//          mcseemagg@yahoo.com</span>
<a name="l00017"></a>00017 <span class="comment">//          http://www.antigrain.com</span>
<a name="l00018"></a>00018 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef AGGLITE_H</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define AGGLITE_H</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;memory.h&gt;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a><a class="code" href="namespaceagg.html">00024</a> <span class="keyword">namespace </span>agg
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00027"></a><a class="code" href="namespaceagg.html#a91093d761d680b30771e37f11b79f18c">00027</a>     <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span>    <a class="code" href="namespaceagg.html#a91093d761d680b30771e37f11b79f18c">int8</a>;
<a name="l00028"></a><a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">00028</a>     <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>;
<a name="l00029"></a><a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">00029</a>     <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">short</span>   <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a>;
<a name="l00030"></a><a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">00030</a>     <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>;
<a name="l00031"></a><a class="code" href="namespaceagg.html#abf9e5c4c523f022d83c0ab6cd42d4af6">00031</a>     <span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span>     <a class="code" href="namespaceagg.html#abf9e5c4c523f022d83c0ab6cd42d4af6">int32</a>;
<a name="l00032"></a><a class="code" href="namespaceagg.html#ac6e1336dc2f5f3f059bee48e8c55c242">00032</a>     <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   <a class="code" href="namespaceagg.html#ac6e1336dc2f5f3f059bee48e8c55c242">int32u</a>;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 
<a name="l00036"></a>00036     <span class="comment">//========================================================================</span>
<a name="l00037"></a><a class="code" href="structagg_1_1rgba8.html">00037</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1rgba8.html">rgba8</a> 
<a name="l00038"></a>00038     {
<a name="l00039"></a><a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85a67daf8254a0bc0f6d87d996e78539cdf">00039</a>         <span class="keyword">enum</span> <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85">order</a> { <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85a67daf8254a0bc0f6d87d996e78539cdf">rgb</a>, <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85a6ab81fb083f98fea7200fd8435479655">bgr</a> };
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">00041</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>;
<a name="l00042"></a><a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">00042</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>;
<a name="l00043"></a><a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">00043</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>;
<a name="l00044"></a><a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">00044</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00047"></a><a class="code" href="structagg_1_1rgba8.html#a447976f937e593330e106be9dc47044a">00047</a>         <a class="code" href="structagg_1_1rgba8.html#a447976f937e593330e106be9dc47044a">rgba8</a>() {}
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00050"></a><a class="code" href="structagg_1_1rgba8.html#a78e9722e8fb3ede2fbe9aef3bac9ecb3">00050</a>         <a class="code" href="structagg_1_1rgba8.html#a447976f937e593330e106be9dc47044a">rgba8</a>(<span class="keywordtype">unsigned</span> r_, <span class="keywordtype">unsigned</span> g_, <span class="keywordtype">unsigned</span> b_, <span class="keywordtype">unsigned</span> a_=255) :
<a name="l00051"></a>00051             <a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>(<a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(r_)), <a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>(<a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(g_)), <a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>(<a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(b_)), <a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>(<a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(a_)) {}
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00054"></a><a class="code" href="structagg_1_1rgba8.html#ab8b832f0f5d5a089c432b3c03efea4ed">00054</a>         <a class="code" href="structagg_1_1rgba8.html#a447976f937e593330e106be9dc47044a">rgba8</a>(<span class="keywordtype">unsigned</span> packed, <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85">order</a> o) : 
<a name="l00055"></a>00055             <a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>((o == <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85a67daf8254a0bc0f6d87d996e78539cdf">rgb</a>) ? ((packed &gt;&gt; 16) &amp; 0xFF) : (packed &amp; 0xFF)),
<a name="l00056"></a>00056             <a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>((packed &gt;&gt; 8)  &amp; 0xFF),
<a name="l00057"></a>00057             <a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>((o == <a class="code" href="structagg_1_1rgba8.html#aba809b9a3adb9925f5f391a6a0118d85a67daf8254a0bc0f6d87d996e78539cdf">rgb</a>) ? (packed &amp; 0xFF) : ((packed &gt;&gt; 16) &amp; 0xFF)),
<a name="l00058"></a>00058             <a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>(255) {}
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00061"></a><a class="code" href="structagg_1_1rgba8.html#adb6bf09c7f10aba3bc4ee493f2a892b0">00061</a>         <span class="keywordtype">void</span> <a class="code" href="structagg_1_1rgba8.html#ade22cfe9f112a0347a3fa8dd6e98da34">opacity</a>(<span class="keywordtype">double</span> a_)
<a name="l00062"></a>00062         {
<a name="l00063"></a>00063             <span class="keywordflow">if</span>(a_ &lt; 0.0) a_ = 0.0;
<a name="l00064"></a>00064             <span class="keywordflow">if</span>(a_ &gt; 1.0) a_ = 1.0;
<a name="l00065"></a>00065             <a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(a_ * 255.0);
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00069"></a><a class="code" href="structagg_1_1rgba8.html#ade22cfe9f112a0347a3fa8dd6e98da34">00069</a>         <span class="keywordtype">double</span> <a class="code" href="structagg_1_1rgba8.html#ade22cfe9f112a0347a3fa8dd6e98da34">opacity</a>()<span class="keyword"> const</span>
<a name="l00070"></a>00070 <span class="keyword">        </span>{
<a name="l00071"></a>00071             <span class="keywordflow">return</span> double(<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>) / 255.0;
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00075"></a><a class="code" href="structagg_1_1rgba8.html#acf1d5065a2a0528a9161fd538161b19b">00075</a>         <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <a class="code" href="structagg_1_1rgba8.html#acf1d5065a2a0528a9161fd538161b19b">gradient</a>(<a class="code" href="structagg_1_1rgba8.html">rgba8</a> c, <span class="keywordtype">double</span> k)<span class="keyword"> const</span>
<a name="l00076"></a>00076 <span class="keyword">        </span>{
<a name="l00077"></a>00077             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> ret;
<a name="l00078"></a>00078             <span class="keywordtype">int</span> ik = int(k * 256);
<a name="l00079"></a>00079             ret.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(<span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>) + (((<span class="keywordtype">int</span>(c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>) - <span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>)) * ik) &gt;&gt; 8));
<a name="l00080"></a>00080             ret.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(<span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>) + (((<span class="keywordtype">int</span>(c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>) - <span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>)) * ik) &gt;&gt; 8));
<a name="l00081"></a>00081             ret.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(<span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>) + (((<span class="keywordtype">int</span>(c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>) - <span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>)) * ik) &gt;&gt; 8));
<a name="l00082"></a>00082             ret.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>(<span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>) + (((<span class="keywordtype">int</span>(c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>) - <span class="keywordtype">int</span>(<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>)) * ik) &gt;&gt; 8));
<a name="l00083"></a>00083             <span class="keywordflow">return</span> ret;
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="structagg_1_1rgba8.html#a06ce47d7177d7e4f96d7b6af0335a78d">00086</a>         <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <a class="code" href="structagg_1_1rgba8.html#a06ce47d7177d7e4f96d7b6af0335a78d">pre</a>()<span class="keyword"> const</span>
<a name="l00087"></a>00087 <span class="keyword">        </span>{
<a name="l00088"></a>00088             <span class="keywordflow">return</span> <a class="code" href="structagg_1_1rgba8.html#a447976f937e593330e106be9dc47044a">rgba8</a>((<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>*<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>) &gt;&gt; 8, (<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>*a) &gt;&gt; 8, (<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>*a) &gt;&gt; 8, a);
<a name="l00089"></a>00089         }
<a name="l00090"></a>00090     };
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">//========================================================================</span>
<a name="l00094"></a>00094     <span class="comment">// Rendering buffer wrapper. This class does not know anything about </span>
<a name="l00095"></a>00095     <span class="comment">// memory organizations, all it does it keeps an array of pointers </span>
<a name="l00096"></a>00096     <span class="comment">// to each pixel row. The general rules of rendering are as follows.</span>
<a name="l00097"></a>00097     <span class="comment">// </span>
<a name="l00098"></a>00098     <span class="comment">// 1. Allocate or create somehow a rendering buffer itself. Since </span>
<a name="l00099"></a>00099     <span class="comment">//    the library does not depend on any particular platform or</span>
<a name="l00100"></a>00100     <span class="comment">//    architecture it was decided that it&#39;s your responsibility </span>
<a name="l00101"></a>00101     <span class="comment">//    to create and destroy rendering buffers properly. You can use</span>
<a name="l00102"></a>00102     <span class="comment">//    any available mechanism to create it - you can use a system API </span>
<a name="l00103"></a>00103     <span class="comment">//    function, simple memory allocation, or even statically defined array. </span>
<a name="l00104"></a>00104     <span class="comment">//    You also should know the memory organization (or possible variants)</span>
<a name="l00105"></a>00105     <span class="comment">//    in your system. For example, there&#39;s an R,G,B or B,G,R organizations </span>
<a name="l00106"></a>00106     <span class="comment">//    with one byte per component (three byter per pixel) is used very often. </span>
<a name="l00107"></a>00107     <span class="comment">//    So, if you intend to use class render_bgr24, for example, you should </span>
<a name="l00108"></a>00108     <span class="comment">//    allocate at least width*height*3 bytes of memory.</span>
<a name="l00109"></a>00109     <span class="comment">//</span>
<a name="l00110"></a>00110     <span class="comment">// 2. Create a rendering_buffer object and then call method attach(). It requires</span>
<a name="l00111"></a>00111     <span class="comment">//    a pointer to the buffer itself, width and height of the buffer in </span>
<a name="l00112"></a>00112     <span class="comment">//    pixels, and the length of the row in bytes. All these values must </span>
<a name="l00113"></a>00113     <span class="comment">//    properly correspond to the memory organization. The argument stride</span>
<a name="l00114"></a>00114     <span class="comment">//    is used because in reality the row length in bytes does not obligatory </span>
<a name="l00115"></a>00115     <span class="comment">//    correspond with the width of the image in pixels, i.e. it cannot be </span>
<a name="l00116"></a>00116     <span class="comment">//    simply calculated as width_in_pixels * bytes_per_pixel. For example, </span>
<a name="l00117"></a>00117     <span class="comment">//    it must be aligned to 4 bytes in Windows bitmaps. Besides, the value</span>
<a name="l00118"></a>00118     <span class="comment">//    of stride can be negative - it depends on the order of displaying</span>
<a name="l00119"></a>00119     <span class="comment">//    the rendering buffer - from top to bottom or from bottom to top. </span>
<a name="l00120"></a>00120     <span class="comment">//    In other words, if stride &gt; 0 the pointers to each row will start </span>
<a name="l00121"></a>00121     <span class="comment">//    from the beginning of the buffer and increase. If it &lt; 0, the pointers </span>
<a name="l00122"></a>00122     <span class="comment">//    start from the end of the buffer and decrease. It gives you an </span>
<a name="l00123"></a>00123     <span class="comment">//    additional degree of freedom.</span>
<a name="l00124"></a>00124     <span class="comment">//    Method attach() can be called more than once. The execution time of it</span>
<a name="l00125"></a>00125     <span class="comment">//    is very little, still it allocates memory of heigh * sizeof(char*) bytes</span>
<a name="l00126"></a>00126     <span class="comment">//    and has a loop while(height--) {...}, so it&#39;s unreasonable to call it</span>
<a name="l00127"></a>00127     <span class="comment">//    every time before drawing any single pixel :-)</span>
<a name="l00128"></a>00128     <span class="comment">//</span>
<a name="l00129"></a>00129     <span class="comment">// 3. Create an object (or a number of objects) of a rendering class, such as</span>
<a name="l00130"></a>00130     <span class="comment">//    renderer_bgr24_solid, renderer_bgr24_image and so on. These classes</span>
<a name="l00131"></a>00131     <span class="comment">//    require a pointer to the renderer_buffer object, but they do not perform</span>
<a name="l00132"></a>00132     <span class="comment">//    any considerable operations except storing this pointer. So, rendering</span>
<a name="l00133"></a>00133     <span class="comment">//    objects can be created on demand almost any time. These objects know </span>
<a name="l00134"></a>00134     <span class="comment">//    about concrete memory organization (this knowledge is hardcoded), so </span>
<a name="l00135"></a>00135     <span class="comment">//    actually, the memory you allocated or created in clause 1 should </span>
<a name="l00136"></a>00136     <span class="comment">//    actually be in correspondence to the needs of the rendering class.</span>
<a name="l00137"></a>00137     <span class="comment">//  </span>
<a name="l00138"></a>00138     <span class="comment">// 4. Rener your image using rendering classes, for example, rasterizer</span>
<a name="l00139"></a>00139     <span class="comment">//  </span>
<a name="l00140"></a>00140     <span class="comment">// 5. Display the result, or store it, or whatever. It&#39;s also your </span>
<a name="l00141"></a>00141     <span class="comment">//    responsibility and depends on the platform.</span>
<a name="l00142"></a>00142     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00143"></a><a class="code" href="classagg_1_1rendering__buffer.html">00143</a>     <span class="keyword">class </span><a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>
<a name="l00144"></a>00144     {
<a name="l00145"></a>00145     <span class="keyword">public</span>:
<a name="l00146"></a>00146         <a class="code" href="classagg_1_1rendering__buffer.html#ad543ef02b28fff0b6eddca2786f54532">~rendering_buffer</a>();
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">//-----------------------------------------Initialization</span>
<a name="l00149"></a>00149         <a class="code" href="classagg_1_1rendering__buffer.html#ae93886646728bed93e9d25c8ac808fff">rendering_buffer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="classagg_1_1rendering__buffer.html#af416294858d093870627370c66d314ea">buf</a>,
<a name="l00150"></a>00150                          <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>, 
<a name="l00151"></a>00151                          <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>,
<a name="l00152"></a>00152                          <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">stride</a>);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="comment">//-----------------------------------------Initialization</span>
<a name="l00155"></a>00155         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rendering__buffer.html#add349fd37249bd619a375faac3c90cc2">attach</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf,
<a name="l00156"></a>00156                     <span class="keywordtype">unsigned</span> width, 
<a name="l00157"></a>00157                     <span class="keywordtype">unsigned</span> height,
<a name="l00158"></a>00158                     <span class="keywordtype">int</span>      stride);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="comment">//-----------------------------------------Acessors</span>
<a name="l00161"></a><a class="code" href="classagg_1_1rendering__buffer.html#af416294858d093870627370c66d314ea">00161</a>         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="classagg_1_1rendering__buffer.html#af416294858d093870627370c66d314ea">buf</a>()<span class="keyword">    const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">m_buf</a>;    }
<a name="l00162"></a><a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">00162</a>         <span class="keywordtype">unsigned</span>             <a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>()<span class="keyword">  const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#aa286889243950dcdcdfe58c668b557db">m_width</a>;  }
<a name="l00163"></a><a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">00163</a>         <span class="keywordtype">unsigned</span>             <a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#a59c20ec5006e0281b7a9f5e17166b44d">m_height</a>; }
<a name="l00164"></a><a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">00164</a>         <span class="keywordtype">int</span>                  <a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">stride</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a>; }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="classagg_1_1rendering__buffer.html#a3f72a12f24c20d700cd7b8790021af09">00166</a>         <span class="keywordtype">bool</span> <a class="code" href="classagg_1_1rendering__buffer.html#a3f72a12f24c20d700cd7b8790021af09">inbox</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)<span class="keyword"> const</span>
<a name="l00167"></a>00167 <span class="keyword">        </span>{
<a name="l00168"></a>00168             <span class="keywordflow">return</span> x &gt;= 0 &amp;&amp; y &gt;= 0 &amp;&amp; x &lt; int(<a class="code" href="classagg_1_1rendering__buffer.html#aa286889243950dcdcdfe58c668b557db">m_width</a>) &amp;&amp; y &lt; int(<a class="code" href="classagg_1_1rendering__buffer.html#a59c20ec5006e0281b7a9f5e17166b44d">m_height</a>);
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         
<a name="l00171"></a><a class="code" href="classagg_1_1rendering__buffer.html#a704dfd8a3c91af52595f0d7b3977e3a9">00171</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1rendering__buffer.html#a704dfd8a3c91af52595f0d7b3977e3a9">abs_stride</a>()<span class="keyword"> const </span>
<a name="l00172"></a>00172 <span class="keyword">        </span>{ 
<a name="l00173"></a>00173             <span class="keywordflow">return</span> (<a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a> &lt; 0) ? unsigned(-<a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a>) : unsigned(<a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a>); 
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">00176</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">row</a>(<span class="keywordtype">unsigned</span> y) { <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>[y];  }
<a name="l00177"></a><a class="code" href="classagg_1_1rendering__buffer.html#a438092b86b05b67cf8e0de48341d9860">00177</a>         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="classagg_1_1rendering__buffer.html#a438092b86b05b67cf8e0de48341d9860">row</a>(<span class="keywordtype">unsigned</span> y)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>[y]; }
<a name="l00178"></a>00178         
<a name="l00179"></a>00179     <span class="keyword">private</span>:
<a name="l00180"></a>00180         <a class="code" href="classagg_1_1rendering__buffer.html#ae93886646728bed93e9d25c8ac808fff">rendering_buffer</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>&amp;);
<a name="l00181"></a>00181         <span class="keyword">const</span> <a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>&amp; <a class="code" href="classagg_1_1rendering__buffer.html#abd9a35db056f954b31f40139c647ecd2">operator = </a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>&amp;);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <span class="keyword">private</span>:
<a name="l00184"></a><a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">00184</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*  <a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">m_buf</a>;        <span class="comment">// Pointer to renrdering buffer</span>
<a name="l00185"></a><a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">00185</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>** <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>;       <span class="comment">// Pointers to each row of the buffer</span>
<a name="l00186"></a><a class="code" href="classagg_1_1rendering__buffer.html#aa286889243950dcdcdfe58c668b557db">00186</a>         <span class="keywordtype">unsigned</span>        <a class="code" href="classagg_1_1rendering__buffer.html#aa286889243950dcdcdfe58c668b557db">m_width</a>;      <span class="comment">// Width in pixels</span>
<a name="l00187"></a><a class="code" href="classagg_1_1rendering__buffer.html#a59c20ec5006e0281b7a9f5e17166b44d">00187</a>         <span class="keywordtype">unsigned</span>        <a class="code" href="classagg_1_1rendering__buffer.html#a59c20ec5006e0281b7a9f5e17166b44d">m_height</a>;     <span class="comment">// Height in pixels</span>
<a name="l00188"></a><a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">00188</a>         <span class="keywordtype">int</span>             <a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a>;     <span class="comment">// Number of bytes per row. Can be &lt; 0</span>
<a name="l00189"></a><a class="code" href="classagg_1_1rendering__buffer.html#a78926646758d066cd3c7b811e9934de2">00189</a>         <span class="keywordtype">unsigned</span>        <a class="code" href="classagg_1_1rendering__buffer.html#a78926646758d066cd3c7b811e9934de2">m_max_height</a>; <span class="comment">// Maximal current height</span>
<a name="l00190"></a>00190     };
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">//========================================================================</span>
<a name="l00195"></a>00195     <span class="comment">//</span>
<a name="l00196"></a>00196     <span class="comment">// This class is used to transfer data from class outline (or a similar one)</span>
<a name="l00197"></a>00197     <span class="comment">// to the rendering buffer. It&#39;s organized very simple. The class stores </span>
<a name="l00198"></a>00198     <span class="comment">// information of horizontal spans to render it into a pixel-map buffer. </span>
<a name="l00199"></a>00199     <span class="comment">// Each span has initial X, length, and an array of bytes that determine the </span>
<a name="l00200"></a>00200     <span class="comment">// alpha-values for each pixel. So, the restriction of using this class is 256 </span>
<a name="l00201"></a>00201     <span class="comment">// levels of Anti-Aliasing, which is quite enough for any practical purpose.</span>
<a name="l00202"></a>00202     <span class="comment">// Before using this class you should know the minimal and maximal pixel </span>
<a name="l00203"></a>00203     <span class="comment">// coordinates of your scanline. The protocol of using is:</span>
<a name="l00204"></a>00204     <span class="comment">// 1. reset(min_x, max_x)</span>
<a name="l00205"></a>00205     <span class="comment">// 2. add_cell() / add_span() - accumulate scanline. You pass Y-coordinate </span>
<a name="l00206"></a>00206     <span class="comment">//    into these functions in order to make scanline know the last Y. Before </span>
<a name="l00207"></a>00207     <span class="comment">//    calling add_cell() / add_span() you should check with method is_ready(y)</span>
<a name="l00208"></a>00208     <span class="comment">//    if the last Y has changed. It also checks if the scanline is not empty. </span>
<a name="l00209"></a>00209     <span class="comment">//    When forming one scanline the next X coordinate must be always greater</span>
<a name="l00210"></a>00210     <span class="comment">//    than the last stored one, i.e. it works only with ordered coordinates.</span>
<a name="l00211"></a>00211     <span class="comment">// 3. If the current scanline is_ready() you should render it and then call </span>
<a name="l00212"></a>00212     <span class="comment">//    reset_spans() before adding new cells/spans.</span>
<a name="l00213"></a>00213     <span class="comment">//    </span>
<a name="l00214"></a>00214     <span class="comment">// 4. Rendering:</span>
<a name="l00215"></a>00215     <span class="comment">// </span>
<a name="l00216"></a>00216     <span class="comment">// Scanline provides an iterator class that allows you to extract</span>
<a name="l00217"></a>00217     <span class="comment">// the spans and the cover values for each pixel. Be aware that clipping</span>
<a name="l00218"></a>00218     <span class="comment">// has not been done yet, so you should perform it yourself.</span>
<a name="l00219"></a>00219     <span class="comment">// Use scanline::iterator to render spans:</span>
<a name="l00220"></a>00220     <span class="comment">//-------------------------------------------------------------------------</span>
<a name="l00221"></a>00221     <span class="comment">//</span>
<a name="l00222"></a>00222     <span class="comment">// int base_x = sl.base_x();          // base X. Should be added to the span&#39;s X</span>
<a name="l00223"></a>00223     <span class="comment">//                                    // &quot;sl&quot; is a const reference to the </span>
<a name="l00224"></a>00224     <span class="comment">//                                    // scanline passed in.</span>
<a name="l00225"></a>00225     <span class="comment">//</span>
<a name="l00226"></a>00226     <span class="comment">// int y = sl.y();                    // Y-coordinate of the scanline</span>
<a name="l00227"></a>00227     <span class="comment">//</span>
<a name="l00228"></a>00228     <span class="comment">// ************************************</span>
<a name="l00229"></a>00229     <span class="comment">// ...Perform vertical clipping here...</span>
<a name="l00230"></a>00230     <span class="comment">// ************************************</span>
<a name="l00231"></a>00231     <span class="comment">//</span>
<a name="l00232"></a>00232     <span class="comment">// scanline::iterator span(sl);</span>
<a name="l00233"></a>00233     <span class="comment">// </span>
<a name="l00234"></a>00234     <span class="comment">// unsigned char* row = m_rbuf-&gt;row(y); // The the address of the beginning </span>
<a name="l00235"></a>00235     <span class="comment">//                                      // of the current row</span>
<a name="l00236"></a>00236     <span class="comment">// </span>
<a name="l00237"></a>00237     <span class="comment">// unsigned num_spans = sl.num_spans(); // Number of spans. It&#39;s guaranteed that</span>
<a name="l00238"></a>00238     <span class="comment">//                                      // num_spans is always greater than 0.</span>
<a name="l00239"></a>00239     <span class="comment">//</span>
<a name="l00240"></a>00240     <span class="comment">// do</span>
<a name="l00241"></a>00241     <span class="comment">// {</span>
<a name="l00242"></a>00242     <span class="comment">//     int x = span.next() + base_x;        // The beginning X of the span</span>
<a name="l00243"></a>00243     <span class="comment">//</span>
<a name="l00244"></a>00244     <span class="comment">//     const int8u covers* = span.covers(); // The array of the cover values</span>
<a name="l00245"></a>00245     <span class="comment">//</span>
<a name="l00246"></a>00246     <span class="comment">//     int num_pix = span.num_pix();        // Number of pixels of the span.</span>
<a name="l00247"></a>00247     <span class="comment">//                                          // Always greater than 0, still we</span>
<a name="l00248"></a>00248     <span class="comment">//                                          // shoud use &quot;int&quot; instead of </span>
<a name="l00249"></a>00249     <span class="comment">//                                          // &quot;unsigned&quot; because it&#39;s more</span>
<a name="l00250"></a>00250     <span class="comment">//                                          // convenient for clipping</span>
<a name="l00251"></a>00251     <span class="comment">//</span>
<a name="l00252"></a>00252     <span class="comment">//     **************************************</span>
<a name="l00253"></a>00253     <span class="comment">//     ...Perform horizontal clipping here...</span>
<a name="l00254"></a>00254     <span class="comment">//     ...you have x, covers, and pix_count..</span>
<a name="l00255"></a>00255     <span class="comment">//     **************************************</span>
<a name="l00256"></a>00256     <span class="comment">//</span>
<a name="l00257"></a>00257     <span class="comment">//     unsigned char* dst = row + x;  // Calculate the start address of the row.</span>
<a name="l00258"></a>00258     <span class="comment">//                                    // In this case we assume a simple </span>
<a name="l00259"></a>00259     <span class="comment">//                                    // grayscale image 1-byte per pixel.</span>
<a name="l00260"></a>00260     <span class="comment">//     do</span>
<a name="l00261"></a>00261     <span class="comment">//     {</span>
<a name="l00262"></a>00262     <span class="comment">//         *dst++ = *covers++;        // Hypotetical rendering. </span>
<a name="l00263"></a>00263     <span class="comment">//     }</span>
<a name="l00264"></a>00264     <span class="comment">//     while(--num_pix);</span>
<a name="l00265"></a>00265     <span class="comment">// } </span>
<a name="l00266"></a>00266     <span class="comment">// while(--num_spans);  // num_spans cannot be 0, so this loop is quite safe</span>
<a name="l00267"></a>00267     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00268"></a>00268     <span class="comment">//</span>
<a name="l00269"></a>00269     <span class="comment">// The question is: why should we accumulate the whole scanline when we</span>
<a name="l00270"></a>00270     <span class="comment">// could render just separate spans when they&#39;re ready?</span>
<a name="l00271"></a>00271     <span class="comment">// That&#39;s because using the scaline is in general faster. When is consists </span>
<a name="l00272"></a>00272     <span class="comment">// of more than one span the conditions for the processor cash system</span>
<a name="l00273"></a>00273     <span class="comment">// are better, because switching between two different areas of memory </span>
<a name="l00274"></a>00274     <span class="comment">// (that can be large ones) occures less frequently.</span>
<a name="l00275"></a>00275     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00276"></a><a class="code" href="classagg_1_1scanline.html">00276</a>     <span class="keyword">class </span><a class="code" href="classagg_1_1scanline.html">scanline</a>
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278     <span class="keyword">public</span>:
<a name="l00279"></a><a class="code" href="classagg_1_1scanline.html#a7c270962d1fc7daa4e041e8db560aa87ab00d984c39140f477411538583ad6fad">00279</a>         <span class="keyword">enum</span> { <a class="code" href="classagg_1_1scanline.html#a7c270962d1fc7daa4e041e8db560aa87ab00d984c39140f477411538583ad6fad">aa_shift</a> = 8 };
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html">00281</a>         <span class="keyword">class </span><a class="code" href="classagg_1_1scanline_1_1iterator.html">iterator</a>
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283         <span class="keyword">public</span>:
<a name="l00284"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#a28e8e2af516599797c30476b5c65b564">00284</a>             <a class="code" href="classagg_1_1scanline_1_1iterator.html#a28e8e2af516599797c30476b5c65b564">iterator</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1scanline.html">scanline</a>&amp; sl) :
<a name="l00285"></a>00285                 <a class="code" href="classagg_1_1scanline_1_1iterator.html#ad298d27330c6e76a0568b5ccc434b33b">m_covers</a>(sl.<a class="code" href="classagg_1_1scanline_1_1iterator.html#ad298d27330c6e76a0568b5ccc434b33b">m_covers</a>),
<a name="l00286"></a>00286                 <a class="code" href="classagg_1_1scanline_1_1iterator.html#a279db49ea7f41f86e5037f02353318bc">m_cur_count</a>(sl.<a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>),
<a name="l00287"></a>00287                 <a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">m_cur_start_ptr</a>(sl.<a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>)
<a name="l00288"></a>00288             {
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#a4bd822748ff648ed74958c1eb18389a2">00291</a>             <span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline_1_1iterator.html#a4bd822748ff648ed74958c1eb18389a2">next</a>()
<a name="l00292"></a>00292             {
<a name="l00293"></a>00293                 ++<a class="code" href="classagg_1_1scanline_1_1iterator.html#a279db49ea7f41f86e5037f02353318bc">m_cur_count</a>;
<a name="l00294"></a>00294                 ++<a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">m_cur_start_ptr</a>;
<a name="l00295"></a>00295                 <span class="keywordflow">return</span> int(*<a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">m_cur_start_ptr</a> - <a class="code" href="classagg_1_1scanline_1_1iterator.html#ad298d27330c6e76a0568b5ccc434b33b">m_covers</a>);
<a name="l00296"></a>00296             }
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#af340181dba5beac3f88276ca1f49bed1">00298</a>             <span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline_1_1iterator.html#af340181dba5beac3f88276ca1f49bed1">num_pix</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> int(*<a class="code" href="classagg_1_1scanline_1_1iterator.html#a279db49ea7f41f86e5037f02353318bc">m_cur_count</a>); }
<a name="l00299"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#a8afb77cbe51c50515f190cd0f94570dd">00299</a>             <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>* <a class="code" href="classagg_1_1scanline_1_1iterator.html#a8afb77cbe51c50515f190cd0f94570dd">covers</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *<a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">m_cur_start_ptr</a>; }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <span class="keyword">private</span>:
<a name="l00302"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#ad298d27330c6e76a0568b5ccc434b33b">00302</a>             <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>*        <a class="code" href="classagg_1_1scanline_1_1iterator.html#ad298d27330c6e76a0568b5ccc434b33b">m_covers</a>;
<a name="l00303"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#a279db49ea7f41f86e5037f02353318bc">00303</a>             <span class="keyword">const</span> <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*       <a class="code" href="classagg_1_1scanline_1_1iterator.html#a279db49ea7f41f86e5037f02353318bc">m_cur_count</a>;
<a name="l00304"></a><a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">00304</a>             <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>* <span class="keyword">const</span>* <a class="code" href="classagg_1_1scanline_1_1iterator.html#ab7a37601c38ae766a09e11c7cb089710">m_cur_start_ptr</a>;
<a name="l00305"></a>00305         };
<a name="l00306"></a>00306 
<a name="l00307"></a><a class="code" href="classagg_1_1scanline.html#a67171474c4da6cc8efe0c7fafefd2b2d">00307</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classagg_1_1scanline_1_1iterator.html">iterator</a>;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         <a class="code" href="classagg_1_1scanline.html#ab641b452c39d748336b559d7c8154a7b">~scanline</a>();
<a name="l00310"></a>00310         <a class="code" href="classagg_1_1scanline.html#aef5b374f3a44c95f5b29362f446a2f45">scanline</a>();
<a name="l00311"></a>00311 
<a name="l00312"></a>00312         <span class="keywordtype">void</span>     <a class="code" href="classagg_1_1scanline.html#ae545a2e89b9e5be9003158071ab8adab">reset</a>(<span class="keywordtype">int</span> min_x, <span class="keywordtype">int</span> max_x, <span class="keywordtype">int</span> dx=0, <span class="keywordtype">int</span> dy=0);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordtype">void</span>     <a class="code" href="classagg_1_1scanline.html#aaff3394c2b5f58bce11cf658c1afd19f">reset_spans</a>();
<a name="l00315"></a>00315         <span class="keywordtype">void</span>     <a class="code" href="classagg_1_1scanline.html#aec8e0033da21d69abe903611677c92b7">add_cell</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>, <span class="keywordtype">unsigned</span> cover);
<a name="l00316"></a>00316         <span class="keywordtype">void</span>     <a class="code" href="classagg_1_1scanline.html#ad232ee623d33b3a5ddb59555879db4b1">add_span</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>, <span class="keywordtype">unsigned</span> len, <span class="keywordtype">unsigned</span> cover);
<a name="l00317"></a>00317         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a2c7b0f238a4e060d8ec5a7ba57f4f59d">is_ready</a>(<span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>) <span class="keyword">const</span>;
<a name="l00318"></a><a class="code" href="classagg_1_1scanline.html#a1400dde9f95c9f547c3682567da12b7a">00318</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a1400dde9f95c9f547c3682567da12b7a">base_x</a>()<span class="keyword">    const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">m_min_x</a> + <a class="code" href="classagg_1_1scanline.html#a533e3c057ad174cb9e79655f3f898301">m_dx</a>;  }
<a name="l00319"></a><a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">00319</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>()<span class="keyword">         const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a> + <a class="code" href="classagg_1_1scanline.html#ae726eea162f018d564931bc548d9e5b6">m_dy</a>; }
<a name="l00320"></a><a class="code" href="classagg_1_1scanline.html#aae24eee0e299f4eb923413ef15743e16">00320</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1scanline.html#aae24eee0e299f4eb923413ef15743e16">num_spans</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>;     }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="keyword">private</span>:
<a name="l00323"></a>00323         <a class="code" href="classagg_1_1scanline.html#aef5b374f3a44c95f5b29362f446a2f45">scanline</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1scanline.html">scanline</a>&amp;);
<a name="l00324"></a>00324         <span class="keyword">const</span> <a class="code" href="classagg_1_1scanline.html">scanline</a>&amp; <a class="code" href="classagg_1_1scanline.html#a3353785f1d8d7d5dba3bbe8316da69bc">operator = </a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1scanline.html">scanline</a>&amp;);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="keyword">private</span>:
<a name="l00327"></a><a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">00327</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">m_min_x</a>;
<a name="l00328"></a><a class="code" href="classagg_1_1scanline.html#ad2014582a7c0aef4d6dfc9db066d5fe4">00328</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1scanline.html#ad2014582a7c0aef4d6dfc9db066d5fe4">m_max_len</a>;
<a name="l00329"></a><a class="code" href="classagg_1_1scanline.html#a533e3c057ad174cb9e79655f3f898301">00329</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a533e3c057ad174cb9e79655f3f898301">m_dx</a>;
<a name="l00330"></a><a class="code" href="classagg_1_1scanline.html#ae726eea162f018d564931bc548d9e5b6">00330</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#ae726eea162f018d564931bc548d9e5b6">m_dy</a>;
<a name="l00331"></a><a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">00331</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a>;
<a name="l00332"></a><a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">00332</a>         <span class="keywordtype">int</span>      <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a>;
<a name="l00333"></a><a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">00333</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>*   <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a>;
<a name="l00334"></a><a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">00334</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>**  <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>;
<a name="l00335"></a><a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">00335</a>         <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*  <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>;
<a name="l00336"></a><a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">00336</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>;
<a name="l00337"></a><a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">00337</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>**  <a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">m_cur_start_ptr</a>;
<a name="l00338"></a><a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">00338</a>         <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*  <a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">m_cur_count</a>;
<a name="l00339"></a>00339     };
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00343"></a><a class="code" href="classagg_1_1scanline.html#aaff3394c2b5f58bce11cf658c1afd19f">00343</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1scanline.html#aaff3394c2b5f58bce11cf658c1afd19f">scanline::reset_spans</a>()
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345         <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a>        = 0x7FFF;
<a name="l00346"></a>00346         <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a>        = 0x7FFF;
<a name="l00347"></a>00347         <a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">m_cur_count</a>     = <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>;
<a name="l00348"></a>00348         <a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>;
<a name="l00349"></a>00349         <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>     = 0;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00353"></a>00353     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00354"></a><a class="code" href="classagg_1_1scanline.html#aec8e0033da21d69abe903611677c92b7">00354</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1scanline.html#aec8e0033da21d69abe903611677c92b7">scanline::add_cell</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> cover)
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356         x -= <a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">m_min_x</a>;
<a name="l00357"></a>00357         <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a>[x] = (<span class="keywordtype">unsigned</span> char)cover;
<a name="l00358"></a>00358         <span class="keywordflow">if</span>(x == <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a>+1)
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360             (*m_cur_count)++;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         <span class="keywordflow">else</span>
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364             *++<a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">m_cur_count</a> = 1;
<a name="l00365"></a>00365             *++<a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a> + x;
<a name="l00366"></a>00366             <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>++;
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368         <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a> = x;
<a name="l00369"></a>00369         <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a> = <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00374"></a><a class="code" href="classagg_1_1scanline.html#a2c7b0f238a4e060d8ec5a7ba57f4f59d">00374</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classagg_1_1scanline.html#a2c7b0f238a4e060d8ec5a7ba57f4f59d">scanline::is_ready</a>(<span class="keywordtype">int</span> y)<span class="keyword"> const</span>
<a name="l00375"></a>00375 <span class="keyword">    </span>{
<a name="l00376"></a>00376         <span class="keywordflow">return</span> <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a> &amp;&amp; (y ^ <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a>);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="comment">//========================================================================</span>
<a name="l00383"></a>00383     <span class="comment">// This class template is used basically for rendering scanlines. </span>
<a name="l00384"></a>00384     <span class="comment">// The &#39;Span&#39; argument is one of the span renderers, such as span_rgb24 </span>
<a name="l00385"></a>00385     <span class="comment">// and others.</span>
<a name="l00386"></a>00386     <span class="comment">// </span>
<a name="l00387"></a>00387     <span class="comment">// Usage:</span>
<a name="l00388"></a>00388     <span class="comment">// </span>
<a name="l00389"></a>00389     <span class="comment">//     // Creation</span>
<a name="l00390"></a>00390     <span class="comment">//     agg::rendering_buffer rbuf(ptr, w, h, stride);</span>
<a name="l00391"></a>00391     <span class="comment">//     agg::renderer&lt;agg::span_rgb24&gt; ren(rbuf);</span>
<a name="l00392"></a>00392     <span class="comment">//     agg::rasterizer ras;</span>
<a name="l00393"></a>00393     <span class="comment">//</span>
<a name="l00394"></a>00394     <span class="comment">//     // Clear the frame buffer</span>
<a name="l00395"></a>00395     <span class="comment">//     ren.clear(agg::rgba8(0,0,0));</span>
<a name="l00396"></a>00396     <span class="comment">//</span>
<a name="l00397"></a>00397     <span class="comment">//     // Making polygon</span>
<a name="l00398"></a>00398     <span class="comment">//     // ras.move_to(. . .);</span>
<a name="l00399"></a>00399     <span class="comment">//     // ras.line_to(. . .);</span>
<a name="l00400"></a>00400     <span class="comment">//     // . . .</span>
<a name="l00401"></a>00401     <span class="comment">//</span>
<a name="l00402"></a>00402     <span class="comment">//     // Rendering</span>
<a name="l00403"></a>00403     <span class="comment">//     ras.render(ren, agg::rgba8(200, 100, 80));</span>
<a name="l00404"></a>00404     <span class="comment">//  </span>
<a name="l00405"></a>00405     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00406"></a><a class="code" href="classagg_1_1renderer.html">00406</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Span&gt; <span class="keyword">class </span><a class="code" href="classagg_1_1renderer.html">renderer</a>
<a name="l00407"></a>00407     {
<a name="l00408"></a>00408     <span class="keyword">public</span>:
<a name="l00409"></a>00409         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00410"></a><a class="code" href="classagg_1_1renderer.html#aedeeab69c0dece884cecabde5a3ee59a">00410</a>         <a class="code" href="classagg_1_1renderer.html#aedeeab69c0dece884cecabde5a3ee59a">renderer</a>(<a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>&amp; <a class="code" href="classagg_1_1renderer.html#a29d41a23ebb5fa0c822d149f90d94761">rbuf</a>) : <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>(&amp;rbuf)
<a name="l00411"></a>00411         {
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00415"></a><a class="code" href="classagg_1_1renderer.html#a9adddfeb8ba1074c73b94abe0ca3aab2">00415</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1renderer.html#a9adddfeb8ba1074c73b94abe0ca3aab2">clear</a>(<span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00416"></a>00416         {
<a name="l00417"></a>00417             <span class="keywordtype">unsigned</span> y;
<a name="l00418"></a>00418             <span class="keywordflow">for</span>(y = 0; y &lt; <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>(); y++)
<a name="l00419"></a>00419             {
<a name="l00420"></a>00420                 <a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">m_span</a>.hline(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">row</a>(y), 0, <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>(), c);
<a name="l00421"></a>00421             }
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00425"></a><a class="code" href="classagg_1_1renderer.html#a2d11f04b0b31eac04bdadb1931efa904">00425</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1renderer.html#a2d11f04b0b31eac04bdadb1931efa904">pixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00426"></a>00426         {
<a name="l00427"></a>00427             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a3f72a12f24c20d700cd7b8790021af09">inbox</a>(x, y))
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 <a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">m_span</a>.hline(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">row</a>(y), x, 1, c);
<a name="l00430"></a>00430             }
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00434"></a><a class="code" href="classagg_1_1renderer.html#abf2f4bbb530922b1a0057d7f5b95b5bf">00434</a>         <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <a class="code" href="classagg_1_1renderer.html#a2d11f04b0b31eac04bdadb1931efa904">pixel</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)<span class="keyword"> const</span>
<a name="l00435"></a>00435 <span class="keyword">        </span>{
<a name="l00436"></a>00436             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a3f72a12f24c20d700cd7b8790021af09">inbox</a>(x, y))
<a name="l00437"></a>00437             {
<a name="l00438"></a>00438                 <span class="keywordflow">return</span> <a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">m_span</a>.get(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">row</a>(y), x);
<a name="l00439"></a>00439             }
<a name="l00440"></a>00440             <span class="keywordflow">return</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>(0,0,0);
<a name="l00441"></a>00441         }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00444"></a><a class="code" href="classagg_1_1renderer.html#a552eb76ef8b848a94bd9d91bc7ea8e87">00444</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1renderer.html#a552eb76ef8b848a94bd9d91bc7ea8e87">render</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1scanline.html">scanline</a>&amp; sl, <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00445"></a>00445         {
<a name="l00446"></a>00446             <span class="keywordflow">if</span>(sl.<a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>() &lt; 0 || sl.<a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>() &gt;= int(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>()))
<a name="l00447"></a>00447             {
<a name="l00448"></a>00448                 <span class="keywordflow">return</span>;
<a name="l00449"></a>00449             }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451             <span class="keywordtype">unsigned</span> num_spans = sl.<a class="code" href="classagg_1_1scanline.html#aae24eee0e299f4eb923413ef15743e16">num_spans</a>();
<a name="l00452"></a>00452             <span class="keywordtype">int</span> base_x = sl.<a class="code" href="classagg_1_1scanline.html#a1400dde9f95c9f547c3682567da12b7a">base_x</a>();
<a name="l00453"></a>00453             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* row = <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#ae522cbd260da2117d9c562859a0990d0">row</a>(sl.<a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>());
<a name="l00454"></a>00454             <a class="code" href="classagg_1_1scanline_1_1iterator.html">scanline::iterator</a> span(sl);
<a name="l00455"></a>00455 
<a name="l00456"></a>00456             <span class="keywordflow">do</span>
<a name="l00457"></a>00457             {
<a name="l00458"></a>00458                 <span class="keywordtype">int</span> x = span.<a class="code" href="classagg_1_1scanline_1_1iterator.html#a4bd822748ff648ed74958c1eb18389a2">next</a>() + base_x;
<a name="l00459"></a>00459                 <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>* covers = span.<a class="code" href="classagg_1_1scanline_1_1iterator.html#a8afb77cbe51c50515f190cd0f94570dd">covers</a>();
<a name="l00460"></a>00460                 <span class="keywordtype">int</span> num_pix = span.<a class="code" href="classagg_1_1scanline_1_1iterator.html#af340181dba5beac3f88276ca1f49bed1">num_pix</a>();
<a name="l00461"></a>00461                 <span class="keywordflow">if</span>(x &lt; 0)
<a name="l00462"></a>00462                 {
<a name="l00463"></a>00463                     num_pix += x;
<a name="l00464"></a>00464                     <span class="keywordflow">if</span>(num_pix &lt;= 0) <span class="keywordflow">continue</span>;
<a name="l00465"></a>00465                     covers -= x;
<a name="l00466"></a>00466                     x = 0;
<a name="l00467"></a>00467                 }
<a name="l00468"></a>00468                 <span class="keywordflow">if</span>(x + num_pix &gt;= <span class="keywordtype">int</span>(<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>()))
<a name="l00469"></a>00469                 {
<a name="l00470"></a>00470                     num_pix = <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>-&gt;<a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>() - x;
<a name="l00471"></a>00471                     <span class="keywordflow">if</span>(num_pix &lt;= 0) <span class="keywordflow">continue</span>;
<a name="l00472"></a>00472                 }
<a name="l00473"></a>00473                 <a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">m_span</a>.render(row, x, num_pix, covers, c);
<a name="l00474"></a>00474             }
<a name="l00475"></a>00475             <span class="keywordflow">while</span>(--num_spans);
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00479"></a><a class="code" href="classagg_1_1renderer.html#a29d41a23ebb5fa0c822d149f90d94761">00479</a>         <a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>&amp; <a class="code" href="classagg_1_1renderer.html#a29d41a23ebb5fa0c822d149f90d94761">rbuf</a>() { <span class="keywordflow">return</span> *<a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>; }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keyword">private</span>:
<a name="l00482"></a><a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">00482</a>         <a class="code" href="classagg_1_1rendering__buffer.html">rendering_buffer</a>* <a class="code" href="classagg_1_1renderer.html#a6f621632922e9ecee03315e5617093e7">m_rbuf</a>;
<a name="l00483"></a><a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">00483</a>         Span              <a class="code" href="classagg_1_1renderer.html#a30202301923f76990561966a791ea1f0">m_span</a>;
<a name="l00484"></a>00484     };
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00488"></a>00488     <span class="comment">// These constants determine the subpixel accuracy, to be more precise, </span>
<a name="l00489"></a>00489     <span class="comment">// the number of bits of the fractional part of the coordinates. </span>
<a name="l00490"></a>00490     <span class="comment">// The possible coordinate capacity in bits can be calculated by formula:</span>
<a name="l00491"></a>00491     <span class="comment">// sizeof(int) * 8 - poly_base_shift * 2, i.e, for 32-bit integers and</span>
<a name="l00492"></a>00492     <span class="comment">// 8-bits fractional part the capacity is 16 bits or [-32768...32767].</span>
<a name="l00493"></a>00493     <span class="keyword">enum</span>
<a name="l00494"></a>00494     {
<a name="l00495"></a><a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">00495</a>         <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a> = 8,
<a name="l00496"></a><a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">00496</a>         <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>  = 1 &lt;&lt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>,
<a name="l00497"></a><a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">00497</a>         <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">poly_base_mask</a>  = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - 1
<a name="l00498"></a>00498     };
<a name="l00499"></a>00499     
<a name="l00500"></a>00500     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00501"></a><a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">00501</a>     <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">poly_coord</a>(<span class="keywordtype">double</span> c)
<a name="l00502"></a>00502     {
<a name="l00503"></a>00503         <span class="keywordflow">return</span> int(c * <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>);
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00507"></a>00507     <span class="comment">// A pixel cell. There&#39;re no constructors defined and it was done </span>
<a name="l00508"></a>00508     <span class="comment">// intentionally in order to avoid extra overhead when allocating an </span>
<a name="l00509"></a>00509     <span class="comment">// array of cells.</span>
<a name="l00510"></a><a class="code" href="structagg_1_1cell.html">00510</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1cell.html">cell</a>
<a name="l00511"></a>00511     {
<a name="l00512"></a><a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">00512</a>         <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a> <a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a>;
<a name="l00513"></a><a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">00513</a>         <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a> <a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a>;
<a name="l00514"></a><a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">00514</a>         <span class="keywordtype">int</span>   <a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a>;
<a name="l00515"></a><a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">00515</a>         <span class="keywordtype">int</span>   <a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>;
<a name="l00516"></a><a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">00516</a>         <span class="keywordtype">int</span>   <a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a>;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">int</span> <a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a>, <span class="keywordtype">int</span> <a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a>, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a);
<a name="l00519"></a>00519         <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#adcdb1d48f21d5142e960b820103883b4">set_coord</a>(<span class="keywordtype">int</span> <a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a>, <span class="keywordtype">int</span> <a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a>);
<a name="l00520"></a>00520         <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#a1873bd1201513f6d0a99819bbe0af893">set_cover</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a);
<a name="l00521"></a>00521         <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a);
<a name="l00522"></a>00522     };
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00526"></a>00526     <span class="comment">// An internal class that implements the main rasterization algorithm.</span>
<a name="l00527"></a>00527     <span class="comment">// Used in the rasterizer. Should not be used direcly.</span>
<a name="l00528"></a><a class="code" href="classagg_1_1outline.html">00528</a>     <span class="keyword">class </span><a class="code" href="classagg_1_1outline.html">outline</a>
<a name="l00529"></a>00529     {
<a name="l00530"></a>00530         <span class="keyword">enum</span>
<a name="l00531"></a>00531         {
<a name="l00532"></a><a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ab2f6ca79eda5b12403e20efd75d7ad12">00532</a>             <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ab2f6ca79eda5b12403e20efd75d7ad12">cell_block_shift</a> = 12,
<a name="l00533"></a><a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a2b69b8fd3a4b8fe4899126adfdbce2bd">00533</a>             <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a2b69b8fd3a4b8fe4899126adfdbce2bd">cell_block_size</a>  = 1 &lt;&lt; <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ab2f6ca79eda5b12403e20efd75d7ad12">cell_block_shift</a>,
<a name="l00534"></a><a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a26eb73ee11c1876024caeafd384dac74">00534</a>             <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a26eb73ee11c1876024caeafd384dac74">cell_block_mask</a>  = <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a2b69b8fd3a4b8fe4899126adfdbce2bd">cell_block_size</a> - 1,
<a name="l00535"></a><a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ae0885b96db2b7b538c096fa0198591ae">00535</a>             <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ae0885b96db2b7b538c096fa0198591ae">cell_block_pool</a>  = 256,
<a name="l00536"></a><a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13adb1ac9a1f5dd1aa6f21bf57ec80ca666">00536</a>             <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13adb1ac9a1f5dd1aa6f21bf57ec80ca666">cell_block_limit</a> = 1024
<a name="l00537"></a>00537         };
<a name="l00538"></a>00538 
<a name="l00539"></a>00539     <span class="keyword">public</span>:
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <a class="code" href="classagg_1_1outline.html#a985c82c07e08a9a2f6c1a5a3e8096ac4">~outline</a>();
<a name="l00542"></a>00542         <a class="code" href="classagg_1_1outline.html#a6e872ce81a994ff434be842eb665faf1">outline</a>();
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#ab76e038abe2fdde87690e08b5f04d11f">reset</a>();
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a6d7acd19ef36d1f976f449132dd03a54">move_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
<a name="l00547"></a>00547         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">line_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="classagg_1_1outline.html#a65070c2ef1e07fa688fb20d4e9b59f31">00549</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1outline.html#a65070c2ef1e07fa688fb20d4e9b59f31">min_x</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a>; }
<a name="l00550"></a><a class="code" href="classagg_1_1outline.html#a15f853549e1f5c712bfdba36b4e426f9">00550</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1outline.html#a15f853549e1f5c712bfdba36b4e426f9">min_y</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a>; }
<a name="l00551"></a><a class="code" href="classagg_1_1outline.html#a4211b2cac615642ed60bdd471a1ce241">00551</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1outline.html#a4211b2cac615642ed60bdd471a1ce241">max_x</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a>; }
<a name="l00552"></a><a class="code" href="classagg_1_1outline.html#a3e038d87c287553461e1b6e0303de602">00552</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1outline.html#a3e038d87c287553461e1b6e0303de602">max_y</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a>; }
<a name="l00553"></a>00553 
<a name="l00554"></a><a class="code" href="classagg_1_1outline.html#ae9de12597ec54d71a5566f5183ca4125">00554</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1outline.html#ae9de12597ec54d71a5566f5183ca4125">num_cells</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>; }
<a name="l00555"></a>00555         <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* <span class="keyword">const</span>* <a class="code" href="classagg_1_1outline.html#a44752016da5a9c3b091a57de5c2ee03d">cells</a>();
<a name="l00556"></a>00556 
<a name="l00557"></a>00557     <span class="keyword">private</span>:
<a name="l00558"></a>00558         <a class="code" href="classagg_1_1outline.html#a6e872ce81a994ff434be842eb665faf1">outline</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1outline.html">outline</a>&amp;);
<a name="l00559"></a>00559         <span class="keyword">const</span> <a class="code" href="classagg_1_1outline.html">outline</a>&amp; <a class="code" href="classagg_1_1outline.html#a69f5d3cebd3b171c18e8a0a64b0d4404">operator = </a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1outline.html">outline</a>&amp;);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);
<a name="l00562"></a>00562         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a94571c0444e2018c6d7a76770128a7c7">add_cur_cell</a>();
<a name="l00563"></a>00563         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#aa23dcda8ba406b8d5faae9f9db9b4a89">sort_cells</a>();
<a name="l00564"></a>00564         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">render_scanline</a>(<span class="keywordtype">int</span> ey, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2);
<a name="l00565"></a>00565         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a5bf6aa6d214f5dc8ab8e19c06e43c7ed">render_line</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2);
<a name="l00566"></a>00566         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a2b97900069b6de62a8addff037ba967a">allocate_block</a>();
<a name="l00567"></a>00567         
<a name="l00568"></a>00568         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a7a3d96ac419b40b2208607a58efcb077">qsort_cells</a>(<a class="code" href="structagg_1_1cell.html">cell</a>** start, <span class="keywordtype">unsigned</span> num);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keyword">private</span>:
<a name="l00571"></a><a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">00571</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a>;
<a name="l00572"></a><a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">00572</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">m_max_blocks</a>;
<a name="l00573"></a><a class="code" href="classagg_1_1outline.html#ade72b351355113c250d678d977b4426c">00573</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#ade72b351355113c250d678d977b4426c">m_cur_block</a>;
<a name="l00574"></a><a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">00574</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>;
<a name="l00575"></a><a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">00575</a>         <a class="code" href="structagg_1_1cell.html">cell</a>**    <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>;
<a name="l00576"></a><a class="code" href="classagg_1_1outline.html#a0e803aab5a705d41c269b03aba6c2e57">00576</a>         <a class="code" href="structagg_1_1cell.html">cell</a>*     <a class="code" href="classagg_1_1outline.html#a0e803aab5a705d41c269b03aba6c2e57">m_cur_cell_ptr</a>;
<a name="l00577"></a><a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">00577</a>         <a class="code" href="structagg_1_1cell.html">cell</a>**    <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>;
<a name="l00578"></a><a class="code" href="classagg_1_1outline.html#a2fe8275c30d2c664f235bbbad487e5c7">00578</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#a2fe8275c30d2c664f235bbbad487e5c7">m_sorted_size</a>;
<a name="l00579"></a><a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">00579</a>         <a class="code" href="structagg_1_1cell.html">cell</a>      <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>;
<a name="l00580"></a><a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">00580</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a>;
<a name="l00581"></a><a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">00581</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">m_cur_y</a>;
<a name="l00582"></a><a class="code" href="classagg_1_1outline.html#a27deca183262a4b60b860d970380f32c">00582</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a27deca183262a4b60b860d970380f32c">m_close_x</a>;
<a name="l00583"></a><a class="code" href="classagg_1_1outline.html#a1a0ed09a0974bc1351de6e8c350c832b">00583</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a1a0ed09a0974bc1351de6e8c350c832b">m_close_y</a>;
<a name="l00584"></a><a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">00584</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a>;
<a name="l00585"></a><a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">00585</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a>;
<a name="l00586"></a><a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">00586</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a>;
<a name="l00587"></a><a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">00587</a>         <span class="keywordtype">int</span>       <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a>;
<a name="l00588"></a><a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">00588</a>         <span class="keywordtype">unsigned</span>  <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a>;
<a name="l00589"></a>00589     };
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00593"></a><a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3">00593</a>     <span class="keyword">enum</span> <a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3">filling_rule_e</a>
<a name="l00594"></a>00594     {
<a name="l00595"></a><a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a39764d24a08a13a158468d4fac9269c8">00595</a>         <a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a39764d24a08a13a158468d4fac9269c8">fill_non_zero</a>,
<a name="l00596"></a><a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a3200d5b4d1425ef6ebbe1fec746321b4">00596</a>         <a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a3200d5b4d1425ef6ebbe1fec746321b4">fill_even_odd</a>
<a name="l00597"></a>00597     };
<a name="l00598"></a>00598     
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <span class="comment">//========================================================================</span>
<a name="l00601"></a>00601     <span class="comment">// Polygon rasterizer that is used to render filled polygons with </span>
<a name="l00602"></a>00602     <span class="comment">// high-quality Anti-Aliasing. Internally, by default, the class uses </span>
<a name="l00603"></a>00603     <span class="comment">// integer coordinates in format 24.8, i.e. 24 bits for integer part </span>
<a name="l00604"></a>00604     <span class="comment">// and 8 bits for fractional - see poly_base_shift. This class can be </span>
<a name="l00605"></a>00605     <span class="comment">// used in the following  way:</span>
<a name="l00606"></a>00606     <span class="comment">//</span>
<a name="l00607"></a>00607     <span class="comment">// 1. filling_rule(filling_rule_e ft) - optional.</span>
<a name="l00608"></a>00608     <span class="comment">//</span>
<a name="l00609"></a>00609     <span class="comment">// 2. gamma() - optional.</span>
<a name="l00610"></a>00610     <span class="comment">//</span>
<a name="l00611"></a>00611     <span class="comment">// 3. reset()</span>
<a name="l00612"></a>00612     <span class="comment">//</span>
<a name="l00613"></a>00613     <span class="comment">// 4. move_to(x, y) / line_to(x, y) - make the polygon. One can create </span>
<a name="l00614"></a>00614     <span class="comment">//    more than one contour, but each contour must consist of at least 3</span>
<a name="l00615"></a>00615     <span class="comment">//    vertices, i.e. move_to(x1, y1); line_to(x2, y2); line_to(x3, y3);</span>
<a name="l00616"></a>00616     <span class="comment">//    is the absolute minimum of vertices that define a triangle.</span>
<a name="l00617"></a>00617     <span class="comment">//    The algorithm does not check either the number of vertices nor</span>
<a name="l00618"></a>00618     <span class="comment">//    coincidence of their coordinates, but in the worst case it just </span>
<a name="l00619"></a>00619     <span class="comment">//    won&#39;t draw anything.</span>
<a name="l00620"></a>00620     <span class="comment">//    The orger of the vertices (clockwise or counterclockwise) </span>
<a name="l00621"></a>00621     <span class="comment">//    is important when using the non-zero filling rule (fill_non_zero).</span>
<a name="l00622"></a>00622     <span class="comment">//    In this case the vertex order of all the contours must be the same</span>
<a name="l00623"></a>00623     <span class="comment">//    if you want your intersecting polygons to be without &quot;holes&quot;.</span>
<a name="l00624"></a>00624     <span class="comment">//    You actually can use different vertices order. If the contours do not </span>
<a name="l00625"></a>00625     <span class="comment">//    intersect each other the order is not important anyway. If they do, </span>
<a name="l00626"></a>00626     <span class="comment">//    contours with the same vertex order will be rendered without &quot;holes&quot; </span>
<a name="l00627"></a>00627     <span class="comment">//    while the intersecting contours with different orders will have &quot;holes&quot;.</span>
<a name="l00628"></a>00628     <span class="comment">//</span>
<a name="l00629"></a>00629     <span class="comment">// filling_rule() and gamma() can be called anytime before &quot;sweeping&quot;.</span>
<a name="l00630"></a>00630     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l00631"></a><a class="code" href="classagg_1_1rasterizer.html">00631</a>     <span class="keyword">class </span><a class="code" href="classagg_1_1rasterizer.html">rasterizer</a>
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633     <span class="keyword">public</span>:
<a name="l00634"></a>00634         <span class="keyword">enum</span>
<a name="l00635"></a>00635         {
<a name="l00636"></a><a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a96c97772304abbf2f859adc225b543f6">00636</a>             <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a96c97772304abbf2f859adc225b543f6">aa_shift</a> = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a96c97772304abbf2f859adc225b543f6">scanline::aa_shift</a>,
<a name="l00637"></a><a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a3d3d54a92c3670c1dfb7fb6a9aa817fd">00637</a>             <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a3d3d54a92c3670c1dfb7fb6a9aa817fd">aa_num</a>   = 1 &lt;&lt; <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a96c97772304abbf2f859adc225b543f6">aa_shift</a>,
<a name="l00638"></a><a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a260e748d76cb8d7e774c6f34c4d1d412">00638</a>             <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a260e748d76cb8d7e774c6f34c4d1d412">aa_mask</a>  = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a3d3d54a92c3670c1dfb7fb6a9aa817fd">aa_num</a> - 1,
<a name="l00639"></a><a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3afa33e965a90ca5ac13ec1cbc2c0bd877">00639</a>             <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3afa33e965a90ca5ac13ec1cbc2c0bd877">aa_2num</a>  = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a3d3d54a92c3670c1dfb7fb6a9aa817fd">aa_num</a> * 2,
<a name="l00640"></a><a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a6ae14c88089eb588566fbe26c0d3c708">00640</a>             <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a6ae14c88089eb588566fbe26c0d3c708">aa_2mask</a> = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3afa33e965a90ca5ac13ec1cbc2c0bd877">aa_2num</a> - 1
<a name="l00641"></a>00641         };
<a name="l00642"></a>00642 
<a name="l00643"></a><a class="code" href="classagg_1_1rasterizer.html#ac5b56b8e1183618bb4e098bf34c2ab18">00643</a>         <a class="code" href="classagg_1_1rasterizer.html#ac5b56b8e1183618bb4e098bf34c2ab18">rasterizer</a>() :
<a name="l00644"></a>00644             <a class="code" href="classagg_1_1rasterizer.html#a4246263df2d7b08fcfec11e084a83770">m_filling_rule</a>(<a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a39764d24a08a13a158468d4fac9269c8">fill_non_zero</a>)
<a name="l00645"></a>00645         {
<a name="l00646"></a>00646             memcpy(<a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>, <a class="code" href="classagg_1_1rasterizer.html#ab5b3fced8d2c91f083544e1d09cca489">s_default_gamma</a>, <span class="keyword">sizeof</span>(<a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>));
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00650"></a><a class="code" href="classagg_1_1rasterizer.html#aa43068c6f1948cf1aa1b4afef9e4861c">00650</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa43068c6f1948cf1aa1b4afef9e4861c">reset</a>() { <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#ab76e038abe2fdde87690e08b5f04d11f">reset</a>(); }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00653"></a><a class="code" href="classagg_1_1rasterizer.html#a4066e5ce5da33f453e0307b59fb8177b">00653</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#a4066e5ce5da33f453e0307b59fb8177b">filling_rule</a>(<a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3">filling_rule_e</a> <a class="code" href="classagg_1_1rasterizer.html#a4066e5ce5da33f453e0307b59fb8177b">filling_rule</a>) 
<a name="l00654"></a>00654         { 
<a name="l00655"></a>00655             <a class="code" href="classagg_1_1rasterizer.html#a4246263df2d7b08fcfec11e084a83770">m_filling_rule</a> = <a class="code" href="classagg_1_1rasterizer.html#a4066e5ce5da33f453e0307b59fb8177b">filling_rule</a>; 
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00659"></a>00659         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa4384b0f123ff4fc0eff7b7b6ab62b9f">gamma</a>(<span class="keywordtype">double</span> g);
<a name="l00660"></a>00660         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa4384b0f123ff4fc0eff7b7b6ab62b9f">gamma</a>(<span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>* g);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00663"></a><a class="code" href="classagg_1_1rasterizer.html#a065aa1644e1a80138b83f5c6852de216">00663</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#a065aa1644e1a80138b83f5c6852de216">move_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) { <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a6d7acd19ef36d1f976f449132dd03a54">move_to</a>(x, y); }
<a name="l00664"></a><a class="code" href="classagg_1_1rasterizer.html#a9d17d31a9cc02218d713fac4e51a10d6">00664</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#a9d17d31a9cc02218d713fac4e51a10d6">line_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y) { <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">line_to</a>(x, y); }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00667"></a><a class="code" href="classagg_1_1rasterizer.html#a731b52aa19c0ed270539c10cca8c59c7">00667</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#a731b52aa19c0ed270539c10cca8c59c7">move_to_d</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) { <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a6d7acd19ef36d1f976f449132dd03a54">move_to</a>(<a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">poly_coord</a>(x), 
<a name="l00668"></a>00668                                                                <a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">poly_coord</a>(y)); }
<a name="l00669"></a><a class="code" href="classagg_1_1rasterizer.html#aa5a08b471671fb8f904ff2c796486e47">00669</a>         <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa5a08b471671fb8f904ff2c796486e47">line_to_d</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) { <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">line_to</a>(<a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">poly_coord</a>(x), 
<a name="l00670"></a>00670                                                                <a class="code" href="namespaceagg.html#afe2650780973937a3194b67fae1738a9">poly_coord</a>(y)); }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00673"></a><a class="code" href="classagg_1_1rasterizer.html#a9334ecd8ee4ac9184db11c3f262177d4">00673</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1rasterizer.html#a9334ecd8ee4ac9184db11c3f262177d4">min_x</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a65070c2ef1e07fa688fb20d4e9b59f31">min_x</a>(); }
<a name="l00674"></a><a class="code" href="classagg_1_1rasterizer.html#ac262dd36bc05a7ff6956a9f09c1c3b3a">00674</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1rasterizer.html#ac262dd36bc05a7ff6956a9f09c1c3b3a">min_y</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a15f853549e1f5c712bfdba36b4e426f9">min_y</a>(); }
<a name="l00675"></a><a class="code" href="classagg_1_1rasterizer.html#a5c88370e58fa89c5e8f83d397fec50bd">00675</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1rasterizer.html#a5c88370e58fa89c5e8f83d397fec50bd">max_x</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a4211b2cac615642ed60bdd471a1ce241">max_x</a>(); }
<a name="l00676"></a><a class="code" href="classagg_1_1rasterizer.html#ae4e429cef1db4bccbe3efc27f7986d10">00676</a>         <span class="keywordtype">int</span> <a class="code" href="classagg_1_1rasterizer.html#ae4e429cef1db4bccbe3efc27f7986d10">max_y</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a3e038d87c287553461e1b6e0303de602">max_y</a>(); }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00679"></a><a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">00679</a>         <span class="keywordtype">unsigned</span> <a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">calculate_alpha</a>(<span class="keywordtype">int</span> area)<span class="keyword"> const</span>
<a name="l00680"></a>00680 <span class="keyword">        </span>{
<a name="l00681"></a>00681             <span class="keywordtype">int</span> cover = area &gt;&gt; (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>*2 + 1 - <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a96c97772304abbf2f859adc225b543f6">aa_shift</a>);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683             <span class="keywordflow">if</span>(cover &lt; 0) cover = -cover;
<a name="l00684"></a>00684             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a4246263df2d7b08fcfec11e084a83770">m_filling_rule</a> == <a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3a3200d5b4d1425ef6ebbe1fec746321b4">fill_even_odd</a>)
<a name="l00685"></a>00685             {
<a name="l00686"></a>00686                 cover &amp;= <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a6ae14c88089eb588566fbe26c0d3c708">aa_2mask</a>;
<a name="l00687"></a>00687                 <span class="keywordflow">if</span>(cover &gt; <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a3d3d54a92c3670c1dfb7fb6a9aa817fd">aa_num</a>)
<a name="l00688"></a>00688                 {
<a name="l00689"></a>00689                     cover = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3afa33e965a90ca5ac13ec1cbc2c0bd877">aa_2num</a> - cover;
<a name="l00690"></a>00690                 }
<a name="l00691"></a>00691             }
<a name="l00692"></a>00692             <span class="keywordflow">if</span>(cover &gt; <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a260e748d76cb8d7e774c6f34c4d1d412">aa_mask</a>) cover = <a class="code" href="classagg_1_1rasterizer.html#a61b8e567506b8a1e5de44028d666acc3a260e748d76cb8d7e774c6f34c4d1d412">aa_mask</a>;
<a name="l00693"></a>00693             <span class="keywordflow">return</span> cover;
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00697"></a><a class="code" href="classagg_1_1rasterizer.html#af43784f2f33d9a18969b6a4a95aed73c">00697</a>         <span class="keyword">template</span>&lt;<span class="keyword">class</span> Renderer&gt; <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#af43784f2f33d9a18969b6a4a95aed73c">render</a>(Renderer&amp; r, 
<a name="l00698"></a>00698                                              <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c, 
<a name="l00699"></a>00699                                              <span class="keywordtype">int</span> dx=0, 
<a name="l00700"></a>00700                                              <span class="keywordtype">int</span> dy=0)
<a name="l00701"></a>00701         {
<a name="l00702"></a>00702             <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* <span class="keyword">const</span>* cells = <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a44752016da5a9c3b091a57de5c2ee03d">cells</a>();
<a name="l00703"></a>00703             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#ae9de12597ec54d71a5566f5183ca4125">num_cells</a>() == 0) <span class="keywordflow">return</span>;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705             <span class="keywordtype">int</span> x, y;
<a name="l00706"></a>00706             <span class="keywordtype">int</span> cover;
<a name="l00707"></a>00707             <span class="keywordtype">int</span> alpha;
<a name="l00708"></a>00708             <span class="keywordtype">int</span> area;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710             <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#ae545a2e89b9e5be9003158071ab8adab">reset</a>(<a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a65070c2ef1e07fa688fb20d4e9b59f31">min_x</a>(), <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a4211b2cac615642ed60bdd471a1ce241">max_x</a>(), dx, dy);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712             cover = 0;
<a name="l00713"></a>00713             <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* cur_cell = *cells++;
<a name="l00714"></a>00714             <span class="keywordflow">for</span>(;;)
<a name="l00715"></a>00715             {
<a name="l00716"></a>00716                 <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* start_cell = cur_cell;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718                 <span class="keywordtype">int</span> coord  = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a>;
<a name="l00719"></a>00719                 x = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a>;
<a name="l00720"></a>00720                 y = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a>;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                 area   = start_cell-&gt;<a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a>;
<a name="l00723"></a>00723                 cover += start_cell-&gt;<a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725                 <span class="comment">//accumulate all start cells</span>
<a name="l00726"></a>00726                 <span class="keywordflow">while</span>((cur_cell = *cells++) != 0)
<a name="l00727"></a>00727                 {
<a name="l00728"></a>00728                     <span class="keywordflow">if</span>(cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a> != coord) <span class="keywordflow">break</span>;
<a name="l00729"></a>00729                     area  += cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a>;
<a name="l00730"></a>00730                     cover += cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>;
<a name="l00731"></a>00731                 }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733                 <span class="keywordflow">if</span>(area)
<a name="l00734"></a>00734                 {
<a name="l00735"></a>00735                     alpha = <a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">calculate_alpha</a>((cover &lt;&lt; (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a> + 1)) - area);
<a name="l00736"></a>00736                     <span class="keywordflow">if</span>(alpha)
<a name="l00737"></a>00737                     {
<a name="l00738"></a>00738                         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#a2c7b0f238a4e060d8ec5a7ba57f4f59d">is_ready</a>(y))
<a name="l00739"></a>00739                         {
<a name="l00740"></a>00740                             r.render(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>, c);
<a name="l00741"></a>00741                             <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#aaff3394c2b5f58bce11cf658c1afd19f">reset_spans</a>();
<a name="l00742"></a>00742                         }
<a name="l00743"></a>00743                         <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#aec8e0033da21d69abe903611677c92b7">add_cell</a>(x, y, <a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>[alpha]);
<a name="l00744"></a>00744                     }
<a name="l00745"></a>00745                     x++;
<a name="l00746"></a>00746                 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748                 <span class="keywordflow">if</span>(!cur_cell) <span class="keywordflow">break</span>;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750                 <span class="keywordflow">if</span>(cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a> &gt; x)
<a name="l00751"></a>00751                 {
<a name="l00752"></a>00752                     alpha = <a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">calculate_alpha</a>(cover &lt;&lt; (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a> + 1));
<a name="l00753"></a>00753                     <span class="keywordflow">if</span>(alpha)
<a name="l00754"></a>00754                     {
<a name="l00755"></a>00755                         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#a2c7b0f238a4e060d8ec5a7ba57f4f59d">is_ready</a>(y))
<a name="l00756"></a>00756                         {
<a name="l00757"></a>00757                             r.render(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>, c);
<a name="l00758"></a>00758                             <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#aaff3394c2b5f58bce11cf658c1afd19f">reset_spans</a>();
<a name="l00759"></a>00759                         }
<a name="l00760"></a>00760                         <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#ad232ee623d33b3a5ddb59555879db4b1">add_span</a>(x, y, 
<a name="l00761"></a>00761                                             cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a> - x, 
<a name="l00762"></a>00762                                             <a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>[alpha]);
<a name="l00763"></a>00763                     }
<a name="l00764"></a>00764                 }
<a name="l00765"></a>00765             } 
<a name="l00766"></a>00766         
<a name="l00767"></a>00767             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>.<a class="code" href="classagg_1_1scanline.html#aae24eee0e299f4eb923413ef15743e16">num_spans</a>())
<a name="l00768"></a>00768             {
<a name="l00769"></a>00769                 r.render(<a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>, c);
<a name="l00770"></a>00770             }
<a name="l00771"></a>00771         }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00775"></a>00775         <span class="keywordtype">bool</span> <a class="code" href="classagg_1_1rasterizer.html#aea20152b4f05c38fb5d2af9dee38ec02">hit_test</a>(<span class="keywordtype">int</span> tx, <span class="keywordtype">int</span> ty);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="keyword">private</span>:
<a name="l00778"></a>00778         <a class="code" href="classagg_1_1rasterizer.html#ac5b56b8e1183618bb4e098bf34c2ab18">rasterizer</a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1rasterizer.html">rasterizer</a>&amp;);
<a name="l00779"></a>00779         <span class="keyword">const</span> <a class="code" href="classagg_1_1rasterizer.html">rasterizer</a>&amp; <a class="code" href="classagg_1_1rasterizer.html#a065649303168e91ecae11e57e55c5208">operator = </a>(<span class="keyword">const</span> <a class="code" href="classagg_1_1rasterizer.html">rasterizer</a>&amp;);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="keyword">private</span>:
<a name="l00782"></a><a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">00782</a>         <a class="code" href="classagg_1_1outline.html">outline</a>        <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>;
<a name="l00783"></a><a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">00783</a>         <a class="code" href="classagg_1_1scanline.html">scanline</a>       <a class="code" href="classagg_1_1rasterizer.html#a3f97f4567f490b6e750bcb33e8a395ca">m_scanline</a>;
<a name="l00784"></a><a class="code" href="classagg_1_1rasterizer.html#a4246263df2d7b08fcfec11e084a83770">00784</a>         <a class="code" href="namespaceagg.html#afed98fcb6e27bd6667abd5f6a1a587c3">filling_rule_e</a> <a class="code" href="classagg_1_1rasterizer.html#a4246263df2d7b08fcfec11e084a83770">m_filling_rule</a>;
<a name="l00785"></a><a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">00785</a>         <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>          <a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>[256];
<a name="l00786"></a><a class="code" href="classagg_1_1rasterizer.html#ab5b3fced8d2c91f083544e1d09cca489">00786</a>         <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="classagg_1_1rasterizer.html#ab5b3fced8d2c91f083544e1d09cca489">s_default_gamma</a>[256];     
<a name="l00787"></a>00787     };
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <span class="comment">//========================================================================</span>
<a name="l00791"></a><a class="code" href="structagg_1_1span__mono8.html">00791</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__mono8.html">span_mono8</a>
<a name="l00792"></a>00792     {
<a name="l00793"></a>00793         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00794"></a><a class="code" href="structagg_1_1span__mono8.html#a39794708960199522852127626514981">00794</a>         <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="structagg_1_1span__mono8.html#a39794708960199522852127626514981">mono8</a>(<span class="keywordtype">unsigned</span> r, <span class="keywordtype">unsigned</span> g, <span class="keywordtype">unsigned</span> b)
<a name="l00795"></a>00795         {
<a name="l00796"></a>00796             <span class="keywordflow">return</span> (r * 77 + g * 150 + b * 29) &gt;&gt; 8;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00800"></a><a class="code" href="structagg_1_1span__mono8.html#ad3e3764b0d00afd2ceed4e9e0f04497d">00800</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__mono8.html#ad3e3764b0d00afd2ceed4e9e0f04497d">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00801"></a>00801                            <span class="keywordtype">int</span> x,
<a name="l00802"></a>00802                            <span class="keywordtype">unsigned</span> count, 
<a name="l00803"></a>00803                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l00804"></a>00804                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00805"></a>00805         {
<a name="l00806"></a>00806             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x;
<a name="l00807"></a>00807             <span class="keywordtype">unsigned</span> dst = <a class="code" href="structagg_1_1span__mono8.html#a39794708960199522852127626514981">mono8</a>(c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>, c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>, c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>);
<a name="l00808"></a>00808             <span class="keywordflow">do</span>
<a name="l00809"></a>00809             {
<a name="l00810"></a>00810                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l00811"></a>00811                 <span class="keywordtype">unsigned</span> src = *p;
<a name="l00812"></a>00812                 *p++ = (((dst - src) * alpha) + (src &lt;&lt; 16)) &gt;&gt; 16;
<a name="l00813"></a>00813             }
<a name="l00814"></a>00814             <span class="keywordflow">while</span>(--count);
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00818"></a><a class="code" href="structagg_1_1span__mono8.html#aa2a2557a54d6f6ddef5882433278dee6">00818</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__mono8.html#aa2a2557a54d6f6ddef5882433278dee6">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00819"></a>00819                           <span class="keywordtype">int</span> x,
<a name="l00820"></a>00820                           <span class="keywordtype">unsigned</span> count, 
<a name="l00821"></a>00821                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00822"></a>00822         {
<a name="l00823"></a>00823             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x;
<a name="l00824"></a>00824             <span class="keywordtype">unsigned</span> v = <a class="code" href="structagg_1_1span__mono8.html#a39794708960199522852127626514981">mono8</a>(c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>, c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>, c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>);
<a name="l00825"></a>00825             <span class="keywordflow">do</span> { *p++ = v; } <span class="keywordflow">while</span>(--count);
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00829"></a><a class="code" href="structagg_1_1span__mono8.html#a86a891a98d9724b246a8ec04bd663725">00829</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l00830"></a>00830         {
<a name="l00831"></a>00831             <span class="keywordtype">unsigned</span> rgb = ptr[x];
<a name="l00832"></a>00832             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l00833"></a>00833             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = rgb; 
<a name="l00834"></a>00834             c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = rgb; 
<a name="l00835"></a>00835             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = rgb;
<a name="l00836"></a>00836             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = 255;
<a name="l00837"></a>00837             <span class="keywordflow">return</span> c;
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839     };
<a name="l00840"></a>00840 
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 
<a name="l00843"></a>00843     <span class="comment">//========================================================================</span>
<a name="l00844"></a><a class="code" href="structagg_1_1span__rgb555.html">00844</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__rgb555.html">span_rgb555</a>
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00847"></a><a class="code" href="structagg_1_1span__rgb555.html#a74b73d0870269f00fcafcfe74bffc3fe">00847</a>         <span class="keyword">static</span> <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a> <a class="code" href="structagg_1_1span__rgb555.html#a74b73d0870269f00fcafcfe74bffc3fe">rgb555</a>(<span class="keywordtype">unsigned</span> r, <span class="keywordtype">unsigned</span> g, <span class="keywordtype">unsigned</span> b)
<a name="l00848"></a>00848         {
<a name="l00849"></a>00849             <span class="keywordflow">return</span> ((r &amp; 0xF8) &lt;&lt; 7) | ((g &amp; 0xF8) &lt;&lt; 2) | (b &gt;&gt; 3);
<a name="l00850"></a>00850         }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00853"></a><a class="code" href="structagg_1_1span__rgb555.html#ae5390cc335b454ec653010bc80fa965e">00853</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb555.html#ae5390cc335b454ec653010bc80fa965e">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00854"></a>00854                            <span class="keywordtype">int</span> x,
<a name="l00855"></a>00855                            <span class="keywordtype">unsigned</span> count, 
<a name="l00856"></a>00856                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l00857"></a>00857                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00858"></a>00858         {
<a name="l00859"></a>00859             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>* p = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr) + x;
<a name="l00860"></a>00860             <span class="keywordflow">do</span>
<a name="l00861"></a>00861             {
<a name="l00862"></a>00862                 <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a> rgb = *p;
<a name="l00863"></a>00863                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865                 <span class="keywordtype">int</span> r = (rgb &gt;&gt; 7) &amp; 0xF8;
<a name="l00866"></a>00866                 <span class="keywordtype">int</span> g = (rgb &gt;&gt; 2) &amp; 0xF8;
<a name="l00867"></a>00867                 <span class="keywordtype">int</span> b = (rgb &lt;&lt; 3) &amp; 0xF8;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869                 *p++ = (((((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 9) &amp; 0x7C00) |
<a name="l00870"></a>00870                        (((((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 14) &amp; 0x3E0) |
<a name="l00871"></a>00871                         ((((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 19);
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873             <span class="keywordflow">while</span>(--count);
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00877"></a><a class="code" href="structagg_1_1span__rgb555.html#a4074753eac45076093c0717acb0c9301">00877</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb555.html#a4074753eac45076093c0717acb0c9301">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00878"></a>00878                           <span class="keywordtype">int</span> x,
<a name="l00879"></a>00879                           <span class="keywordtype">unsigned</span> count, 
<a name="l00880"></a>00880                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00881"></a>00881         {
<a name="l00882"></a>00882             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>* p = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr) + x;
<a name="l00883"></a>00883             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>  v = <a class="code" href="structagg_1_1span__rgb555.html#a74b73d0870269f00fcafcfe74bffc3fe">rgb555</a>(c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>, c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>, c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>);
<a name="l00884"></a>00884             <span class="keywordflow">do</span> { *p++ = v; } <span class="keywordflow">while</span>(--count);
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00888"></a><a class="code" href="structagg_1_1span__rgb555.html#a6e093b2c4aaf520d0753f7dbafbe2966">00888</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l00889"></a>00889         {
<a name="l00890"></a>00890             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a> rgb = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr)[x];
<a name="l00891"></a>00891             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l00892"></a>00892             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = (rgb &gt;&gt; 7) &amp; 0xF8; 
<a name="l00893"></a>00893             c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = (rgb &gt;&gt; 2) &amp; 0xF8; 
<a name="l00894"></a>00894             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = (rgb &lt;&lt; 3) &amp; 0xF8;
<a name="l00895"></a>00895             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = 255;
<a name="l00896"></a>00896             <span class="keywordflow">return</span> c;
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898     };
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 
<a name="l00901"></a>00901 
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="comment">//========================================================================</span>
<a name="l00904"></a><a class="code" href="structagg_1_1span__rgb565.html">00904</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__rgb565.html">span_rgb565</a>
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00907"></a><a class="code" href="structagg_1_1span__rgb565.html#a019910ca842d07c399e75bc9cc8d2947">00907</a>         <span class="keyword">static</span> <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a> <a class="code" href="structagg_1_1span__rgb565.html#a019910ca842d07c399e75bc9cc8d2947">rgb565</a>(<span class="keywordtype">unsigned</span> r, <span class="keywordtype">unsigned</span> g, <span class="keywordtype">unsigned</span> b)
<a name="l00908"></a>00908         {
<a name="l00909"></a>00909             <span class="keywordflow">return</span> ((r &amp; 0xF8) &lt;&lt; 8) | ((g &amp; 0xFC) &lt;&lt; 3) | (b &gt;&gt; 3);
<a name="l00910"></a>00910         }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00913"></a><a class="code" href="structagg_1_1span__rgb565.html#abbed0ea6c246b5ec7f212382454afddd">00913</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb565.html#abbed0ea6c246b5ec7f212382454afddd">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00914"></a>00914                            <span class="keywordtype">int</span> x,
<a name="l00915"></a>00915                            <span class="keywordtype">unsigned</span> count, 
<a name="l00916"></a>00916                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l00917"></a>00917                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00918"></a>00918         {
<a name="l00919"></a>00919             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>* p = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr) + x;
<a name="l00920"></a>00920             <span class="keywordflow">do</span>
<a name="l00921"></a>00921             {
<a name="l00922"></a>00922                 <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a> rgb = *p;
<a name="l00923"></a>00923                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925                 <span class="keywordtype">int</span> r = (rgb &gt;&gt; 8) &amp; 0xF8;
<a name="l00926"></a>00926                 <span class="keywordtype">int</span> g = (rgb &gt;&gt; 3) &amp; 0xFC;
<a name="l00927"></a>00927                 <span class="keywordtype">int</span> b = (rgb &lt;&lt; 3) &amp; 0xF8;
<a name="l00928"></a>00928 
<a name="l00929"></a>00929                 *p++ = (((((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 8) &amp; 0xF800) |
<a name="l00930"></a>00930                        (((((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 13) &amp; 0x7E0) |
<a name="l00931"></a>00931                         ((((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 19);
<a name="l00932"></a>00932             }
<a name="l00933"></a>00933             <span class="keywordflow">while</span>(--count);
<a name="l00934"></a>00934         }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00937"></a><a class="code" href="structagg_1_1span__rgb565.html#ac390bfd390f381e5c312c49e5e9dcdc2">00937</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb565.html#ac390bfd390f381e5c312c49e5e9dcdc2">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00938"></a>00938                           <span class="keywordtype">int</span> x,
<a name="l00939"></a>00939                           <span class="keywordtype">unsigned</span> count, 
<a name="l00940"></a>00940                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00941"></a>00941         {
<a name="l00942"></a>00942             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>* p = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr) + x;
<a name="l00943"></a>00943             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>  v = <a class="code" href="structagg_1_1span__rgb565.html#a019910ca842d07c399e75bc9cc8d2947">rgb565</a>(c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>, c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>, c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>);
<a name="l00944"></a>00944             <span class="keywordflow">do</span> { *p++ = v; } <span class="keywordflow">while</span>(--count);
<a name="l00945"></a>00945         }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00948"></a><a class="code" href="structagg_1_1span__rgb565.html#a4b7259c041741b1042060de2d9d22d70">00948</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l00949"></a>00949         {
<a name="l00950"></a>00950             <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a> rgb = ((<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>*)ptr)[x];
<a name="l00951"></a>00951             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l00952"></a>00952             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = (rgb &gt;&gt; 8) &amp; 0xF8; 
<a name="l00953"></a>00953             c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = (rgb &gt;&gt; 3) &amp; 0xFC; 
<a name="l00954"></a>00954             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = (rgb &lt;&lt; 3) &amp; 0xF8;
<a name="l00955"></a>00955             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = 255;
<a name="l00956"></a>00956             <span class="keywordflow">return</span> c;
<a name="l00957"></a>00957         }
<a name="l00958"></a>00958     };
<a name="l00959"></a>00959 
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 
<a name="l00962"></a>00962     <span class="comment">//========================================================================</span>
<a name="l00963"></a><a class="code" href="structagg_1_1span__bgr24.html">00963</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__bgr24.html">span_bgr24</a>
<a name="l00964"></a>00964     {
<a name="l00965"></a>00965         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00966"></a><a class="code" href="structagg_1_1span__bgr24.html#abda5136c1ad7410d2c0122055d7fdade">00966</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__bgr24.html#abda5136c1ad7410d2c0122055d7fdade">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00967"></a>00967                            <span class="keywordtype">int</span> x,
<a name="l00968"></a>00968                            <span class="keywordtype">unsigned</span> count, 
<a name="l00969"></a>00969                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l00970"></a>00970                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00971"></a>00971         {
<a name="l00972"></a>00972             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l00973"></a>00973             <span class="keywordflow">do</span>
<a name="l00974"></a>00974             {
<a name="l00975"></a>00975                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l00976"></a>00976                 <span class="keywordtype">int</span> b = p[0];
<a name="l00977"></a>00977                 <span class="keywordtype">int</span> g = p[1];
<a name="l00978"></a>00978                 <span class="keywordtype">int</span> r = p[2];
<a name="l00979"></a>00979                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l00980"></a>00980                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l00981"></a>00981                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l00982"></a>00982             }
<a name="l00983"></a>00983             <span class="keywordflow">while</span>(--count);
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00987"></a><a class="code" href="structagg_1_1span__bgr24.html#aefcbe9c7c5a483ec2839f6f1c5c2792d">00987</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__bgr24.html#aefcbe9c7c5a483ec2839f6f1c5c2792d">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l00988"></a>00988                           <span class="keywordtype">int</span> x,
<a name="l00989"></a>00989                           <span class="keywordtype">unsigned</span> count, 
<a name="l00990"></a>00990                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l00991"></a>00991         {
<a name="l00992"></a>00992             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l00993"></a>00993             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; } <span class="keywordflow">while</span>(--count);
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l00997"></a><a class="code" href="structagg_1_1span__bgr24.html#ae325171fe38a0618f25228d8d535f15d">00997</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l00998"></a>00998         {
<a name="l00999"></a>00999             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l01000"></a>01000             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01001"></a>01001             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = *p++; 
<a name="l01002"></a>01002             c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = *p++; 
<a name="l01003"></a>01003             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = *p++;
<a name="l01004"></a>01004             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = 255;
<a name="l01005"></a>01005             <span class="keywordflow">return</span> c;
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007     };
<a name="l01008"></a>01008 
<a name="l01009"></a>01009 
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="comment">//========================================================================</span>
<a name="l01012"></a><a class="code" href="structagg_1_1span__rgb24.html">01012</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__rgb24.html">span_rgb24</a>
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01015"></a><a class="code" href="structagg_1_1span__rgb24.html#a53a60008616f0d3e4c78526bb7d5e684">01015</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb24.html#a53a60008616f0d3e4c78526bb7d5e684">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01016"></a>01016                            <span class="keywordtype">int</span> x,
<a name="l01017"></a>01017                            <span class="keywordtype">unsigned</span> count, 
<a name="l01018"></a>01018                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l01019"></a>01019                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01020"></a>01020         {
<a name="l01021"></a>01021             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l01022"></a>01022             <span class="keywordflow">do</span>
<a name="l01023"></a>01023             {
<a name="l01024"></a>01024                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l01025"></a>01025                 <span class="keywordtype">int</span> r = p[0];
<a name="l01026"></a>01026                 <span class="keywordtype">int</span> g = p[1];
<a name="l01027"></a>01027                 <span class="keywordtype">int</span> b = p[2];
<a name="l01028"></a>01028                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01029"></a>01029                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01030"></a>01030                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01031"></a>01031             }
<a name="l01032"></a>01032             <span class="keywordflow">while</span>(--count);
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01036"></a><a class="code" href="structagg_1_1span__rgb24.html#ae3a56b77f4b2613af6caea44122368c7">01036</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgb24.html#ae3a56b77f4b2613af6caea44122368c7">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01037"></a>01037                           <span class="keywordtype">int</span> x,
<a name="l01038"></a>01038                           <span class="keywordtype">unsigned</span> count, 
<a name="l01039"></a>01039                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01040"></a>01040         {
<a name="l01041"></a>01041             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l01042"></a>01042             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; } <span class="keywordflow">while</span>(--count);
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01046"></a><a class="code" href="structagg_1_1span__rgb24.html#a293dbd6b7c802bf1fda65f7e409a6e74">01046</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l01047"></a>01047         {
<a name="l01048"></a>01048             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + x + x + x;
<a name="l01049"></a>01049             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01050"></a>01050             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = *p++; 
<a name="l01051"></a>01051             c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> = *p++; 
<a name="l01052"></a>01052             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = *p++;
<a name="l01053"></a>01053             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = 255;
<a name="l01054"></a>01054             <span class="keywordflow">return</span> c;
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056     };
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="comment">//========================================================================</span>
<a name="l01061"></a><a class="code" href="structagg_1_1span__abgr32.html">01061</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__abgr32.html">span_abgr32</a>
<a name="l01062"></a>01062     {
<a name="l01063"></a>01063         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01064"></a><a class="code" href="structagg_1_1span__abgr32.html#a1b78630b5467bc1145f2f6d7a32f2463">01064</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__abgr32.html#a1b78630b5467bc1145f2f6d7a32f2463">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01065"></a>01065                            <span class="keywordtype">int</span> x,
<a name="l01066"></a>01066                            <span class="keywordtype">unsigned</span> count, 
<a name="l01067"></a>01067                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l01068"></a>01068                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01069"></a>01069         {
<a name="l01070"></a>01070             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01071"></a>01071             <span class="keywordflow">do</span>
<a name="l01072"></a>01072             {
<a name="l01073"></a>01073                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l01074"></a>01074                 <span class="keywordtype">int</span> a = p[0];
<a name="l01075"></a>01075                 <span class="keywordtype">int</span> b = p[1];
<a name="l01076"></a>01076                 <span class="keywordtype">int</span> g = p[2];
<a name="l01077"></a>01077                 <span class="keywordtype">int</span> r = p[3];
<a name="l01078"></a>01078                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> - a) * alpha) + (a &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01079"></a>01079                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01080"></a>01080                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01081"></a>01081                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01082"></a>01082             }
<a name="l01083"></a>01083             <span class="keywordflow">while</span>(--count);
<a name="l01084"></a>01084         }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01087"></a><a class="code" href="structagg_1_1span__abgr32.html#a7fc239f61abe2feb8d8c295b83704717">01087</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__abgr32.html#a7fc239f61abe2feb8d8c295b83704717">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01088"></a>01088                           <span class="keywordtype">int</span> x,
<a name="l01089"></a>01089                           <span class="keywordtype">unsigned</span> count, 
<a name="l01090"></a>01090                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01091"></a>01091         {
<a name="l01092"></a>01092             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01093"></a>01093             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; } <span class="keywordflow">while</span>(--count);
<a name="l01094"></a>01094         }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01097"></a><a class="code" href="structagg_1_1span__abgr32.html#ae143caa47a88e050addf452c2c02660d">01097</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l01098"></a>01098         {
<a name="l01099"></a>01099             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01100"></a>01100             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01101"></a>01101             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = *p++; 
<a name="l01102"></a>01102             c.b = *p++; 
<a name="l01103"></a>01103             c.g = *p++;
<a name="l01104"></a>01104             c.r = *p;
<a name="l01105"></a>01105             <span class="keywordflow">return</span> c;
<a name="l01106"></a>01106         }
<a name="l01107"></a>01107     };
<a name="l01108"></a>01108 
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     <span class="comment">//========================================================================</span>
<a name="l01113"></a><a class="code" href="structagg_1_1span__argb32.html">01113</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__argb32.html">span_argb32</a>
<a name="l01114"></a>01114     {
<a name="l01115"></a>01115         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01116"></a><a class="code" href="structagg_1_1span__argb32.html#adaf2f8da18424e3bdd556d8bb3c37ed4">01116</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__argb32.html#adaf2f8da18424e3bdd556d8bb3c37ed4">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01117"></a>01117                            <span class="keywordtype">int</span> x,
<a name="l01118"></a>01118                            <span class="keywordtype">unsigned</span> count, 
<a name="l01119"></a>01119                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l01120"></a>01120                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01121"></a>01121         {
<a name="l01122"></a>01122             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01123"></a>01123             <span class="keywordflow">do</span>
<a name="l01124"></a>01124             {
<a name="l01125"></a>01125                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l01126"></a>01126                 <span class="keywordtype">int</span> a = p[0];
<a name="l01127"></a>01127                 <span class="keywordtype">int</span> r = p[1];
<a name="l01128"></a>01128                 <span class="keywordtype">int</span> g = p[2];
<a name="l01129"></a>01129                 <span class="keywordtype">int</span> b = p[3];
<a name="l01130"></a>01130                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> - a) * alpha) + (a &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01131"></a>01131                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01132"></a>01132                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01133"></a>01133                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01134"></a>01134             }
<a name="l01135"></a>01135             <span class="keywordflow">while</span>(--count);
<a name="l01136"></a>01136         }
<a name="l01137"></a>01137 
<a name="l01138"></a>01138         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01139"></a><a class="code" href="structagg_1_1span__argb32.html#aa7e0f1b88ab3b089834e7fd72a2c0560">01139</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__argb32.html#aa7e0f1b88ab3b089834e7fd72a2c0560">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01140"></a>01140                           <span class="keywordtype">int</span> x,
<a name="l01141"></a>01141                           <span class="keywordtype">unsigned</span> count, 
<a name="l01142"></a>01142                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01143"></a>01143         {
<a name="l01144"></a>01144             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01145"></a>01145             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; } <span class="keywordflow">while</span>(--count);
<a name="l01146"></a>01146         }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01149"></a><a class="code" href="structagg_1_1span__argb32.html#aad31b5a20e8c9be4aec943cdc2aab082">01149</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l01150"></a>01150         {
<a name="l01151"></a>01151             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01152"></a>01152             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01153"></a>01153             c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> = *p++; 
<a name="l01154"></a>01154             c.r = *p++; 
<a name="l01155"></a>01155             c.g = *p++;
<a name="l01156"></a>01156             c.b = *p;
<a name="l01157"></a>01157             <span class="keywordflow">return</span> c;
<a name="l01158"></a>01158         }
<a name="l01159"></a>01159     };
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 
<a name="l01162"></a>01162 
<a name="l01163"></a>01163     <span class="comment">//========================================================================</span>
<a name="l01164"></a><a class="code" href="structagg_1_1span__bgra32.html">01164</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__bgra32.html">span_bgra32</a>
<a name="l01165"></a>01165     {
<a name="l01166"></a>01166         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01167"></a><a class="code" href="structagg_1_1span__bgra32.html#a48192b1cbbdb161ae60188832ea19f32">01167</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__bgra32.html#a48192b1cbbdb161ae60188832ea19f32">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01168"></a>01168                            <span class="keywordtype">int</span> x,
<a name="l01169"></a>01169                            <span class="keywordtype">unsigned</span> count, 
<a name="l01170"></a>01170                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l01171"></a>01171                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01172"></a>01172         {
<a name="l01173"></a>01173             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01174"></a>01174             <span class="keywordflow">do</span>
<a name="l01175"></a>01175             {
<a name="l01176"></a>01176                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l01177"></a>01177                 <span class="keywordtype">int</span> b = p[0];
<a name="l01178"></a>01178                 <span class="keywordtype">int</span> g = p[1];
<a name="l01179"></a>01179                 <span class="keywordtype">int</span> r = p[2];
<a name="l01180"></a>01180                 <span class="keywordtype">int</span> a = p[3];
<a name="l01181"></a>01181                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01182"></a>01182                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01183"></a>01183                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01184"></a>01184                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> - a) * alpha) + (a &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186             <span class="keywordflow">while</span>(--count);
<a name="l01187"></a>01187         }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01190"></a><a class="code" href="structagg_1_1span__bgra32.html#aa759ce6c120b3584a82bc685187b07d4">01190</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__bgra32.html#aa759ce6c120b3584a82bc685187b07d4">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01191"></a>01191                           <span class="keywordtype">int</span> x,
<a name="l01192"></a>01192                           <span class="keywordtype">unsigned</span> count, 
<a name="l01193"></a>01193                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01194"></a>01194         {
<a name="l01195"></a>01195             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01196"></a>01196             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>; } <span class="keywordflow">while</span>(--count);
<a name="l01197"></a>01197         }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01200"></a><a class="code" href="structagg_1_1span__bgra32.html#ab5f38319230d8c57ea1fba97ab51068d">01200</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l01201"></a>01201         {
<a name="l01202"></a>01202             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01203"></a>01203             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01204"></a>01204             c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> = *p++; 
<a name="l01205"></a>01205             c.g = *p++; 
<a name="l01206"></a>01206             c.r = *p++;
<a name="l01207"></a>01207             c.a = *p;
<a name="l01208"></a>01208             <span class="keywordflow">return</span> c;
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210     };
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="comment">//========================================================================</span>
<a name="l01216"></a><a class="code" href="structagg_1_1span__rgba32.html">01216</a>     <span class="keyword">struct </span><a class="code" href="structagg_1_1span__rgba32.html">span_rgba32</a>
<a name="l01217"></a>01217     {
<a name="l01218"></a>01218         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01219"></a><a class="code" href="structagg_1_1span__rgba32.html#a39561d1bad633fe892a0146072ab62b8">01219</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgba32.html#a39561d1bad633fe892a0146072ab62b8">render</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01220"></a>01220                            <span class="keywordtype">int</span> x,
<a name="l01221"></a>01221                            <span class="keywordtype">unsigned</span> count, 
<a name="l01222"></a>01222                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* covers, 
<a name="l01223"></a>01223                            <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01224"></a>01224         {
<a name="l01225"></a>01225             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01226"></a>01226             <span class="keywordflow">do</span>
<a name="l01227"></a>01227             {
<a name="l01228"></a>01228                 <span class="keywordtype">int</span> alpha = (*covers++) * c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>;
<a name="l01229"></a>01229                 <span class="keywordtype">int</span> r = p[0];
<a name="l01230"></a>01230                 <span class="keywordtype">int</span> g = p[1];
<a name="l01231"></a>01231                 <span class="keywordtype">int</span> b = p[2];
<a name="l01232"></a>01232                 <span class="keywordtype">int</span> a = p[3];
<a name="l01233"></a>01233                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> - r) * alpha) + (r &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01234"></a>01234                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a> - g) * alpha) + (g &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01235"></a>01235                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a> - b) * alpha) + (b &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01236"></a>01236                 *p++ = (((c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a> - a) * alpha) + (a &lt;&lt; 16)) &gt;&gt; 16;
<a name="l01237"></a>01237             }
<a name="l01238"></a>01238             <span class="keywordflow">while</span>(--count);
<a name="l01239"></a>01239         }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01242"></a><a class="code" href="structagg_1_1span__rgba32.html#a8187698b298173f9df61df6ef07bb781">01242</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1span__rgba32.html#a8187698b298173f9df61df6ef07bb781">hline</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, 
<a name="l01243"></a>01243                           <span class="keywordtype">int</span> x,
<a name="l01244"></a>01244                           <span class="keywordtype">unsigned</span> count, 
<a name="l01245"></a>01245                           <span class="keyword">const</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a>&amp; c)
<a name="l01246"></a>01246         {
<a name="l01247"></a>01247             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01248"></a>01248             <span class="keywordflow">do</span> { *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#aa60d50394bcb77d1385e31347a4bc28a">g</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4a40498c554c2856564b7e71950fe05f">b</a>; *p++ = c.<a class="code" href="structagg_1_1rgba8.html#a4ac9f7bb8df0b685ebb338e0d4f837e8">a</a>; } <span class="keywordflow">while</span>(--count);
<a name="l01249"></a>01249         }
<a name="l01250"></a>01250 
<a name="l01251"></a>01251         <span class="comment">//--------------------------------------------------------------------</span>
<a name="l01252"></a><a class="code" href="structagg_1_1span__rgba32.html#a2c1536fcb49dfbfb0a2e932a252c5c21">01252</a>         <span class="keyword">static</span> <a class="code" href="structagg_1_1rgba8.html">rgba8</a> <span class="keyword">get</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* ptr, <span class="keywordtype">int</span> x)
<a name="l01253"></a>01253         {
<a name="l01254"></a>01254             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* p = ptr + (x &lt;&lt; 2);
<a name="l01255"></a>01255             <a class="code" href="structagg_1_1rgba8.html">rgba8</a> c;
<a name="l01256"></a>01256             c.<a class="code" href="structagg_1_1rgba8.html#a1e9679aa16a5d5c24c0003917aae2a15">r</a> = *p++; 
<a name="l01257"></a>01257             c.g = *p++; 
<a name="l01258"></a>01258             c.b = *p++;
<a name="l01259"></a>01259             c.a = *p;
<a name="l01260"></a>01260             <span class="keywordflow">return</span> c;
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262     };
<a name="l01263"></a>01263 }
<a name="l01264"></a>01264 
<a name="l01265"></a>01265 <span class="comment">// ===== agg.cpp ===== //</span>
<a name="l01266"></a>01266 
<a name="l01267"></a>01267 <span class="keyword">namespace </span>agg
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269     <span class="comment">//========================================================================</span>
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01272"></a><a class="code" href="classagg_1_1rendering__buffer.html#ad543ef02b28fff0b6eddca2786f54532">01272</a>     <a class="code" href="classagg_1_1rendering__buffer.html#ad543ef02b28fff0b6eddca2786f54532">rendering_buffer::~rendering_buffer</a>()
<a name="l01273"></a>01273     {
<a name="l01274"></a>01274         <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>;
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276 
<a name="l01277"></a>01277 
<a name="l01278"></a>01278     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01279"></a><a class="code" href="classagg_1_1rendering__buffer.html#ae93886646728bed93e9d25c8ac808fff">01279</a>     <a class="code" href="classagg_1_1rendering__buffer.html#ae93886646728bed93e9d25c8ac808fff">rendering_buffer::rendering_buffer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf,
<a name="l01280"></a>01280                                        <span class="keywordtype">unsigned</span> width, 
<a name="l01281"></a>01281                                        <span class="keywordtype">unsigned</span> height,
<a name="l01282"></a>01282                                        <span class="keywordtype">int</span>      stride) :
<a name="l01283"></a>01283         m_buf(0),
<a name="l01284"></a>01284         m_rows(0),
<a name="l01285"></a>01285         m_width(0),
<a name="l01286"></a>01286         m_height(0),
<a name="l01287"></a>01287         m_stride(0),
<a name="l01288"></a>01288         m_max_height(0)
<a name="l01289"></a>01289     {
<a name="l01290"></a>01290         <a class="code" href="classagg_1_1rendering__buffer.html#add349fd37249bd619a375faac3c90cc2">attach</a>(buf, width, height, stride);
<a name="l01291"></a>01291     }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 
<a name="l01294"></a>01294     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01295"></a><a class="code" href="classagg_1_1rendering__buffer.html#add349fd37249bd619a375faac3c90cc2">01295</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rendering__buffer.html#add349fd37249bd619a375faac3c90cc2">rendering_buffer::attach</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf,
<a name="l01296"></a>01296                                   <span class="keywordtype">unsigned</span> width, 
<a name="l01297"></a>01297                                   <span class="keywordtype">unsigned</span> height,
<a name="l01298"></a>01298                                   <span class="keywordtype">int</span>      stride)
<a name="l01299"></a>01299     {
<a name="l01300"></a>01300         <a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">m_buf</a> = <a class="code" href="classagg_1_1rendering__buffer.html#af416294858d093870627370c66d314ea">buf</a>;
<a name="l01301"></a>01301         <a class="code" href="classagg_1_1rendering__buffer.html#aa286889243950dcdcdfe58c668b557db">m_width</a> = <a class="code" href="classagg_1_1rendering__buffer.html#a1feb032c305fb7fcea896c2c25d51d5a">width</a>;
<a name="l01302"></a>01302         <a class="code" href="classagg_1_1rendering__buffer.html#a59c20ec5006e0281b7a9f5e17166b44d">m_height</a> = <a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>;
<a name="l01303"></a>01303         <a class="code" href="classagg_1_1rendering__buffer.html#ad356318c0b2b310fa5f2240cffbcdda5">m_stride</a> = <a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">stride</a>;
<a name="l01304"></a>01304         <span class="keywordflow">if</span>(height &gt; <a class="code" href="classagg_1_1rendering__buffer.html#a78926646758d066cd3c7b811e9934de2">m_max_height</a>)
<a name="l01305"></a>01305         {
<a name="l01306"></a>01306             <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>;
<a name="l01307"></a>01307             <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* [<a class="code" href="classagg_1_1rendering__buffer.html#a78926646758d066cd3c7b811e9934de2">m_max_height</a> = <a class="code" href="classagg_1_1rendering__buffer.html#a62ed0c726c30fdb7422a29fd8eb9d2c4">height</a>];
<a name="l01308"></a>01308         }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* row_ptr = <a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">m_buf</a>;
<a name="l01311"></a>01311 
<a name="l01312"></a>01312         <span class="keywordflow">if</span>(stride &lt; 0)
<a name="l01313"></a>01313         {
<a name="l01314"></a>01314             row_ptr = <a class="code" href="classagg_1_1rendering__buffer.html#af160c1c239ae68a85b4ac8f8f395e7f2">m_buf</a> - int(height - 1) * <a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">stride</a>;
<a name="l01315"></a>01315         }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>** rows = <a class="code" href="classagg_1_1rendering__buffer.html#ac85d6bed66651211e699e9d47b13ed1a">m_rows</a>;
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         <span class="keywordflow">while</span>(height--)
<a name="l01320"></a>01320         {
<a name="l01321"></a>01321             *rows++ = row_ptr;
<a name="l01322"></a>01322             row_ptr += <a class="code" href="classagg_1_1rendering__buffer.html#a620e12b72906a56169c058d0598d38b1">stride</a>;
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="comment">//========================================================================</span>
<a name="l01328"></a>01328 
<a name="l01329"></a>01329     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01330"></a><a class="code" href="classagg_1_1scanline.html#ab641b452c39d748336b559d7c8154a7b">01330</a>     <a class="code" href="classagg_1_1scanline.html#ab641b452c39d748336b559d7c8154a7b">scanline::~scanline</a>()
<a name="l01331"></a>01331     {
<a name="l01332"></a>01332         <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>;
<a name="l01333"></a>01333         <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>;
<a name="l01334"></a>01334         <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a>;
<a name="l01335"></a>01335     }
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 
<a name="l01338"></a>01338     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01339"></a><a class="code" href="classagg_1_1scanline.html#aef5b374f3a44c95f5b29362f446a2f45">01339</a>     <a class="code" href="classagg_1_1scanline.html#aef5b374f3a44c95f5b29362f446a2f45">scanline::scanline</a>()
<a name="l01340"></a>01340         : m_min_x(0),
<a name="l01341"></a>01341           m_max_len(0),
<a name="l01342"></a>01342           m_dx(0),
<a name="l01343"></a>01343           m_dy(0),
<a name="l01344"></a>01344           m_last_x(0x7FFF),
<a name="l01345"></a>01345           m_last_y(0x7FFF),
<a name="l01346"></a>01346           m_covers(0),
<a name="l01347"></a>01347           m_start_ptrs(0),
<a name="l01348"></a>01348           m_counts(0),
<a name="l01349"></a>01349           m_num_spans(0),
<a name="l01350"></a>01350           m_cur_start_ptr(0),
<a name="l01351"></a>01351           m_cur_count(0)
<a name="l01352"></a>01352     {
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355 
<a name="l01356"></a>01356     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01357"></a><a class="code" href="classagg_1_1scanline.html#ae545a2e89b9e5be9003158071ab8adab">01357</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1scanline.html#ae545a2e89b9e5be9003158071ab8adab">scanline::reset</a>(<span class="keywordtype">int</span> min_x, <span class="keywordtype">int</span> max_x, <span class="keywordtype">int</span> dx, <span class="keywordtype">int</span> dy)
<a name="l01358"></a>01358     {
<a name="l01359"></a>01359         <span class="keywordtype">unsigned</span> max_len = max_x - min_x + 2;
<a name="l01360"></a>01360         <span class="keywordflow">if</span>(max_len &gt; <a class="code" href="classagg_1_1scanline.html#ad2014582a7c0aef4d6dfc9db066d5fe4">m_max_len</a>)
<a name="l01361"></a>01361         {
<a name="l01362"></a>01362             <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>;
<a name="l01363"></a>01363             <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>;
<a name="l01364"></a>01364             <span class="keywordflow">if</span> ( <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a> ) <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a>;
<a name="l01365"></a>01365             <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a>     = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  [max_len];
<a name="l01366"></a>01366             <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* [max_len];
<a name="l01367"></a>01367             <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>     = <span class="keyword">new</span> <a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>[max_len];
<a name="l01368"></a>01368             <a class="code" href="classagg_1_1scanline.html#ad2014582a7c0aef4d6dfc9db066d5fe4">m_max_len</a>    = max_len;
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370         <a class="code" href="classagg_1_1scanline.html#a533e3c057ad174cb9e79655f3f898301">m_dx</a>            = dx;
<a name="l01371"></a>01371         <a class="code" href="classagg_1_1scanline.html#ae726eea162f018d564931bc548d9e5b6">m_dy</a>            = dy;
<a name="l01372"></a>01372         <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a>        = 0x7FFF;
<a name="l01373"></a>01373         <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a>        = 0x7FFF;
<a name="l01374"></a>01374         <a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">m_min_x</a>         = min_x;
<a name="l01375"></a>01375         <a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">m_cur_count</a>     = <a class="code" href="classagg_1_1scanline.html#a45e2807e7946a8dd00d1a4d08166707f">m_counts</a>;
<a name="l01376"></a>01376         <a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#a46e7217141ecc84d43220ccacef18c5d">m_start_ptrs</a>;
<a name="l01377"></a>01377         <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>     = 0;
<a name="l01378"></a>01378     }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380 
<a name="l01381"></a>01381     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01382"></a><a class="code" href="classagg_1_1scanline.html#ad232ee623d33b3a5ddb59555879db4b1">01382</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1scanline.html#ad232ee623d33b3a5ddb59555879db4b1">scanline::add_span</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> num, <span class="keywordtype">unsigned</span> cover)
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384         x -= <a class="code" href="classagg_1_1scanline.html#a875affd40aff958a6470a0b3abe7c52c">m_min_x</a>;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         memset(<a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a> + x, cover, num);
<a name="l01387"></a>01387         <span class="keywordflow">if</span>(x == <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a>+1)
<a name="l01388"></a>01388         {
<a name="l01389"></a>01389             (*m_cur_count) += (<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>)num;
<a name="l01390"></a>01390         }
<a name="l01391"></a>01391         <span class="keywordflow">else</span>
<a name="l01392"></a>01392         {
<a name="l01393"></a>01393             *++<a class="code" href="classagg_1_1scanline.html#a7751084a915fa48241d46a328b78d59b">m_cur_count</a> = (<a class="code" href="namespaceagg.html#ac11cadd00813cde9ff1ff4b7a0fa5915">int16u</a>)num;
<a name="l01394"></a>01394             *++<a class="code" href="classagg_1_1scanline.html#aa7b4f12d48b3bc569886e05a95040abd">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#a1a887930b3bf7d6cd8b26dd62c283668">m_covers</a> + x;
<a name="l01395"></a>01395             <a class="code" href="classagg_1_1scanline.html#aedf1bc7fc3cbb0e3162b532c6081f578">m_num_spans</a>++;
<a name="l01396"></a>01396         }
<a name="l01397"></a>01397         <a class="code" href="classagg_1_1scanline.html#a9a4eaa42dc50b0526c65111798f1046c">m_last_x</a> = x + num - 1;
<a name="l01398"></a>01398         <a class="code" href="classagg_1_1scanline.html#a15eed296a87eeb12698595d2a7927b83">m_last_y</a> = <a class="code" href="classagg_1_1scanline.html#a20138d7b09ff574dc7a2d89cc5dce493">y</a>;
<a name="l01399"></a>01399     }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 
<a name="l01403"></a>01403     <span class="comment">//========================================================================</span>
<a name="l01404"></a>01404 
<a name="l01405"></a>01405     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01406"></a>01406     <span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a> <a class="code" href="classagg_1_1rasterizer.html#ab5b3fced8d2c91f083544e1d09cca489">rasterizer::s_default_gamma</a>[] = 
<a name="l01407"></a>01407     {
<a name="l01408"></a>01408           0,  0,  1,  1,  2,  2,  3,  4,  4,  5,  5,  6,  7,  7,  8,  8,
<a name="l01409"></a>01409           9, 10, 10, 11, 11, 12, 13, 13, 14, 14, 15, 16, 16, 17, 18, 18,
<a name="l01410"></a>01410          19, 19, 20, 21, 21, 22, 22, 23, 24, 24, 25, 25, 26, 27, 27, 28,
<a name="l01411"></a>01411          29, 29, 30, 30, 31, 32, 32, 33, 34, 34, 35, 36, 36, 37, 37, 38,
<a name="l01412"></a>01412          39, 39, 40, 41, 41, 42, 43, 43, 44, 45, 45, 46, 47, 47, 48, 49,
<a name="l01413"></a>01413          49, 50, 51, 51, 52, 53, 53, 54, 55, 55, 56, 57, 57, 58, 59, 60,
<a name="l01414"></a>01414          60, 61, 62, 62, 63, 64, 65, 65, 66, 67, 68, 68, 69, 70, 71, 71,
<a name="l01415"></a>01415          72, 73, 74, 74, 75, 76, 77, 78, 78, 79, 80, 81, 82, 83, 83, 84,
<a name="l01416"></a>01416          85, 86, 87, 88, 89, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
<a name="l01417"></a>01417         100,101,101,102,103,104,105,106,107,108,109,110,111,112,114,115,
<a name="l01418"></a>01418         116,117,118,119,120,121,122,123,124,126,127,128,129,130,131,132,
<a name="l01419"></a>01419         134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,153,
<a name="l01420"></a>01420         154,155,157,158,159,161,162,164,165,166,168,169,171,172,174,175,
<a name="l01421"></a>01421         177,178,180,181,183,184,186,188,189,191,192,194,195,197,199,200,
<a name="l01422"></a>01422         202,204,205,207,209,210,212,214,215,217,219,220,222,224,225,227,
<a name="l01423"></a>01423         229,230,232,234,236,237,239,241,242,244,246,248,249,251,253,255
<a name="l01424"></a>01424     };
<a name="l01425"></a>01425 
<a name="l01426"></a>01426 
<a name="l01427"></a>01427 
<a name="l01428"></a>01428 
<a name="l01429"></a>01429 
<a name="l01430"></a>01430     <span class="comment">//========================================================================</span>
<a name="l01431"></a>01431     <span class="keyword">enum</span>
<a name="l01432"></a>01432     {
<a name="l01433"></a><a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">01433</a>         <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">not_closed</a>    = 1,
<a name="l01434"></a><a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">01434</a>         <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a> = 2
<a name="l01435"></a>01435     };
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01438"></a><a class="code" href="structagg_1_1cell.html#a1873bd1201513f6d0a99819bbe0af893">01438</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#a1873bd1201513f6d0a99819bbe0af893">cell::set_cover</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a)
<a name="l01439"></a>01439     {
<a name="l01440"></a>01440         <a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a> = c;
<a name="l01441"></a>01441         <a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a> = a;
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443 
<a name="l01444"></a>01444     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01445"></a><a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">01445</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">cell::add_cover</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a)
<a name="l01446"></a>01446     {
<a name="l01447"></a>01447         <a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a> += c;
<a name="l01448"></a>01448         <a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a> += a;
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01452"></a><a class="code" href="structagg_1_1cell.html#adcdb1d48f21d5142e960b820103883b4">01452</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#adcdb1d48f21d5142e960b820103883b4">cell::set_coord</a>(<span class="keywordtype">int</span> cx, <span class="keywordtype">int</span> cy)
<a name="l01453"></a>01453     {
<a name="l01454"></a>01454         <a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a> = <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a>(cx);
<a name="l01455"></a>01455         <a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a> = <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a>(cy);
<a name="l01456"></a>01456         <a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a> = (cy &lt;&lt; 16) + cx;
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01460"></a><a class="code" href="structagg_1_1cell.html#a7a3389b2b3c55e5c619d8f94d05ce396">01460</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structagg_1_1cell.html#a7a3389b2b3c55e5c619d8f94d05ce396">cell::set</a>(<span class="keywordtype">int</span> cx, <span class="keywordtype">int</span> cy, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> a)
<a name="l01461"></a>01461     {
<a name="l01462"></a>01462         <a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a> = <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a>(cx);
<a name="l01463"></a>01463         <a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a> = <a class="code" href="namespaceagg.html#a335b4493d18974545a21c955f423e9f2">int16</a>(cy);
<a name="l01464"></a>01464         <a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a> = (cy &lt;&lt; 16) + cx;
<a name="l01465"></a>01465         <a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a> = c;
<a name="l01466"></a>01466         <a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a> = a;
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01470"></a><a class="code" href="classagg_1_1outline.html#a985c82c07e08a9a2f6c1a5a3e8096ac4">01470</a>     <a class="code" href="classagg_1_1outline.html#a985c82c07e08a9a2f6c1a5a3e8096ac4">outline::~outline</a>()
<a name="l01471"></a>01471     {
<a name="l01472"></a>01472         <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>;
<a name="l01473"></a>01473         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a>)
<a name="l01474"></a>01474         {
<a name="l01475"></a>01475             <a class="code" href="structagg_1_1cell.html">cell</a>** ptr = <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a> + <a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a> - 1;
<a name="l01476"></a>01476             <span class="keywordflow">while</span>(m_num_blocks--)
<a name="l01477"></a>01477             {
<a name="l01478"></a>01478                 <span class="keyword">delete</span> [] *ptr;
<a name="l01479"></a>01479                 ptr--;
<a name="l01480"></a>01480             }
<a name="l01481"></a>01481             <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>;
<a name="l01482"></a>01482         }
<a name="l01483"></a>01483     }
<a name="l01484"></a>01484 
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01487"></a><a class="code" href="classagg_1_1outline.html#a6e872ce81a994ff434be842eb665faf1">01487</a>     <a class="code" href="classagg_1_1outline.html#a6e872ce81a994ff434be842eb665faf1">outline::outline</a>() :
<a name="l01488"></a>01488         m_num_blocks(0),
<a name="l01489"></a>01489         m_max_blocks(0),
<a name="l01490"></a>01490         m_cur_block(0),
<a name="l01491"></a>01491         m_num_cells(0),
<a name="l01492"></a>01492         m_cells(0),
<a name="l01493"></a>01493         m_cur_cell_ptr(0),
<a name="l01494"></a>01494         m_sorted_cells(0),
<a name="l01495"></a>01495         m_sorted_size(0),
<a name="l01496"></a>01496         m_cur_x(0),
<a name="l01497"></a>01497         m_cur_y(0),
<a name="l01498"></a>01498         m_close_x(0),
<a name="l01499"></a>01499         m_close_y(0),
<a name="l01500"></a>01500         m_min_x(0x7FFFFFFF),
<a name="l01501"></a>01501         m_min_y(0x7FFFFFFF),
<a name="l01502"></a>01502         m_max_x(-0x7FFFFFFF),
<a name="l01503"></a>01503         m_max_y(-0x7FFFFFFF),
<a name="l01504"></a>01504         m_flags(<a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a>)
<a name="l01505"></a>01505     {
<a name="l01506"></a>01506         <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a7a3389b2b3c55e5c619d8f94d05ce396">set</a>(0x7FFF, 0x7FFF, 0, 0);
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508 
<a name="l01509"></a>01509 
<a name="l01510"></a>01510     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01511"></a><a class="code" href="classagg_1_1outline.html#ab76e038abe2fdde87690e08b5f04d11f">01511</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#ab76e038abe2fdde87690e08b5f04d11f">outline::reset</a>()
<a name="l01512"></a>01512     { 
<a name="l01513"></a>01513         <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> = 0; 
<a name="l01514"></a>01514         <a class="code" href="classagg_1_1outline.html#ade72b351355113c250d678d977b4426c">m_cur_block</a> = 0;
<a name="l01515"></a>01515         <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a7a3389b2b3c55e5c619d8f94d05ce396">set</a>(0x7FFF, 0x7FFF, 0, 0);
<a name="l01516"></a>01516         <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> |= <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a>;
<a name="l01517"></a>01517         <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp;= ~<a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">not_closed</a>;
<a name="l01518"></a>01518         <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a> =  0x7FFFFFFF;
<a name="l01519"></a>01519         <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a> =  0x7FFFFFFF;
<a name="l01520"></a>01520         <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a> = -0x7FFFFFFF;
<a name="l01521"></a>01521         <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a> = -0x7FFFFFFF;
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 
<a name="l01525"></a>01525 
<a name="l01526"></a>01526     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01527"></a><a class="code" href="classagg_1_1outline.html#a2b97900069b6de62a8addff037ba967a">01527</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a2b97900069b6de62a8addff037ba967a">outline::allocate_block</a>()
<a name="l01528"></a>01528     {
<a name="l01529"></a>01529         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#ade72b351355113c250d678d977b4426c">m_cur_block</a> &gt;= <a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a>)
<a name="l01530"></a>01530         {
<a name="l01531"></a>01531             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a> &gt;= <a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">m_max_blocks</a>)
<a name="l01532"></a>01532             {
<a name="l01533"></a>01533                 <a class="code" href="structagg_1_1cell.html">cell</a>** new_cells = <span class="keyword">new</span> <a class="code" href="structagg_1_1cell.html">cell</a>* [<a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">m_max_blocks</a> + <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ae0885b96db2b7b538c096fa0198591ae">cell_block_pool</a>];
<a name="l01534"></a>01534                 <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>)
<a name="l01535"></a>01535                 {
<a name="l01536"></a>01536                     memcpy(new_cells, <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>, <a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">m_max_blocks</a> * <span class="keyword">sizeof</span>(<a class="code" href="structagg_1_1cell.html">cell</a>*));
<a name="l01537"></a>01537                     <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>;
<a name="l01538"></a>01538                 }
<a name="l01539"></a>01539                 <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a> = new_cells;
<a name="l01540"></a>01540                 <a class="code" href="classagg_1_1outline.html#a08e9603a98f29f92fcfef62bc3f2c1bf">m_max_blocks</a> += <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ae0885b96db2b7b538c096fa0198591ae">cell_block_pool</a>;
<a name="l01541"></a>01541             }
<a name="l01542"></a>01542             <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>[<a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a>++] = <span class="keyword">new</span> <a class="code" href="structagg_1_1cell.html">cell</a> [unsigned(<a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a2b69b8fd3a4b8fe4899126adfdbce2bd">cell_block_size</a>)];
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544         <a class="code" href="classagg_1_1outline.html#a0e803aab5a705d41c269b03aba6c2e57">m_cur_cell_ptr</a> = <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>[<a class="code" href="classagg_1_1outline.html#ade72b351355113c250d678d977b4426c">m_cur_block</a>++];
<a name="l01545"></a>01545     }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547 
<a name="l01548"></a>01548     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01549"></a><a class="code" href="classagg_1_1outline.html#a94571c0444e2018c6d7a76770128a7c7">01549</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a94571c0444e2018c6d7a76770128a7c7">outline::add_cur_cell</a>()
<a name="l01550"></a>01550     {
<a name="l01551"></a>01551         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a> | <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>)
<a name="l01552"></a>01552         {
<a name="l01553"></a>01553             <span class="keywordflow">if</span>((<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> &amp; <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a26eb73ee11c1876024caeafd384dac74">cell_block_mask</a>) == 0)
<a name="l01554"></a>01554             {
<a name="l01555"></a>01555                 <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#aa5926ff43a4705bbec2036b618381a9d">m_num_blocks</a> &gt;= <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13adb1ac9a1f5dd1aa6f21bf57ec80ca666">cell_block_limit</a>) <span class="keywordflow">return</span>;
<a name="l01556"></a>01556                 <a class="code" href="classagg_1_1outline.html#a2b97900069b6de62a8addff037ba967a">allocate_block</a>();
<a name="l01557"></a>01557             }
<a name="l01558"></a>01558             *<a class="code" href="classagg_1_1outline.html#a0e803aab5a705d41c269b03aba6c2e57">m_cur_cell_ptr</a>++ = <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>;
<a name="l01559"></a>01559             <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>++;
<a name="l01560"></a>01560         }
<a name="l01561"></a>01561     }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 
<a name="l01564"></a>01564 
<a name="l01565"></a>01565     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01566"></a><a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">01566</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">outline::set_cur_cell</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01567"></a>01567     {
<a name="l01568"></a>01568         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a> != (y &lt;&lt; 16) + x)
<a name="l01569"></a>01569         {
<a name="l01570"></a>01570             <a class="code" href="classagg_1_1outline.html#a94571c0444e2018c6d7a76770128a7c7">add_cur_cell</a>();
<a name="l01571"></a>01571             <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a7a3389b2b3c55e5c619d8f94d05ce396">set</a>(x, y, 0, 0);
<a name="l01572"></a>01572         }
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 
<a name="l01576"></a>01576 
<a name="l01577"></a>01577     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01578"></a><a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">01578</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">outline::render_scanline</a>(<span class="keywordtype">int</span> ey, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2)
<a name="l01579"></a>01579     {
<a name="l01580"></a>01580         <span class="keywordtype">int</span> ex1 = x1 &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01581"></a>01581         <span class="keywordtype">int</span> ex2 = x2 &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01582"></a>01582         <span class="keywordtype">int</span> fx1 = x1 &amp; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">poly_base_mask</a>;
<a name="l01583"></a>01583         <span class="keywordtype">int</span> fx2 = x2 &amp; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">poly_base_mask</a>;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585         <span class="keywordtype">int</span> delta, p, first, dx;
<a name="l01586"></a>01586         <span class="keywordtype">int</span> incr, lift, mod, rem;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         <span class="comment">//trivial case. Happens often</span>
<a name="l01589"></a>01589         <span class="keywordflow">if</span>(y1 == y2)
<a name="l01590"></a>01590         {
<a name="l01591"></a>01591             <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(ex2, ey);
<a name="l01592"></a>01592             <span class="keywordflow">return</span>;
<a name="l01593"></a>01593         }
<a name="l01594"></a>01594 
<a name="l01595"></a>01595         <span class="comment">//everything is located in a single cell.  That is easy!</span>
<a name="l01596"></a>01596         <span class="keywordflow">if</span>(ex1 == ex2)
<a name="l01597"></a>01597         {
<a name="l01598"></a>01598             delta = y2 - y1;
<a name="l01599"></a>01599             <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, (fx1 + fx2) * delta);
<a name="l01600"></a>01600             <span class="keywordflow">return</span>;
<a name="l01601"></a>01601         }
<a name="l01602"></a>01602 
<a name="l01603"></a>01603         <span class="comment">//ok, we&#39;ll have to render a run of adjacent cells on the same</span>
<a name="l01604"></a>01604         <span class="comment">//scanline...</span>
<a name="l01605"></a>01605         p     = (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - fx1) * (y2 - y1);
<a name="l01606"></a>01606         first = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>;
<a name="l01607"></a>01607         incr  = 1;
<a name="l01608"></a>01608 
<a name="l01609"></a>01609         dx = x2 - x1;
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         <span class="keywordflow">if</span>(dx &lt; 0)
<a name="l01612"></a>01612         {
<a name="l01613"></a>01613             p     = fx1 * (y2 - y1);
<a name="l01614"></a>01614             first = 0;
<a name="l01615"></a>01615             incr  = -1;
<a name="l01616"></a>01616             dx    = -dx;
<a name="l01617"></a>01617         }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619         delta = p / dx;
<a name="l01620"></a>01620         mod   = p % dx;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622         <span class="keywordflow">if</span>(mod &lt; 0)
<a name="l01623"></a>01623         {
<a name="l01624"></a>01624             delta--;
<a name="l01625"></a>01625             mod += dx;
<a name="l01626"></a>01626         }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628         <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, (fx1 + first) * delta);
<a name="l01629"></a>01629 
<a name="l01630"></a>01630         ex1 += incr;
<a name="l01631"></a>01631         <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(ex1, ey);
<a name="l01632"></a>01632         y1  += delta;
<a name="l01633"></a>01633 
<a name="l01634"></a>01634         <span class="keywordflow">if</span>(ex1 != ex2)
<a name="l01635"></a>01635         {
<a name="l01636"></a>01636             p     = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> * (y2 - y1 + delta);
<a name="l01637"></a>01637             lift  = p / dx;
<a name="l01638"></a>01638             rem   = p % dx;
<a name="l01639"></a>01639 
<a name="l01640"></a>01640             <span class="keywordflow">if</span> (rem &lt; 0)
<a name="l01641"></a>01641             {
<a name="l01642"></a>01642                 lift--;
<a name="l01643"></a>01643                 rem += dx;
<a name="l01644"></a>01644             }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646             mod -= dx;
<a name="l01647"></a>01647 
<a name="l01648"></a>01648             <span class="keywordflow">while</span> (ex1 != ex2)
<a name="l01649"></a>01649             {
<a name="l01650"></a>01650                 delta = lift;
<a name="l01651"></a>01651                 mod  += rem;
<a name="l01652"></a>01652                 <span class="keywordflow">if</span>(mod &gt;= 0)
<a name="l01653"></a>01653                 {
<a name="l01654"></a>01654                     mod -= dx;
<a name="l01655"></a>01655                     delta++;
<a name="l01656"></a>01656                 }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658                 <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>) * delta);
<a name="l01659"></a>01659                 y1  += delta;
<a name="l01660"></a>01660                 ex1 += incr;
<a name="l01661"></a>01661                 <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(ex1, ey);
<a name="l01662"></a>01662             }
<a name="l01663"></a>01663         }
<a name="l01664"></a>01664         delta = y2 - y1;
<a name="l01665"></a>01665         <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, (fx2 + <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - first) * delta);
<a name="l01666"></a>01666     }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 
<a name="l01669"></a>01669 
<a name="l01670"></a>01670 
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 
<a name="l01673"></a>01673     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01674"></a><a class="code" href="classagg_1_1outline.html#a5bf6aa6d214f5dc8ab8e19c06e43c7ed">01674</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a5bf6aa6d214f5dc8ab8e19c06e43c7ed">outline::render_line</a>(<span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> x2, <span class="keywordtype">int</span> y2)
<a name="l01675"></a>01675     {
<a name="l01676"></a>01676         <span class="keywordtype">int</span> ey1 = y1 &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01677"></a>01677         <span class="keywordtype">int</span> ey2 = y2 &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01678"></a>01678         <span class="keywordtype">int</span> fy1 = y1 &amp; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">poly_base_mask</a>;
<a name="l01679"></a>01679         <span class="keywordtype">int</span> fy2 = y2 &amp; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a9d4e4616b64002a45871030aaca746ad">poly_base_mask</a>;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681         <span class="keywordtype">int</span> dx, dy, x_from, x_to;
<a name="l01682"></a>01682         <span class="keywordtype">int</span> p, rem, mod, lift, delta, first, incr;
<a name="l01683"></a>01683 
<a name="l01684"></a>01684         <span class="keywordflow">if</span>(ey1   &lt; <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a>) <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a> = ey1;
<a name="l01685"></a>01685         <span class="keywordflow">if</span>(ey1+1 &gt; <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a>) <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a> = ey1+1;
<a name="l01686"></a>01686         <span class="keywordflow">if</span>(ey2   &lt; <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a>) <a class="code" href="classagg_1_1outline.html#a380d14bf219cb5478b0d731a2d333632">m_min_y</a> = ey2;
<a name="l01687"></a>01687         <span class="keywordflow">if</span>(ey2+1 &gt; <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a>) <a class="code" href="classagg_1_1outline.html#a88f5c4f20af1b32850bb7decc3200892">m_max_y</a> = ey2+1;
<a name="l01688"></a>01688 
<a name="l01689"></a>01689         dx = x2 - x1;
<a name="l01690"></a>01690         dy = y2 - y1;
<a name="l01691"></a>01691 
<a name="l01692"></a>01692         <span class="comment">//everything is on a single scanline</span>
<a name="l01693"></a>01693         <span class="keywordflow">if</span>(ey1 == ey2)
<a name="l01694"></a>01694         {
<a name="l01695"></a>01695             <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">render_scanline</a>(ey1, x1, fy1, x2, fy2);
<a name="l01696"></a>01696             <span class="keywordflow">return</span>;
<a name="l01697"></a>01697         }
<a name="l01698"></a>01698 
<a name="l01699"></a>01699         <span class="comment">//Vertical line - we have to calculate start and end cells,</span>
<a name="l01700"></a>01700         <span class="comment">//and then - the common values of the area and coverage for</span>
<a name="l01701"></a>01701         <span class="comment">//all cells of the line. We know exactly there&#39;s only one </span>
<a name="l01702"></a>01702         <span class="comment">//cell, so, we don&#39;t have to call render_scanline().</span>
<a name="l01703"></a>01703         incr  = 1;
<a name="l01704"></a>01704         <span class="keywordflow">if</span>(dx == 0)
<a name="l01705"></a>01705         {
<a name="l01706"></a>01706             <span class="keywordtype">int</span> ex = x1 &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01707"></a>01707             <span class="keywordtype">int</span> two_fx = (x1 - (ex &lt;&lt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>)) &lt;&lt; 1;
<a name="l01708"></a>01708             <span class="keywordtype">int</span> area;
<a name="l01709"></a>01709 
<a name="l01710"></a>01710             first = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>;
<a name="l01711"></a>01711             <span class="keywordflow">if</span>(dy &lt; 0)
<a name="l01712"></a>01712             {
<a name="l01713"></a>01713                 first = 0;
<a name="l01714"></a>01714                 incr  = -1;
<a name="l01715"></a>01715             }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717             x_from = x1;
<a name="l01718"></a>01718 
<a name="l01719"></a>01719             <span class="comment">//render_scanline(ey1, x_from, fy1, x_from, first);</span>
<a name="l01720"></a>01720             delta = first - fy1;
<a name="l01721"></a>01721             <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, two_fx * delta);
<a name="l01722"></a>01722 
<a name="l01723"></a>01723             ey1 += incr;
<a name="l01724"></a>01724             <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(ex, ey1);
<a name="l01725"></a>01725 
<a name="l01726"></a>01726             delta = first + first - <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>;
<a name="l01727"></a>01727             area = two_fx * delta;
<a name="l01728"></a>01728             <span class="keywordflow">while</span>(ey1 != ey2)
<a name="l01729"></a>01729             {
<a name="l01730"></a>01730                 <span class="comment">//render_scanline(ey1, x_from, poly_base_size - first, x_from, first);</span>
<a name="l01731"></a>01731                 <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#a1873bd1201513f6d0a99819bbe0af893">set_cover</a>(delta, area);
<a name="l01732"></a>01732                 ey1 += incr;
<a name="l01733"></a>01733                 <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(ex, ey1);
<a name="l01734"></a>01734             }
<a name="l01735"></a>01735             <span class="comment">//render_scanline(ey1, x_from, poly_base_size - first, x_from, fy2);</span>
<a name="l01736"></a>01736             delta = fy2 - poly_base_size + first;
<a name="l01737"></a>01737             <a class="code" href="classagg_1_1outline.html#a57a993e702aada8849d5edc11cc12631">m_cur_cell</a>.<a class="code" href="structagg_1_1cell.html#aa00c6581b1d462c8df222689752b5a1b">add_cover</a>(delta, two_fx * delta);
<a name="l01738"></a>01738             <span class="keywordflow">return</span>;
<a name="l01739"></a>01739         }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741         <span class="comment">//ok, we have to render several scanlines</span>
<a name="l01742"></a>01742         p     = (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - fy1) * dx;
<a name="l01743"></a>01743         first = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a>;
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         <span class="keywordflow">if</span>(dy &lt; 0)
<a name="l01746"></a>01746         {
<a name="l01747"></a>01747             p     = fy1 * dx;
<a name="l01748"></a>01748             first = 0;
<a name="l01749"></a>01749             incr  = -1;
<a name="l01750"></a>01750             dy    = -dy;
<a name="l01751"></a>01751         }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753         delta = p / dy;
<a name="l01754"></a>01754         mod   = p % dy;
<a name="l01755"></a>01755 
<a name="l01756"></a>01756         <span class="keywordflow">if</span>(mod &lt; 0)
<a name="l01757"></a>01757         {
<a name="l01758"></a>01758             delta--;
<a name="l01759"></a>01759             mod += dy;
<a name="l01760"></a>01760         }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762         x_from = x1 + delta;
<a name="l01763"></a>01763         <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">render_scanline</a>(ey1, x1, fy1, x_from, first);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765         ey1 += incr;
<a name="l01766"></a>01766         <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(x_from &gt;&gt; poly_base_shift, ey1);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768         <span class="keywordflow">if</span>(ey1 != ey2)
<a name="l01769"></a>01769         {
<a name="l01770"></a>01770             p     = <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> * dx;
<a name="l01771"></a>01771             lift  = p / dy;
<a name="l01772"></a>01772             rem   = p % dy;
<a name="l01773"></a>01773 
<a name="l01774"></a>01774             <span class="keywordflow">if</span>(rem &lt; 0)
<a name="l01775"></a>01775             {
<a name="l01776"></a>01776                 lift--;
<a name="l01777"></a>01777                 rem += dy;
<a name="l01778"></a>01778             }
<a name="l01779"></a>01779             mod -= dy;
<a name="l01780"></a>01780 
<a name="l01781"></a>01781             <span class="keywordflow">while</span>(ey1 != ey2)
<a name="l01782"></a>01782             {
<a name="l01783"></a>01783                 delta = lift;
<a name="l01784"></a>01784                 mod  += rem;
<a name="l01785"></a>01785                 <span class="keywordflow">if</span> (mod &gt;= 0)
<a name="l01786"></a>01786                 {
<a name="l01787"></a>01787                     mod -= dy;
<a name="l01788"></a>01788                     delta++;
<a name="l01789"></a>01789                 }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791                 x_to = x_from + delta;
<a name="l01792"></a>01792                 <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">render_scanline</a>(ey1, x_from, <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - first, x_to, first);
<a name="l01793"></a>01793                 x_from = x_to;
<a name="l01794"></a>01794 
<a name="l01795"></a>01795                 ey1 += incr;
<a name="l01796"></a>01796                 <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(x_from &gt;&gt; poly_base_shift, ey1);
<a name="l01797"></a>01797             }
<a name="l01798"></a>01798         }
<a name="l01799"></a>01799         <a class="code" href="classagg_1_1outline.html#a69ee36a6b38b7eb280d3960d2b1689ea">render_scanline</a>(ey1, x_from, <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33abcf7173a39f9df32c6cb3ad24466208e">poly_base_size</a> - first, x2, fy2);
<a name="l01800"></a>01800     }
<a name="l01801"></a>01801 
<a name="l01802"></a>01802 
<a name="l01803"></a>01803     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01804"></a><a class="code" href="classagg_1_1outline.html#a6d7acd19ef36d1f976f449132dd03a54">01804</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a6d7acd19ef36d1f976f449132dd03a54">outline::move_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01805"></a>01805     {
<a name="l01806"></a>01806         <span class="keywordflow">if</span>((<a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a>) == 0) <a class="code" href="classagg_1_1outline.html#ab76e038abe2fdde87690e08b5f04d11f">reset</a>();
<a name="l01807"></a>01807         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">not_closed</a>) <a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">line_to</a>(<a class="code" href="classagg_1_1outline.html#a27deca183262a4b60b860d970380f32c">m_close_x</a>, <a class="code" href="classagg_1_1outline.html#a1a0ed09a0974bc1351de6e8c350c832b">m_close_y</a>);
<a name="l01808"></a>01808         <a class="code" href="classagg_1_1outline.html#a407fb81e100cbf9c515cb8718963f618">set_cur_cell</a>(x &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>, y &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>);
<a name="l01809"></a>01809         <a class="code" href="classagg_1_1outline.html#a27deca183262a4b60b860d970380f32c">m_close_x</a> = <a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a> = x;
<a name="l01810"></a>01810         <a class="code" href="classagg_1_1outline.html#a1a0ed09a0974bc1351de6e8c350c832b">m_close_y</a> = <a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">m_cur_y</a> = y;
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 
<a name="l01814"></a>01814 
<a name="l01815"></a>01815     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01816"></a><a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">01816</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">outline::line_to</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l01817"></a>01817     {
<a name="l01818"></a>01818         <span class="keywordflow">if</span>((<a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a>) &amp;&amp; ((<a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a> ^ x) | (<a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">m_cur_y</a> ^ y)))
<a name="l01819"></a>01819         {
<a name="l01820"></a>01820             <span class="keywordtype">int</span> c;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822             c = <a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a> &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01823"></a>01823             <span class="keywordflow">if</span>(c &lt; <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a>) <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a> = c;
<a name="l01824"></a>01824             ++c;
<a name="l01825"></a>01825             <span class="keywordflow">if</span>(c &gt; <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a>) <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a> = c;
<a name="l01826"></a>01826 
<a name="l01827"></a>01827             c = x &gt;&gt; <a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a>;
<a name="l01828"></a>01828             <span class="keywordflow">if</span>(c &lt; <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a>) <a class="code" href="classagg_1_1outline.html#a64baee1c446c632c8432a91f7b6a814c">m_min_x</a> = c;
<a name="l01829"></a>01829             ++c;
<a name="l01830"></a>01830             <span class="keywordflow">if</span>(c &gt; <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a>) <a class="code" href="classagg_1_1outline.html#afc58d65f68dcaf1960a4e34f66fa0b8e">m_max_x</a> = c;
<a name="l01831"></a>01831 
<a name="l01832"></a>01832             <a class="code" href="classagg_1_1outline.html#a5bf6aa6d214f5dc8ab8e19c06e43c7ed">render_line</a>(<a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a>, <a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">m_cur_y</a>, x, y);
<a name="l01833"></a>01833             <a class="code" href="classagg_1_1outline.html#a63babd8cfbf10f1dbc918235236fc088">m_cur_x</a> = x;
<a name="l01834"></a>01834             <a class="code" href="classagg_1_1outline.html#a109bb5dbc4b0e1d991dd040851543e02">m_cur_y</a> = y;
<a name="l01835"></a>01835             <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> |= <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">not_closed</a>;
<a name="l01836"></a>01836         }
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839 
<a name="l01840"></a>01840     <span class="keyword">enum</span>
<a name="l01841"></a>01841     {
<a name="l01842"></a><a class="code" href="namespaceagg.html#af6c5061c525977471cef5ad6fcfeccbda0159e1178933fbfbe56974eb111f7bfa">01842</a>         <a class="code" href="namespaceagg.html#af6c5061c525977471cef5ad6fcfeccbda0159e1178933fbfbe56974eb111f7bfa">qsort_threshold</a> = 9
<a name="l01843"></a>01843     };
<a name="l01844"></a>01844 
<a name="l01845"></a>01845 
<a name="l01846"></a>01846     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01847"></a><a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">01847</a>     <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(T* a, T* b)
<a name="l01848"></a>01848     {
<a name="l01849"></a>01849         T temp = *a;
<a name="l01850"></a>01850         *a = *b;
<a name="l01851"></a>01851         *b = temp;
<a name="l01852"></a>01852     }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01855"></a><a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">01855</a>     <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(T* a, T* b)
<a name="l01856"></a>01856     {
<a name="l01857"></a>01857         <span class="keywordflow">return</span> (*a)-&gt;packed_coord &lt; (*b)-&gt;packed_coord;
<a name="l01858"></a>01858     }
<a name="l01859"></a>01859 
<a name="l01860"></a>01860 
<a name="l01861"></a>01861 
<a name="l01862"></a>01862     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01863"></a><a class="code" href="classagg_1_1outline.html#a7a3d96ac419b40b2208607a58efcb077">01863</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#a7a3d96ac419b40b2208607a58efcb077">outline::qsort_cells</a>(<a class="code" href="structagg_1_1cell.html">cell</a>** start, <span class="keywordtype">unsigned</span> num)
<a name="l01864"></a>01864     {
<a name="l01865"></a>01865         <a class="code" href="structagg_1_1cell.html">cell</a>**  stack[80];
<a name="l01866"></a>01866         <a class="code" href="structagg_1_1cell.html">cell</a>*** top; 
<a name="l01867"></a>01867         <a class="code" href="structagg_1_1cell.html">cell</a>**  limit;
<a name="l01868"></a>01868         <a class="code" href="structagg_1_1cell.html">cell</a>**  base;
<a name="l01869"></a>01869 
<a name="l01870"></a>01870         limit = start + num;
<a name="l01871"></a>01871         base  = start;
<a name="l01872"></a>01872         top   = stack;
<a name="l01873"></a>01873 
<a name="l01874"></a>01874         <span class="keywordflow">for</span> (;;)
<a name="l01875"></a>01875         {
<a name="l01876"></a>01876             <span class="keywordtype">int</span> len = int(limit - base);
<a name="l01877"></a>01877 
<a name="l01878"></a>01878             <a class="code" href="structagg_1_1cell.html">cell</a>** i;
<a name="l01879"></a>01879             <a class="code" href="structagg_1_1cell.html">cell</a>** j;
<a name="l01880"></a>01880             <a class="code" href="structagg_1_1cell.html">cell</a>** pivot;
<a name="l01881"></a>01881 
<a name="l01882"></a>01882             <span class="keywordflow">if</span>(len &gt; <a class="code" href="namespaceagg.html#af6c5061c525977471cef5ad6fcfeccbda0159e1178933fbfbe56974eb111f7bfa">qsort_threshold</a>)
<a name="l01883"></a>01883             {
<a name="l01884"></a>01884                 <span class="comment">// we use base + len/2 as the pivot</span>
<a name="l01885"></a>01885                 pivot = base + len / 2;
<a name="l01886"></a>01886                 <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(base, pivot);
<a name="l01887"></a>01887 
<a name="l01888"></a>01888                 i = base + 1;
<a name="l01889"></a>01889                 j = limit - 1;
<a name="l01890"></a>01890 
<a name="l01891"></a>01891                 <span class="comment">// now ensure that *i &lt;= *base &lt;= *j </span>
<a name="l01892"></a>01892                 <span class="keywordflow">if</span>(<a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(j, i))
<a name="l01893"></a>01893                 {
<a name="l01894"></a>01894                     <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(i, j);
<a name="l01895"></a>01895                 }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897                 <span class="keywordflow">if</span>(<a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(base, i))
<a name="l01898"></a>01898                 {
<a name="l01899"></a>01899                     <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(base, i);
<a name="l01900"></a>01900                 }
<a name="l01901"></a>01901 
<a name="l01902"></a>01902                 <span class="keywordflow">if</span>(<a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(j, base))
<a name="l01903"></a>01903                 {
<a name="l01904"></a>01904                     <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(base, j);
<a name="l01905"></a>01905                 }
<a name="l01906"></a>01906 
<a name="l01907"></a>01907                 <span class="keywordflow">for</span>(;;)
<a name="l01908"></a>01908                 {
<a name="l01909"></a>01909                     <span class="keywordflow">do</span> i++; <span class="keywordflow">while</span>( <a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(i, base) );
<a name="l01910"></a>01910                     <span class="keywordflow">do</span> j--; <span class="keywordflow">while</span>( <a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(base, j) );
<a name="l01911"></a>01911 
<a name="l01912"></a>01912                     <span class="keywordflow">if</span> ( i &gt; j )
<a name="l01913"></a>01913                     {
<a name="l01914"></a>01914                         <span class="keywordflow">break</span>;
<a name="l01915"></a>01915                     }
<a name="l01916"></a>01916 
<a name="l01917"></a>01917                     <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(i, j);
<a name="l01918"></a>01918                 }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920                 <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(base, j);
<a name="l01921"></a>01921 
<a name="l01922"></a>01922                 <span class="comment">// now, push the largest sub-array</span>
<a name="l01923"></a>01923                 <span class="keywordflow">if</span>(j - base &gt; limit - i)
<a name="l01924"></a>01924                 {
<a name="l01925"></a>01925                     top[0] = base;
<a name="l01926"></a>01926                     top[1] = j;
<a name="l01927"></a>01927                     base   = i;
<a name="l01928"></a>01928                 }
<a name="l01929"></a>01929                 <span class="keywordflow">else</span>
<a name="l01930"></a>01930                 {
<a name="l01931"></a>01931                     top[0] = i;
<a name="l01932"></a>01932                     top[1] = limit;
<a name="l01933"></a>01933                     limit  = j;
<a name="l01934"></a>01934                 }
<a name="l01935"></a>01935                 top += 2;
<a name="l01936"></a>01936             }
<a name="l01937"></a>01937             <span class="keywordflow">else</span>
<a name="l01938"></a>01938             {
<a name="l01939"></a>01939                 <span class="comment">// the sub-array is small, perform insertion sort</span>
<a name="l01940"></a>01940                 j = base;
<a name="l01941"></a>01941                 i = j + 1;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943                 <span class="keywordflow">for</span>(; i &lt; limit; j = i, i++)
<a name="l01944"></a>01944                 {
<a name="l01945"></a>01945                     <span class="keywordflow">for</span>(; <a class="code" href="namespaceagg.html#af8ad277418c73e24d7b721c7cfccd1ec">less_than</a>(j + 1, j); j--)
<a name="l01946"></a>01946                     {
<a name="l01947"></a>01947                         <a class="code" href="namespaceagg.html#af21a37afa0d4f422619eccd65807fa41">swap_cells</a>(j + 1, j);
<a name="l01948"></a>01948                         <span class="keywordflow">if</span> (j == base)
<a name="l01949"></a>01949                         {
<a name="l01950"></a>01950                             <span class="keywordflow">break</span>;
<a name="l01951"></a>01951                         }
<a name="l01952"></a>01952                     }
<a name="l01953"></a>01953                 }
<a name="l01954"></a>01954                 <span class="keywordflow">if</span>(top &gt; stack)
<a name="l01955"></a>01955                 {
<a name="l01956"></a>01956                     top  -= 2;
<a name="l01957"></a>01957                     base  = top[0];
<a name="l01958"></a>01958                     limit = top[1];
<a name="l01959"></a>01959                 }
<a name="l01960"></a>01960                 <span class="keywordflow">else</span>
<a name="l01961"></a>01961                 {
<a name="l01962"></a>01962                     <span class="keywordflow">break</span>;
<a name="l01963"></a>01963                 }
<a name="l01964"></a>01964             }
<a name="l01965"></a>01965         }
<a name="l01966"></a>01966     }
<a name="l01967"></a>01967 
<a name="l01968"></a>01968 
<a name="l01969"></a>01969 
<a name="l01970"></a>01970 
<a name="l01971"></a>01971 
<a name="l01972"></a>01972     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l01973"></a><a class="code" href="classagg_1_1outline.html#aa23dcda8ba406b8d5faae9f9db9b4a89">01973</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1outline.html#aa23dcda8ba406b8d5faae9f9db9b4a89">outline::sort_cells</a>()
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> == 0) <span class="keywordflow">return</span>;
<a name="l01976"></a>01976         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> &gt; <a class="code" href="classagg_1_1outline.html#a2fe8275c30d2c664f235bbbad487e5c7">m_sorted_size</a>)
<a name="l01977"></a>01977         {
<a name="l01978"></a>01978             <span class="keyword">delete</span> [] <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>;
<a name="l01979"></a>01979             <a class="code" href="classagg_1_1outline.html#a2fe8275c30d2c664f235bbbad487e5c7">m_sorted_size</a> = <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>;
<a name="l01980"></a>01980             <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a> = <span class="keyword">new</span> <a class="code" href="structagg_1_1cell.html">cell</a>* [<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> + 1];
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983         <a class="code" href="structagg_1_1cell.html">cell</a>** sorted_ptr = <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>;
<a name="l01984"></a>01984         <a class="code" href="structagg_1_1cell.html">cell</a>** block_ptr = <a class="code" href="classagg_1_1outline.html#ab8d6bbd642142b1fe6f8d115baffbecb">m_cells</a>;
<a name="l01985"></a>01985         <a class="code" href="structagg_1_1cell.html">cell</a>*  cell_ptr;
<a name="l01986"></a>01986 
<a name="l01987"></a>01987         <span class="keywordtype">unsigned</span> nb = <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> &gt;&gt; <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13ab2f6ca79eda5b12403e20efd75d7ad12">cell_block_shift</a>;
<a name="l01988"></a>01988         <span class="keywordtype">unsigned</span> i;
<a name="l01989"></a>01989 
<a name="l01990"></a>01990         <span class="keywordflow">while</span>(nb--)
<a name="l01991"></a>01991         {
<a name="l01992"></a>01992             cell_ptr = *block_ptr++;
<a name="l01993"></a>01993             i = <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a2b69b8fd3a4b8fe4899126adfdbce2bd">cell_block_size</a>;
<a name="l01994"></a>01994             <span class="keywordflow">while</span>(i--) 
<a name="l01995"></a>01995             {
<a name="l01996"></a>01996                 *sorted_ptr++ = cell_ptr++;
<a name="l01997"></a>01997             }
<a name="l01998"></a>01998         }
<a name="l01999"></a>01999 
<a name="l02000"></a>02000         cell_ptr = *block_ptr++;
<a name="l02001"></a>02001         i = <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> &amp; <a class="code" href="classagg_1_1outline.html#a33be0cec0e7d434b840774728aa8af13a26eb73ee11c1876024caeafd384dac74">cell_block_mask</a>;
<a name="l02002"></a>02002         <span class="keywordflow">while</span>(i--) 
<a name="l02003"></a>02003         {
<a name="l02004"></a>02004             *sorted_ptr++ = cell_ptr++;
<a name="l02005"></a>02005         }
<a name="l02006"></a>02006         <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>[<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>] = 0;
<a name="l02007"></a>02007         <a class="code" href="classagg_1_1outline.html#a7a3d96ac419b40b2208607a58efcb077">qsort_cells</a>(<a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>, <a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a>);
<a name="l02008"></a>02008     }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010 
<a name="l02011"></a>02011 
<a name="l02012"></a>02012 
<a name="l02013"></a>02013     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l02014"></a><a class="code" href="classagg_1_1outline.html#a44752016da5a9c3b091a57de5c2ee03d">02014</a>     <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* <span class="keyword">const</span>* <a class="code" href="classagg_1_1outline.html#a44752016da5a9c3b091a57de5c2ee03d">outline::cells</a>()
<a name="l02015"></a>02015     {
<a name="l02016"></a>02016         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81a894f41fb6d394333f1f5e8188e46d88a">not_closed</a>)
<a name="l02017"></a>02017         {
<a name="l02018"></a>02018             <a class="code" href="classagg_1_1outline.html#ae50b61d241835e1a59c107ef5da6a83d">line_to</a>(<a class="code" href="classagg_1_1outline.html#a27deca183262a4b60b860d970380f32c">m_close_x</a>, <a class="code" href="classagg_1_1outline.html#a1a0ed09a0974bc1351de6e8c350c832b">m_close_y</a>);
<a name="l02019"></a>02019             <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp;= ~not_closed;
<a name="l02020"></a>02020         }
<a name="l02021"></a>02021 
<a name="l02022"></a>02022         <span class="comment">//Perform sort only the first time.</span>
<a name="l02023"></a>02023         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a459efc388385c3e1b9b2d70b6d47fc81ad132f960eb9e49bed1785548337e44fc">sort_required</a>)
<a name="l02024"></a>02024         {
<a name="l02025"></a>02025             <a class="code" href="classagg_1_1outline.html#a94571c0444e2018c6d7a76770128a7c7">add_cur_cell</a>();
<a name="l02026"></a>02026             <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1outline.html#ad28f5865906b526f43f450093e2dad62">m_num_cells</a> == 0) <span class="keywordflow">return</span> 0;
<a name="l02027"></a>02027             <a class="code" href="classagg_1_1outline.html#aa23dcda8ba406b8d5faae9f9db9b4a89">sort_cells</a>();
<a name="l02028"></a>02028             <a class="code" href="classagg_1_1outline.html#a7f6ed6a66a19a411a3f87250eb6adfe4">m_flags</a> &amp;= ~sort_required;
<a name="l02029"></a>02029         }
<a name="l02030"></a>02030         <span class="keywordflow">return</span> <a class="code" href="classagg_1_1outline.html#ada680f6cd41b0f99c6379e319ce4d80c">m_sorted_cells</a>;
<a name="l02031"></a>02031     }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033 
<a name="l02034"></a>02034 
<a name="l02035"></a>02035     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l02036"></a><a class="code" href="classagg_1_1rasterizer.html#aa4384b0f123ff4fc0eff7b7b6ab62b9f">02036</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa4384b0f123ff4fc0eff7b7b6ab62b9f">rasterizer::gamma</a>(<span class="keywordtype">double</span> g)
<a name="l02037"></a>02037     {
<a name="l02038"></a>02038         <span class="keywordtype">unsigned</span> i;
<a name="l02039"></a>02039         <span class="keywordflow">for</span>(i = 0; i &lt; 256; i++)
<a name="l02040"></a>02040         {
<a name="l02041"></a>02041             <a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>[i] = (<span class="keywordtype">unsigned</span> char)(pow(<span class="keywordtype">double</span>(i) / 255.0, g) * 255.0);
<a name="l02042"></a>02042         }
<a name="l02043"></a>02043     }
<a name="l02044"></a>02044 
<a name="l02045"></a>02045 
<a name="l02046"></a>02046     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l02047"></a><a class="code" href="classagg_1_1rasterizer.html#abc5dbf772114787b7c14ec643e33e339">02047</a>     <span class="keywordtype">void</span> <a class="code" href="classagg_1_1rasterizer.html#aa4384b0f123ff4fc0eff7b7b6ab62b9f">rasterizer::gamma</a>(<span class="keyword">const</span> <a class="code" href="namespaceagg.html#a73de6e179616b2843e3405721989dedf">int8u</a>* g)
<a name="l02048"></a>02048     {
<a name="l02049"></a>02049         memcpy(<a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>, g, <span class="keyword">sizeof</span>(<a class="code" href="classagg_1_1rasterizer.html#a8e62a498107f319de7cc718120b59a2b">m_gamma</a>));
<a name="l02050"></a>02050     }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <span class="comment">//------------------------------------------------------------------------</span>
<a name="l02054"></a><a class="code" href="classagg_1_1rasterizer.html#aea20152b4f05c38fb5d2af9dee38ec02">02054</a>     <span class="keywordtype">bool</span> <a class="code" href="classagg_1_1rasterizer.html#aea20152b4f05c38fb5d2af9dee38ec02">rasterizer::hit_test</a>(<span class="keywordtype">int</span> tx, <span class="keywordtype">int</span> ty)
<a name="l02055"></a>02055     {
<a name="l02056"></a>02056         <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* <span class="keyword">const</span>* cells = <a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#a44752016da5a9c3b091a57de5c2ee03d">cells</a>();
<a name="l02057"></a>02057         <span class="keywordflow">if</span>(<a class="code" href="classagg_1_1rasterizer.html#a24a1d77a475dd0125f04ac68ca664b48">m_outline</a>.<a class="code" href="classagg_1_1outline.html#ae9de12597ec54d71a5566f5183ca4125">num_cells</a>() == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059         <span class="keywordtype">int</span> x, y;
<a name="l02060"></a>02060         <span class="keywordtype">int</span> cover;
<a name="l02061"></a>02061         <span class="keywordtype">int</span> alpha;
<a name="l02062"></a>02062         <span class="keywordtype">int</span> area;
<a name="l02063"></a>02063 
<a name="l02064"></a>02064         cover = 0;
<a name="l02065"></a>02065         <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* cur_cell = *cells++;
<a name="l02066"></a>02066         <span class="keywordflow">for</span>(;;)
<a name="l02067"></a>02067         {
<a name="l02068"></a>02068             <span class="keyword">const</span> <a class="code" href="structagg_1_1cell.html">cell</a>* start_cell = cur_cell;
<a name="l02069"></a>02069 
<a name="l02070"></a>02070             <span class="keywordtype">int</span> coord  = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a>;
<a name="l02071"></a>02071             x = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a>;
<a name="l02072"></a>02072             y = cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a5b9100d7f8b5d84348db33bf4e0cbf78">y</a>;
<a name="l02073"></a>02073 
<a name="l02074"></a>02074             <span class="keywordflow">if</span>(y &gt; ty) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02075"></a>02075 
<a name="l02076"></a>02076             area   = start_cell-&gt;<a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a>;
<a name="l02077"></a>02077             cover += start_cell-&gt;<a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>;
<a name="l02078"></a>02078 
<a name="l02079"></a>02079             <span class="keywordflow">while</span>((cur_cell = *cells++) != 0)
<a name="l02080"></a>02080             {
<a name="l02081"></a>02081                 <span class="keywordflow">if</span>(cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#aacbbabc0d1488a2faaa81af25f7ccb5b">packed_coord</a> != coord) <span class="keywordflow">break</span>;
<a name="l02082"></a>02082                 area  += cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a19b1fce205de103d9726666d5e22740c">area</a>;
<a name="l02083"></a>02083                 cover += cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a4a5ced9c3e4766f897e0ca054850c65c">cover</a>;
<a name="l02084"></a>02084             }
<a name="l02085"></a>02085 
<a name="l02086"></a>02086             <span class="keywordflow">if</span>(area)
<a name="l02087"></a>02087             {
<a name="l02088"></a>02088                 alpha = <a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">calculate_alpha</a>((cover &lt;&lt; (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a> + 1)) - area);
<a name="l02089"></a>02089                 <span class="keywordflow">if</span>(alpha)
<a name="l02090"></a>02090                 {
<a name="l02091"></a>02091                     <span class="keywordflow">if</span>(tx == x &amp;&amp; ty == y) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02092"></a>02092                 }
<a name="l02093"></a>02093                 x++;
<a name="l02094"></a>02094             }
<a name="l02095"></a>02095 
<a name="l02096"></a>02096             <span class="keywordflow">if</span>(!cur_cell) <span class="keywordflow">break</span>;
<a name="l02097"></a>02097 
<a name="l02098"></a>02098             <span class="keywordflow">if</span>(cur_cell-&gt;<a class="code" href="structagg_1_1cell.html#a50dd0d53562b988d4638af6fbfdbe2ec">x</a> &gt; x)
<a name="l02099"></a>02099             {
<a name="l02100"></a>02100                 alpha = <a class="code" href="classagg_1_1rasterizer.html#a82574b32efa305226ffdcbf3a9153e4c">calculate_alpha</a>(cover &lt;&lt; (<a class="code" href="namespaceagg.html#a5a7f5efba14872c770972a048c2b1a33a643c720e9c73332fcde460f8ba4c7f79">poly_base_shift</a> + 1));
<a name="l02101"></a>02101                 <span class="keywordflow">if</span>(alpha)
<a name="l02102"></a>02102                 {
<a name="l02103"></a>02103                     <span class="keywordflow">if</span>(ty == y &amp;&amp; tx &gt;= x &amp;&amp; tx &lt;= cur_cell-&gt;x) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02104"></a>02104                 }
<a name="l02105"></a>02105             }
<a name="l02106"></a>02106         }
<a name="l02107"></a>02107         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02108"></a>02108     }
<a name="l02109"></a>02109 }
<a name="l02110"></a>02110 
<a name="l02111"></a>02111 <span class="preprocessor">#endif // AGGLITE_H</span>
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jan 18 2012 15:02:40 for osgEarth by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
