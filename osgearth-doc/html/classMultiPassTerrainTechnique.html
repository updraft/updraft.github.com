<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>osgEarth: MultiPassTerrainTechnique Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">osgEarth&#160;<span id="projectnumber">2.1.1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<h1>MultiPassTerrainTechnique Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="MultiPassTerrainTechnique" --><!-- doxytag: inherits="TerrainTechnique" --><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png"/> Inheritance diagram for MultiPassTerrainTechnique:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique__inherit__graph.png" border="0" usemap="#MultiPassTerrainTechnique_inherit__map" alt="Inheritance graph"/></div>
<map name="MultiPassTerrainTechnique_inherit__map" id="MultiPassTerrainTechnique_inherit__map">
<area shape="rect" id="node2" href="classTerrainTechnique.html" title="TerrainTechnique" alt="" coords="33,83,156,112"/><area shape="rect" id="node4" href="classosg_1_1Object.html" title="Object" alt="" coords="65,5,124,35"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png"/> Collaboration diagram for MultiPassTerrainTechnique:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique__coll__graph.png" border="0" usemap="#MultiPassTerrainTechnique_coll__map" alt="Collaboration graph"/></div>
<map name="MultiPassTerrainTechnique_coll__map" id="MultiPassTerrainTechnique_coll__map">
<area shape="rect" id="node2" href="classTerrainTechnique.html" title="TerrainTechnique" alt="" coords="143,309,265,339"/><area shape="rect" id="node4" href="classosg_1_1Object.html" title="Object" alt="" coords="145,213,204,243"/><area shape="rect" id="node6" href="classTile.html" title="Tile" alt="" coords="228,213,271,243"/><area shape="rect" id="node8" href="classosgEarth_1_1TileKey.html" title="osgEarth::TileKey" alt="" coords="15,117,140,147"/><area shape="rect" id="node11" href="classosgEarth_1_1GeoExtent.html" title="osgEarth::GeoExtent" alt="" coords="5,5,149,35"/><area shape="rect" id="node14" href="classosgEarth_1_1Threading_1_1ReadWriteMutex.html" title="osgEarth::Threading::ReadWriteMutex" alt="" coords="241,117,487,147"/><area shape="rect" id="node16" href="classosgEarth_1_1Threading_1_1Event.html" title="osgEarth::Threading::Event" alt="" coords="273,5,455,35"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classMultiPassTerrainTechnique-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a499cd6c6540e2872fdbfcfb833f8eb8e">MultiPassTerrainTechnique</a> (<a class="el" href="classosgEarth_1_1TextureCompositor.html">TextureCompositor</a> *texCompositor=0L)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a7da30f51f391a83e8bd3d80feb0a7bd4">MultiPassTerrainTechnique</a> (const <a class="el" href="classMultiPassTerrainTechnique.html">MultiPassTerrainTechnique</a> &amp;, const osg::CopyOp &amp;copyop=osg::CopyOp::SHALLOW_COPY)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a6d19c0ebf8fd483b1a0b1e0c6be367a3">META_Object</a> (osgEarth, <a class="el" href="classMultiPassTerrainTechnique.html">MultiPassTerrainTechnique</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual osgTerrain::Locator *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a54f024654c8e5692b7cff298900c082e">computeMasterLocator</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual osg::Vec3d&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#ab072653160a22e1639eab3868754e2a1">computeCenterModel</a> (osgTerrain::Locator *masterLocator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#acf8ea7a0066ff18041032c2eb92a9831">generateGeometry</a> (osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual osg::Geometry *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a6a51f84834e74021f90e6e0a88e2e3c7">createGeometryPrototype</a> (osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">osg::Geode *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a4cda8b087c77fb24528f69a2f2a11ac3">createPass</a> (unsigned int order, const <a class="el" href="classCustomColorLayer.html">CustomColorLayer</a> *layer, osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel, osg::Geometry *geometry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a38d481dd4dc82bf06ebd422983e87536">traverse</a> (osg::NodeVisitor &amp;nv)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a5c694f7e2aa6aa202b11a557bebef00c">releaseGLObjects</a> (osg::State *=0) const </td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#aa4691e3140cd2e2575a52c704f17f00b">updateTransparency</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a7925e25c36484bbd58a87eba222388dc">updateGeometry</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a20f027fd313892654803391b548e1263">~MultiPassTerrainTechnique</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">osg::ref_ptr<br class="typebreak"/>
&lt; osg::MatrixTransform &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">osg::ref_ptr&lt; osg::Group &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">osg::ref_ptr&lt; <a class="el" href="classosgEarth_1_1TextureCompositor.html">TextureCompositor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_source.html#l00036">36</a> of file <a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a499cd6c6540e2872fdbfcfb833f8eb8e"></a><!-- doxytag: member="MultiPassTerrainTechnique::MultiPassTerrainTechnique" ref="a499cd6c6540e2872fdbfcfb833f8eb8e" args="(TextureCompositor *texCompositor=0L)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MultiPassTerrainTechnique::MultiPassTerrainTechnique </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classosgEarth_1_1TextureCompositor.html">TextureCompositor</a> *&#160;</td>
          <td class="paramname"><em>texCompositor</em> = <code>0L</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00068">68</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                       :
<a class="code" href="classTerrainTechnique.html#a7c4174de7bd884c6be268dfaae7559f2">TerrainTechnique</a>(),
<span class="comment">//osgTerrain::TerrainTechnique(),</span>
<a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a>(<span class="keyword">false</span>),
<a class="code" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a>( texCompositor )
{
    this-&gt;setThreadSafeRefUnref( <span class="keyword">true</span> );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7da30f51f391a83e8bd3d80feb0a7bd4"></a><!-- doxytag: member="MultiPassTerrainTechnique::MultiPassTerrainTechnique" ref="a7da30f51f391a83e8bd3d80feb0a7bd4" args="(const MultiPassTerrainTechnique &amp;, const osg::CopyOp &amp;copyop=osg::CopyOp::SHALLOW_COPY)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MultiPassTerrainTechnique::MultiPassTerrainTechnique </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMultiPassTerrainTechnique.html">MultiPassTerrainTechnique</a> &amp;&#160;</td>
          <td class="paramname"><em>mt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const osg::CopyOp &amp;&#160;</td>
          <td class="paramname"><em>copyop</em> = <code>osg::CopyOp::SHALLOW_COPY</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Copy constructor using CopyOp to manage deep vs shallow copy. </p>

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00077">77</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                                                :
<a class="code" href="classTerrainTechnique.html#a7c4174de7bd884c6be268dfaae7559f2">TerrainTechnique</a>(mt,copyop)
{
    <a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a> = mt.<a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a>;
    <a class="code" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a> = mt.<a class="code" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a>.get();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a20f027fd313892654803391b548e1263"></a><!-- doxytag: member="MultiPassTerrainTechnique::~MultiPassTerrainTechnique" ref="a20f027fd313892654803391b548e1263" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MultiPassTerrainTechnique::~MultiPassTerrainTechnique </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00084">84</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ab072653160a22e1639eab3868754e2a1"></a><!-- doxytag: member="MultiPassTerrainTechnique::computeCenterModel" ref="ab072653160a22e1639eab3868754e2a1" args="(osgTerrain::Locator *masterLocator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::Vec3d MultiPassTerrainTechnique::computeCenterModel </td>
          <td>(</td>
          <td class="paramtype">osgTerrain::Locator *&#160;</td>
          <td class="paramname"><em>masterLocator</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00128">128</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!masterLocator) <span class="keywordflow">return</span> osg::Vec3d(0.0,0.0,0.0);
  
    osgTerrain::Layer*   elevationLayer   = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed">getElevationLayer</a>();
    osgTerrain::Locator* elevationLocator = elevationLayer ? elevationLayer-&gt;getLocator() : 0;
    osgTerrain::Locator* colorLocator     = 0L;
    
    <span class="keywordflow">if</span> (!elevationLocator) elevationLocator = masterLocator;
    <span class="keywordflow">if</span> (!colorLocator) colorLocator = masterLocator;

    osg::Vec3d bottomLeftNDC(DBL_MAX, DBL_MAX, 0.0);
    osg::Vec3d topRightNDC(-DBL_MAX, -DBL_MAX, 0.0);
    
    <span class="keywordflow">if</span> (elevationLayer)
    {
        <span class="keywordflow">if</span> (elevationLocator!= masterLocator)
        {
            masterLocator-&gt;computeLocalBounds(*elevationLocator, bottomLeftNDC, topRightNDC);
        }
        <span class="keywordflow">else</span>
        {
            bottomLeftNDC.x() = osg::minimum(bottomLeftNDC.x(), 0.0);
            bottomLeftNDC.y() = osg::minimum(bottomLeftNDC.y(), 0.0);
            topRightNDC.x() = osg::maximum(topRightNDC.x(), 1.0);
            topRightNDC.y() = osg::maximum(topRightNDC.y(), 1.0);
        }
    }

    <span class="comment">//if (colorLayer)</span>
    <span class="comment">//{</span>
    <span class="comment">//    if (colorLocator!= masterLocator)</span>
    <span class="comment">//    {</span>
    <span class="comment">//        masterLocator-&gt;computeLocalBounds(*colorLocator, bottomLeftNDC, topRightNDC);</span>
    <span class="comment">//    }</span>
    <span class="comment">//    else</span>
    <span class="comment">//    {</span>
    <span class="comment">//        bottomLeftNDC.x() = osg::minimum(bottomLeftNDC.x(), 0.0);</span>
    <span class="comment">//        bottomLeftNDC.y() = osg::minimum(bottomLeftNDC.y(), 0.0);</span>
    <span class="comment">//        topRightNDC.x() = osg::maximum(topRightNDC.x(), 1.0);</span>
    <span class="comment">//        topRightNDC.y() = osg::maximum(topRightNDC.y(), 1.0);</span>
    <span class="comment">//    }</span>
    <span class="comment">//}</span>

    <span class="comment">//OE_DEBUG&lt;&lt;&quot;bottomLeftNDC = &quot;&lt;&lt;bottomLeftNDC&lt;&lt;std::endl;</span>
    <span class="comment">//OE_DEBUG&lt;&lt;&quot;topRightNDC = &quot;&lt;&lt;topRightNDC&lt;&lt;std::endl;</span>

    <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a> = <span class="keyword">new</span> osg::MatrixTransform;

    osg::Vec3d centerNDC = (bottomLeftNDC + topRightNDC)*0.5;
    osg::Vec3d centerModel = (bottomLeftNDC + topRightNDC)*0.5;
    masterLocator-&gt;convertLocalToModel(centerNDC, centerModel);
    
    <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;setMatrix(osg::Matrix::translate(centerModel));
    
    <span class="keywordflow">return</span> centerModel;
}
</pre></div>
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_cgraph" id="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_cgraph">
<area shape="rect" id="node3" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="365,5,520,35"/></map>
</div>
</p>

<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_icgraph" id="classMultiPassTerrainTechnique_ab072653160a22e1639eab3868754e2a1_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e" title="MultiPassTerrainTechnique::init" alt="" coords="365,5,571,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a54f024654c8e5692b7cff298900c082e"></a><!-- doxytag: member="MultiPassTerrainTechnique::computeMasterLocator" ref="a54f024654c8e5692b7cff298900c082e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osgTerrain::Locator * MultiPassTerrainTechnique::computeMasterLocator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00114">114</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    osgTerrain::Layer* elevationLayer = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed">getElevationLayer</a>();
    osgTerrain::Locator* locator = elevationLayer ? elevationLayer-&gt;getLocator() : 0L;

    <span class="keywordflow">if</span> ( !locator )
    {
        <a class="code" href="Notify.html#a29c29c62ae325bf5871ce5b1695c1720">OE_NOTICE</a> &lt;&lt; <span class="stringliteral">&quot;Problem, no locator found in any of the terrain layers&quot;</span>&lt;&lt;std::endl;
        <span class="keywordflow">return</span> 0;
    }
    <span class="keywordflow">return</span> locator;
}
</pre></div>
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_cgraph" id="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_cgraph">
<area shape="rect" id="node3" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="376,5,531,35"/></map>
</div>
</p>

<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_icgraph" id="classMultiPassTerrainTechnique_a54f024654c8e5692b7cff298900c082e_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e" title="MultiPassTerrainTechnique::init" alt="" coords="376,5,581,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6a51f84834e74021f90e6e0a88e2e3c7"></a><!-- doxytag: member="MultiPassTerrainTechnique::createGeometryPrototype" ref="a6a51f84834e74021f90e6e0a88e2e3c7" args="(osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::Geometry * MultiPassTerrainTechnique::createGeometryPrototype </td>
          <td>(</td>
          <td class="paramtype">osgTerrain::Locator *&#160;</td>
          <td class="paramname"><em>masterLocator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const osg::Vec3d &amp;&#160;</td>
          <td class="paramname"><em>centerModel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00187">187</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{  
    osgTerrain::Layer* elevationLayer = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed">getElevationLayer</a>();

    osg::Geometry* geometry = <span class="keyword">new</span> osg::Geometry;

        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numRows = 20;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numColumns = 20;
    
    <span class="keywordflow">if</span> (elevationLayer)
    {
        numColumns = elevationLayer-&gt;getNumColumns();
        numRows = elevationLayer-&gt;getNumRows();
    }
    
    <span class="keywordtype">float</span> sampleRatio = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>() ? <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>()-&gt;<a class="code" href="classTerrain.html#afc533f56374093322731448e6a4b813e">getSampleRatio</a>() : 1.0f;
    
    <span class="keywordtype">double</span> i_sampleFactor = 1.0;
    <span class="keywordtype">double</span> j_sampleFactor = 1.0;

    <span class="comment">// OE_NOTICE&lt;&lt;&quot;Sample ratio=&quot;&lt;&lt;sampleRatio&lt;&lt;std::endl;</span>

    <span class="keywordflow">if</span> (sampleRatio!=1.0f)
    {
    
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalNumColumns = numColumns;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalNumRows = numRows;
    
        numColumns = osg::maximum((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<span class="keywordtype">float</span>(originalNumColumns)*sqrtf(sampleRatio)), 4u);
        numRows = osg::maximum((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<span class="keywordtype">float</span>(originalNumRows)*sqrtf(sampleRatio)),4u);

        i_sampleFactor = double(originalNumColumns-1)/double(numColumns-1);
        j_sampleFactor = double(originalNumRows-1)/double(numRows-1);
    }
    
    

    <span class="comment">//bool treatBoundariesToValidDataAsDefaultValue = _tile-&gt;getTreatBoundariesToValidDataAsDefaultValue();</span>
    <span class="comment">//OE_DEBUG&lt;&lt;&quot;TreatBoundariesToValidDataAsDefaultValue=&quot;&lt;&lt;treatBoundariesToValidDataAsDefaultValue&lt;&lt;std::endl;</span>
    
    <span class="keywordtype">float</span> skirtHeight = 0.0f;
    osgTerrain::HeightFieldLayer* hfl = <span class="keyword">dynamic_cast&lt;</span>osgTerrain::HeightFieldLayer*<span class="keyword">&gt;</span>(elevationLayer);
    <span class="keywordflow">if</span> (hfl &amp;&amp; hfl-&gt;getHeightField()) 
    {
        skirtHeight = hfl-&gt;getHeightField()-&gt;getSkirtHeight();
    }
    
    <span class="keywordtype">bool</span> createSkirt = skirtHeight != 0.0f;
  
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVerticesInBody = numColumns*numRows;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVerticesInSkirt = createSkirt ? numColumns*2 + numRows*2 - 4 : 0;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVertices = numVerticesInBody+numVerticesInSkirt;

    <span class="comment">// allocate and assign vertices</span>
    osg::ref_ptr&lt;osg::Vec3Array&gt; vertices = <span class="keyword">new</span> osg::Vec3Array;
    vertices-&gt;reserve(numVertices);
    geometry-&gt;setVertexArray(vertices.get());

    <span class="comment">// allocate and assign normals</span>
    osg::ref_ptr&lt;osg::Vec3Array&gt; normals = <span class="keyword">new</span> osg::Vec3Array;
    <span class="keywordflow">if</span> (normals.valid()) normals-&gt;reserve(numVertices);
    geometry-&gt;setNormalArray(normals.get());
    geometry-&gt;setNormalBinding(osg::Geometry::BIND_PER_VERTEX);
    
    <span class="comment">//float minHeight = 0.0;</span>
    <span class="keywordtype">float</span> scaleHeight = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>() ? <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>()-&gt;<a class="code" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4">getVerticalScale</a>() : 1.0f;

    <span class="comment">//Reserve space for the elevations</span>
    osg::ref_ptr&lt;osg::FloatArray&gt; elevations = <span class="keyword">new</span> osg::FloatArray;
    <span class="keywordflow">if</span> (elevations.valid()) elevations-&gt;reserve(numVertices);

    <span class="comment">// allocate and assign color</span>
    osg::ref_ptr&lt;osg::Vec4Array&gt; <a class="code" href="osgearth__tilesource_8cpp.html#a9e71186980a23d60f4d42454c5b968f3">colors</a> = <span class="keyword">new</span> osg::Vec4Array(1);
    (*colors)[0].set(1.0f,1.0f,1.0f,1.0f);    
    geometry-&gt;setColorArray(colors.get());
    geometry-&gt;setColorBinding(osg::Geometry::BIND_OVERALL);

    <span class="keyword">typedef</span> std::vector&lt;int&gt; Indices;
    Indices indices(numVertices, -1);
    
    <span class="comment">// populate vertex and tex coord arrays</span>
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
    <span class="keywordflow">for</span>(j=0; j&lt;numRows; ++j)
    {
        <span class="keywordflow">for</span>(i=0; i&lt;numColumns; ++i)
        {
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iv = j*numColumns + i;
            osg::Vec3d ndc( ((<span class="keywordtype">double</span>)i)/(<span class="keywordtype">double</span>)(numColumns-1), ((<span class="keywordtype">double</span>)j)/(<span class="keywordtype">double</span>)(numRows-1), 0.0);
     
            <span class="keywordtype">bool</span> validValue = <span class="keyword">true</span>;
     
            
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_equiv = i_sampleFactor==1.0 ? i : (<span class="keywordtype">unsigned</span> int) (<span class="keywordtype">double</span>(i)*i_sampleFactor);
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_equiv = i_sampleFactor==1.0 ? j : (<span class="keywordtype">unsigned</span> int) (<span class="keywordtype">double</span>(j)*j_sampleFactor);
            
            <span class="keywordflow">if</span> (elevationLayer)
            {
                <span class="keywordtype">float</span> value = 0.0f;
                validValue = elevationLayer-&gt;getValidValue(i_equiv,j_equiv, value);
                <span class="comment">// OE_INFO&lt;&lt;&quot;i=&quot;&lt;&lt;i&lt;&lt;&quot; j=&quot;&lt;&lt;j&lt;&lt;&quot; z=&quot;&lt;&lt;value&lt;&lt;std::endl;</span>
                ndc.z() = value*scaleHeight;
            }
            
            <span class="keywordflow">if</span> (validValue)
            {
                indices[iv] = vertices-&gt;size();
            
                osg::Vec3d model;
                masterLocator-&gt;convertLocalToModel(ndc, model);

                (*vertices).push_back(model - centerModel);

                <span class="keywordflow">if</span> (elevations.valid())
                {
                    (*elevations).push_back(ndc.z());
                }

                <span class="comment">// compute the local normal</span>
                osg::Vec3d ndc_one = ndc; ndc_one.z() += 1.0;
                osg::Vec3d model_one;
                masterLocator-&gt;convertLocalToModel(ndc_one, model_one);
                model_one = model_one - model;
                model_one.normalize();            
                (*normals).push_back(model_one);
            }
            <span class="keywordflow">else</span>
            {
                indices[iv] = -1;
            }
        }
    }
    
    <span class="comment">// populate primitive sets</span>
<span class="comment">//    bool optimizeOrientations = elevations!=0;</span>
    <span class="keywordtype">bool</span> swapOrientation = !(masterLocator-&gt;orientationOpenGL());
    
    osg::ref_ptr&lt;osg::DrawElementsUInt&gt; elements = <span class="keyword">new</span> osg::DrawElementsUInt(GL_TRIANGLES);
    elements-&gt;reserve((numRows-1) * (numColumns-1) * 6);

    geometry-&gt;addPrimitiveSet(elements.get());

    <span class="keywordflow">for</span>(j=0; j&lt;numRows-1; ++j)
    {
        <span class="keywordflow">for</span>(i=0; i&lt;numColumns-1; ++i)
        {
            <span class="keywordtype">int</span> i00;
            <span class="keywordtype">int</span> i01;
            <span class="keywordflow">if</span> (swapOrientation)
            {
                i01 = j*numColumns + i;
                i00 = i01+numColumns;
            }
            <span class="keywordflow">else</span>
            {
                i00 = j*numColumns + i;
                i01 = i00+numColumns;
            }

            <span class="keywordtype">int</span> i10 = i00+1;
            <span class="keywordtype">int</span> i11 = i01+1;

            <span class="comment">// remap indices to final vertex positions</span>
            i00 = indices[i00];
            i01 = indices[i01];
            i10 = indices[i10];
            i11 = indices[i11];
            
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numValid = 0;
            <span class="keywordflow">if</span> (i00&gt;=0) ++numValid;
            <span class="keywordflow">if</span> (i01&gt;=0) ++numValid;
            <span class="keywordflow">if</span> (i10&gt;=0) ++numValid;
            <span class="keywordflow">if</span> (i11&gt;=0) ++numValid;
            
            <span class="keywordflow">if</span> (numValid==4)
            {
                <span class="keywordtype">float</span> e00 = (*elevations)[i00];
                <span class="keywordtype">float</span> e10 = (*elevations)[i10];
                <span class="keywordtype">float</span> e01 = (*elevations)[i01];
                <span class="keywordtype">float</span> e11 = (*elevations)[i11];

                <span class="keywordflow">if</span> (fabsf(e00-e11)&lt;fabsf(e01-e10))
                {
                    elements-&gt;push_back(i01);
                    elements-&gt;push_back(i00);
                    elements-&gt;push_back(i11);

                    elements-&gt;push_back(i00);
                    elements-&gt;push_back(i10);
                    elements-&gt;push_back(i11);
                }
                <span class="keywordflow">else</span>
                {
                    elements-&gt;push_back(i01);
                    elements-&gt;push_back(i00);
                    elements-&gt;push_back(i10);

                    elements-&gt;push_back(i01);
                    elements-&gt;push_back(i10);
                    elements-&gt;push_back(i11);
                }
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (numValid==3)
            {
                <span class="keywordflow">if</span> (i00&gt;=0) elements-&gt;push_back(i00);
                <span class="keywordflow">if</span> (i01&gt;=0) elements-&gt;push_back(i01);
                <span class="keywordflow">if</span> (i11&gt;=0) elements-&gt;push_back(i11);
                <span class="keywordflow">if</span> (i10&gt;=0) elements-&gt;push_back(i10);
            }
            
        }
    }
    
    osg::ref_ptr&lt;osg::Vec3Array&gt; skirtVectors = <span class="keyword">new</span> osg::Vec3Array((*normals));
    
    <span class="keywordflow">if</span> (elevationLayer)
    {
        osgUtil::SmoothingVisitor smoother;
        smoother.smooth(*geometry);
        
        normals = <span class="keyword">dynamic_cast&lt;</span>osg::Vec3Array*<span class="keyword">&gt;</span>(geometry-&gt;getNormalArray());
        
        <span class="keywordflow">if</span> (!normals) createSkirt = <span class="keyword">false</span>;
    }

    <span class="keywordflow">if</span> (createSkirt)
    {
        osg::ref_ptr&lt;osg::DrawElementsUShort&gt; skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);

        <span class="comment">// create bottom skirt vertices</span>
        <span class="keywordtype">int</span> r,c;
        r=0;
        <span class="keywordflow">for</span>(c=0;c&lt;static_cast&lt;int&gt;(numColumns);++c)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_i = vertices-&gt;size(); <span class="comment">// index of new index of added skirt point</span>
                osg::Vec3 new_v = (*vertices)[orig_i] - ((*skirtVectors)[orig_i])*skirtHeight;
                (*vertices).push_back(new_v);
                <span class="keywordflow">if</span> (normals.valid()) (*normals).push_back((*normals)[orig_i]);

                skirtDrawElements-&gt;push_back(orig_i);
                skirtDrawElements-&gt;push_back(new_i);
            }
            <span class="keywordflow">else</span>
            {
                <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
                {
                    geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
                    skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
                }
                
            }
        }

        <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
        {
            geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
            skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
        }

        <span class="comment">// create right skirt vertices</span>
        c=numColumns-1;
        <span class="keywordflow">for</span>(r=0;r&lt;static_cast&lt;int&gt;(numRows);++r)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_i = vertices-&gt;size(); <span class="comment">// index of new index of added skirt point</span>
                osg::Vec3 new_v = (*vertices)[orig_i] - ((*skirtVectors)[orig_i])*skirtHeight;
                (*vertices).push_back(new_v);
                <span class="keywordflow">if</span> (normals.valid()) (*normals).push_back((*normals)[orig_i]);
                skirtDrawElements-&gt;push_back(orig_i);
                skirtDrawElements-&gt;push_back(new_i);
            }
            <span class="keywordflow">else</span>
            {
                <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
                {
                    geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
                    skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
                }
                
            }
        }

        <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
        {
            geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
            skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
        }

        <span class="comment">// create top skirt vertices</span>
        r=numRows-1;
        <span class="keywordflow">for</span>(c=numColumns-1;c&gt;=0;--c)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_i = vertices-&gt;size(); <span class="comment">// index of new index of added skirt point</span>
                osg::Vec3 new_v = (*vertices)[orig_i] - ((*skirtVectors)[orig_i])*skirtHeight;
                (*vertices).push_back(new_v);
                <span class="keywordflow">if</span> (normals.valid()) (*normals).push_back((*normals)[orig_i]);
                skirtDrawElements-&gt;push_back(orig_i);
                skirtDrawElements-&gt;push_back(new_i);
            }
            <span class="keywordflow">else</span>
            {
                <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
                {
                    geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
                    skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
                }
                
            }
        }

        <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
        {
            geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
            skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
        }

        <span class="comment">// create left skirt vertices</span>
        c=0;
        <span class="keywordflow">for</span>(r=numRows-1;r&gt;=0;--r)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_i = vertices-&gt;size(); <span class="comment">// index of new index of added skirt point</span>
                osg::Vec3 new_v = (*vertices)[orig_i] - ((*skirtVectors)[orig_i])*skirtHeight;
                (*vertices).push_back(new_v);
                <span class="keywordflow">if</span> (normals.valid()) (*normals).push_back((*normals)[orig_i]);
                skirtDrawElements-&gt;push_back(orig_i);
                skirtDrawElements-&gt;push_back(new_i);
            }
            <span class="keywordflow">else</span>
            {
                <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
                {
                    geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
                    skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
                }
                
            }
        }

        <span class="keywordflow">if</span> (!skirtDrawElements-&gt;empty())
        {
            geometry-&gt;addPrimitiveSet(skirtDrawElements.get());
            skirtDrawElements = <span class="keyword">new</span> osg::DrawElementsUShort(GL_QUAD_STRIP);
        }
    }


    geometry-&gt;setUseDisplayList(<span class="keyword">false</span>);
    geometry-&gt;setUseVertexBufferObjects(<span class="keyword">true</span>);

        <span class="keywordflow">return</span> geometry;
}
</pre></div>
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_cgraph" id="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_cgraph">
<area shape="rect" id="node3" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="397,5,552,35"/><area shape="rect" id="node5" href="classTerrain.html#afc533f56374093322731448e6a4b813e" title="Terrain::getSampleRatio" alt="" coords="393,59,556,88"/><area shape="rect" id="node7" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b" title="Tile::getTerrain" alt="" coords="420,112,529,141"/><area shape="rect" id="node9" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4" title="Terrain::getVerticalScale" alt="" coords="392,165,557,195"/></map>
</div>
</p>

<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_icgraph" id="classMultiPassTerrainTechnique_a6a51f84834e74021f90e6e0a88e2e3c7_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#acf8ea7a0066ff18041032c2eb92a9831" title="MultiPassTerrainTechnique::generateGeometry" alt="" coords="393,5,687,35"/><area shape="rect" id="node5" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e" title="MultiPassTerrainTechnique::init" alt="" coords="736,5,941,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4cda8b087c77fb24528f69a2f2a11ac3"></a><!-- doxytag: member="MultiPassTerrainTechnique::createPass" ref="a4cda8b087c77fb24528f69a2f2a11ac3" args="(unsigned int order, const CustomColorLayer *layer, osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel, osg::Geometry *geometry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::Geode * MultiPassTerrainTechnique::createPass </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCustomColorLayer.html">CustomColorLayer</a> *&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osgTerrain::Locator *&#160;</td>
          <td class="paramname"><em>masterLocator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const osg::Vec3d &amp;&#160;</td>
          <td class="paramname"><em>centerModel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osg::Geometry *&#160;</td>
          <td class="paramname"><em>geometry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00549">549</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="HTTPClient_8cpp.html#ac6600c2662696d8b43a4deb6877c8591">OE_DEBUG</a> &lt;&lt; <span class="stringliteral">&quot;osgEarth::MultiPassTerrainTechnique createPass &quot;</span> &lt;&lt; order &lt;&lt; std::endl;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> binNumber = 1000;
    binNumber += order;
   
    osgTerrain::Layer* elevationLayer = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed">getElevationLayer</a>();

    <span class="comment">//Create a new geode to store the geometry</span>
    osg::Geode* geode = <span class="keyword">new</span> osg::Geode;
   
    <span class="comment">//Set up the pass </span>
    geode-&gt;getOrCreateStateSet()-&gt;setRenderBinDetails(binNumber, <span class="stringliteral">&quot;RenderBin&quot;</span>);
    geode-&gt;addDrawable(geometry);

    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numRows = 20;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numColumns = 20;
    
    <span class="keywordflow">if</span> (elevationLayer)
    {
        numColumns = elevationLayer-&gt;getNumColumns();
        numRows = elevationLayer-&gt;getNumRows();
    }
    
    <span class="keywordtype">float</span> sampleRatio = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>() ? <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>()-&gt;<a class="code" href="classTerrain.html#afc533f56374093322731448e6a4b813e">getSampleRatio</a>() : 1.0f;
    
    <span class="keywordtype">double</span> i_sampleFactor = 1.0;
    <span class="keywordtype">double</span> j_sampleFactor = 1.0;

    <span class="comment">// OE_NOTICE&lt;&lt;&quot;Sample ratio=&quot;&lt;&lt;sampleRatio&lt;&lt;std::endl;</span>

    <span class="keywordflow">if</span> (sampleRatio!=1.0f)
    {
    
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalNumColumns = numColumns;
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> originalNumRows = numRows;
    
        numColumns = osg::maximum((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<span class="keywordtype">float</span>(originalNumColumns)*sqrtf(sampleRatio)), 4u);
        numRows = osg::maximum((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (<span class="keywordtype">float</span>(originalNumRows)*sqrtf(sampleRatio)),4u);

        i_sampleFactor = double(originalNumColumns-1)/double(numColumns-1);
        j_sampleFactor = double(originalNumRows-1)/double(numRows-1);
    }

    <span class="comment">//bool treatBoundariesToValidDataAsDefaultValue = _terrainTile-&gt;getTreatBoundariesToValidDataAsDefaultValue();</span>
    <span class="comment">//OE_DEBUG&lt;&lt;&quot;TreatBoundariesToValidDataAsDefaultValue=&quot;&lt;&lt;treatBoundariesToValidDataAsDefaultValue&lt;&lt;std::endl;</span>
    
    <span class="keywordtype">float</span> skirtHeight = 0.0f;
    osgTerrain::HeightFieldLayer* hfl = <span class="keyword">dynamic_cast&lt;</span>osgTerrain::HeightFieldLayer*<span class="keyword">&gt;</span>(elevationLayer);
    <span class="keywordflow">if</span> (hfl &amp;&amp; hfl-&gt;getHeightField()) 
    {
        skirtHeight = hfl-&gt;getHeightField()-&gt;getSkirtHeight();
    }
    
    <span class="keywordtype">bool</span> createSkirt = skirtHeight != 0.0f;
  
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVerticesInBody = numColumns*numRows;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVerticesInSkirt = createSkirt ? numColumns*2 + numRows*2 - 4 : 0;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numVertices = numVerticesInBody+numVerticesInSkirt;

    <span class="comment">//float minHeight = 0.0;</span>
    <span class="keywordtype">float</span> scaleHeight = <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>() ? <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b">getTerrain</a>()-&gt;<a class="code" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4">getVerticalScale</a>() : 1.0f;

    osg::ref_ptr&lt;osg::Vec2Array&gt; texCoords;

    <span class="keyword">const</span> osgTerrain::Locator* locator = colorLayer ? colorLayer-&gt;getLocator() : 0L;
    <span class="keywordflow">if</span> ( locator )
    {
        texCoords = <span class="keyword">new</span> osg::Vec2Array;
        texCoords-&gt;reserve(numVertices);
        <a class="code" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a>-&gt;assignTexCoordArray( geometry, colorLayer-&gt;getUID(), texCoords.get() );
    }

    <span class="keyword">const</span> osgTerrain::Locator* colorLocator = locator ? locator : masterLocator;

    <span class="comment">// allocate and assign color</span>
    osg::ref_ptr&lt;osg::Vec4Array&gt; <a class="code" href="osgearth__tilesource_8cpp.html#a9e71186980a23d60f4d42454c5b968f3">colors</a> = <span class="keyword">new</span> osg::Vec4Array(1);
    (*colors)[0].set(1.0f,1.0f,1.0f,1.0f);    
    geometry-&gt;setColorArray(colors.get());
    geometry-&gt;setColorBinding(osg::Geometry::BIND_OVERALL);

    <span class="keyword">typedef</span> std::vector&lt;int&gt; Indices;
    Indices indices(numVertices, -1);
    
    <span class="comment">// populate vertex and tex coord arrays</span>
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
        <span class="keywordtype">int</span> vindex = 0;
    <span class="keywordflow">for</span>(j=0; j&lt;numRows; ++j)
    {
        <span class="keywordflow">for</span>(i=0; i&lt;numColumns; ++i)
        {
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iv = j*numColumns + i;
            osg::Vec3d ndc( ((<span class="keywordtype">double</span>)i)/(<span class="keywordtype">double</span>)(numColumns-1), ((<span class="keywordtype">double</span>)j)/(<span class="keywordtype">double</span>)(numRows-1), 0.0);
     
            <span class="keywordtype">bool</span> validValue = <span class="keyword">true</span>;

            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_equiv = i_sampleFactor==1.0 ? i : (<span class="keywordtype">unsigned</span> int) (<span class="keywordtype">double</span>(i)*i_sampleFactor);
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j_equiv = i_sampleFactor==1.0 ? j : (<span class="keywordtype">unsigned</span> int) (<span class="keywordtype">double</span>(j)*j_sampleFactor);
            
            <span class="keywordflow">if</span> (elevationLayer)
            {
                <span class="keywordtype">float</span> value = 0.0f;
                validValue = elevationLayer-&gt;getValidValue(i_equiv,j_equiv, value);
                <span class="comment">// OE_INFO&lt;&lt;&quot;i=&quot;&lt;&lt;i&lt;&lt;&quot; j=&quot;&lt;&lt;j&lt;&lt;&quot; z=&quot;&lt;&lt;value&lt;&lt;std::endl;</span>
                ndc.z() = value*scaleHeight;
            }
            
            <span class="keywordflow">if</span> (validValue)
            {
                indices[iv] = vindex++;

                                <span class="keywordflow">if</span> (texCoords.valid())
                                {
                                        osg::Vec3d model;
                                        masterLocator-&gt;convertLocalToModel(ndc, model);

                                        <span class="keywordflow">if</span> (colorLocator != masterLocator)
                                        {
                                                osg::Vec3d color_ndc;
                                                osgTerrain::Locator::convertLocalCoordBetween(*masterLocator, ndc, *colorLocator, color_ndc);
                                                texCoords-&gt;push_back(osg::Vec2(color_ndc.x(), color_ndc.y()));
                                        }
                                        <span class="keywordflow">else</span>
                                        {
                                                texCoords-&gt;push_back(osg::Vec2(ndc.x(), ndc.y()));
                                        }
                                }
                        }
            <span class="keywordflow">else</span>
            {
                indices[iv] = -1;
            }
        }
    }
    
    <span class="comment">// populate primitive sets</span>
<span class="comment">//    bool optimizeOrientations = elevations!=0;</span>
<span class="comment">//    bool swapOrientation = !(masterLocator-&gt;orientationOpenGL());    </span>

    <span class="keywordflow">if</span> (createSkirt)
    {
         <span class="comment">// create bottom skirt vertices</span>
        <span class="keywordtype">int</span> r,c;
        r=0;
        <span class="keywordflow">for</span>(c=0;c&lt;static_cast&lt;int&gt;(numColumns);++c)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordflow">if</span> (texCoords.valid()) texCoords-&gt;push_back((*texCoords)[orig_i]);               
            }
        }

        <span class="comment">// create right skirt vertices</span>
        c=numColumns-1;
        <span class="keywordflow">for</span>(r=0;r&lt;static_cast&lt;int&gt;(numRows);++r)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                 <span class="keywordflow">if</span> (texCoords.valid()) texCoords-&gt;push_back((*texCoords)[orig_i]);
            }
        }

        <span class="comment">// create top skirt vertices</span>
        r=numRows-1;
        <span class="keywordflow">for</span>(c=numColumns-1;c&gt;=0;--c)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordflow">if</span> (texCoords.valid()) texCoords-&gt;push_back((*texCoords)[orig_i]);               
            }
        }

        <span class="comment">// create left skirt vertices</span>
        c=0;
        <span class="keywordflow">for</span>(r=numRows-1;r&gt;=0;--r)
        {
            <span class="keywordtype">int</span> orig_i = indices[(r)*numColumns+c]; <span class="comment">// index of original vertex of grid</span>
            <span class="keywordflow">if</span> (orig_i&gt;=0)
            {
                <span class="keywordflow">if</span> (texCoords.valid()) texCoords-&gt;push_back((*texCoords)[orig_i]);               
            }
        }
    }

    geometry-&gt;setUseDisplayList(<span class="keyword">false</span>);
    geometry-&gt;setUseVertexBufferObjects(<span class="keyword">true</span>);

        <span class="comment">//TODO:  Should we do this for each geode?  </span>
    <span class="keywordflow">if</span> (osgDB::Registry::instance()-&gt;getBuildKdTreesHint()==osgDB::ReaderWriter::Options::BUILD_KDTREES &amp;&amp;
        osgDB::Registry::instance()-&gt;getKdTreeBuilder())
    {    
        <span class="comment">//osg::Timer_t before = osg::Timer::instance()-&gt;tick();</span>
        <span class="comment">//OE_NOTICE&lt;&lt;&quot;osgTerrain::GeometryTechnique::build kd tree&quot;&lt;&lt;std::endl;</span>
        osg::ref_ptr&lt;osg::KdTreeBuilder&gt; builder = osgDB::Registry::instance()-&gt;getKdTreeBuilder()-&gt;clone();
        <span class="comment">//buffer._geode-&gt;accept(*builder);</span>
        geode-&gt;accept(*builder);
        <span class="comment">//osg::Timer_t after = osg::Timer::instance()-&gt;tick();</span>
        <span class="comment">//OE_NOTICE&lt;&lt;&quot;KdTree build time &quot;&lt;&lt;osg::Timer::instance()-&gt;delta_m(before, after)&lt;&lt;std::endl;</span>
    }


    <span class="comment">//Apply the appropriate color layer to the pass</span>

    <span class="keywordflow">if</span> (colorLayer)
    {
        <span class="keyword">const</span> osg::Image* image = colorLayer-&gt;getImage();
        <span class="keywordflow">if</span> (image)
        {
            <span class="comment">//osgTerrain::ImageLayer* imageLayer = dynamic_cast&lt;osgTerrain::ImageLayer*&gt;(colorLayer);</span>
            <span class="comment">//osgTerrain::ContourLayer* contourLayer = dynamic_cast&lt;osgTerrain::ContourLayer*&gt;(colorLayer);</span>
            <span class="comment">//if (imageLayer)</span>
            <span class="comment">//{</span>

                osg::StateSet* stateset = geode-&gt;getOrCreateStateSet();

                <span class="comment">//Compress the image if it&#39;s not compressed and it is requested that we compress textures</span>

                osg::Image* img = <span class="keyword">const_cast&lt;</span>osg::Image*<span class="keyword">&gt;</span>(image);

                osg::Texture2D* texture2D = <span class="keyword">new</span> osg::Texture2D;
                texture2D-&gt;setImage( img );
                texture2D-&gt;setMaxAnisotropy(16.0f);
                texture2D-&gt;setResizeNonPowerOfTwoHint(<span class="keyword">false</span>);

                texture2D-&gt;setFilter( osg::Texture::MAG_FILTER, osg::Texture::LINEAR );
                <span class="keywordflow">if</span> (ImageUtils::isPowerOfTwo( img ) &amp;&amp; !(!img-&gt;isMipmap() &amp;&amp; ImageUtils::isCompressed(img)))
                {
                    texture2D-&gt;setFilter( osg::Texture::MIN_FILTER, osg::Texture::LINEAR_MIPMAP_LINEAR );
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="HTTPClient_8cpp.html#ac6600c2662696d8b43a4deb6877c8591">OE_DEBUG</a>&lt;&lt;<span class="stringliteral">&quot;[osgEarth::MultiPassTerrainTechnique] Disabling mipmapping for non power of two tile size(&quot;</span>&lt;&lt;image-&gt;s()&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;image-&gt;t()&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt;std::endl;
                    texture2D-&gt;setFilter( osg::Texture::MIN_FILTER, osg::Texture::LINEAR );
                }

                texture2D-&gt;setWrap(osg::Texture::WRAP_S,osg::Texture::CLAMP_TO_EDGE);
                texture2D-&gt;setWrap(osg::Texture::WRAP_T,osg::Texture::CLAMP_TO_EDGE);
                stateset-&gt;setTextureAttributeAndModes(0, texture2D, osg::StateAttribute::ON);           
        }
        <span class="comment">//    }</span>
        <span class="comment">//    else if (contourLayer)</span>
        <span class="comment">//    {</span>
        <span class="comment">//        osg::StateSet* stateset = geode-&gt;getOrCreateStateSet();</span>

        <span class="comment">//        osg::Texture1D* texture1D = new osg::Texture1D;</span>
        <span class="comment">//        texture1D-&gt;setImage(image);</span>
        <span class="comment">//        texture1D-&gt;setResizeNonPowerOfTwoHint(false);</span>
        <span class="comment">//        texture1D-&gt;setFilter(osg::Texture::MIN_FILTER, osg::Texture::NEAREST);</span>
        <span class="comment">//        texture1D-&gt;setFilter(osg::Texture::MAG_FILTER, colorLayer-&gt;getMagFilter());            </span>
        <span class="comment">//        stateset-&gt;setTextureAttributeAndModes(0, texture1D, osg::StateAttribute::ON);</span>
        <span class="comment">//    }</span>
        <span class="comment">//}</span>
    }

    <span class="comment">//geode-&gt;getOrCreateStateSet()-&gt;setMode(GL_DEPTH_TEST, osg::StateAttribute::OFF);</span>
    geode-&gt;getOrCreateStateSet()-&gt;setAttributeAndModes(<span class="keyword">new</span> osg::Depth(osg::Depth::LEQUAL), osg::StateAttribute::ON);

    <span class="keywordflow">return</span> geode;
}
</pre></div>
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_cgraph" id="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_cgraph">
<area shape="rect" id="node3" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="332,5,487,35"/><area shape="rect" id="node5" href="classCustomColorLayer.html#a761fdfb07388be6ac6438c2b96c7639d" title="CustomColorLayer::getImage" alt="" coords="313,59,505,88"/><area shape="rect" id="node7" href="classCustomColorLayer.html#ac9725adc85c194c7b4a4c99ed26d3d52" title="CustomColorLayer::getLocator" alt="" coords="309,112,509,141"/><area shape="rect" id="node9" href="classTerrain.html#afc533f56374093322731448e6a4b813e" title="Terrain::getSampleRatio" alt="" coords="328,165,491,195"/><area shape="rect" id="node11" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b" title="Tile::getTerrain" alt="" coords="355,219,464,248"/><area shape="rect" id="node13" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed" title="CustomColorLayer::getUID" alt="" coords="319,272,500,301"/><area shape="rect" id="node15" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4" title="Terrain::getVerticalScale" alt="" coords="327,325,492,355"/></map>
</div>
</p>

<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_icgraph" id="classMultiPassTerrainTechnique_a4cda8b087c77fb24528f69a2f2a11ac3_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#acf8ea7a0066ff18041032c2eb92a9831" title="MultiPassTerrainTechnique::generateGeometry" alt="" coords="311,5,604,35"/><area shape="rect" id="node5" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e" title="MultiPassTerrainTechnique::init" alt="" coords="653,5,859,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acf8ea7a0066ff18041032c2eb92a9831"></a><!-- doxytag: member="MultiPassTerrainTechnique::generateGeometry" ref="acf8ea7a0066ff18041032c2eb92a9831" args="(osgTerrain::Locator *masterLocator, const osg::Vec3d &amp;centerModel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::generateGeometry </td>
          <td>(</td>
          <td class="paramtype">osgTerrain::Locator *&#160;</td>
          <td class="paramname"><em>masterLocator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const osg::Vec3d &amp;&#160;</td>
          <td class="paramname"><em>centerModel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00816">816</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a> = <span class="keyword">new</span> osg::Group;
    <span class="keywordflow">if</span> (<a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>.valid())
    {
        <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;removeChildren( 0, <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;getNumChildren() );
        <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;addChild(<a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a>.get());
    }

    <span class="keyword">typedef</span> std::map&lt;int, osg::ref_ptr&lt;osg::Geode&gt; &gt; OrderedGeodes;
    OrderedGeodes order;

        osg::ref_ptr&lt;osg::Geometry&gt; prototype = <a class="code" href="classMultiPassTerrainTechnique.html#a6a51f84834e74021f90e6e0a88e2e3c7">createGeometryPrototype</a>( masterLocator, centerModel );

    <span class="comment">// take a thread-safe snapshot of the layer stack:</span>
    <a class="code" href="classTileFrame.html">TileFrame</a> tilef( <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a> );

    <span class="keywordflow">if</span> ( tilef._colorLayers.size() == 0 )
    {
        <span class="comment">// if there&#39;s no data, just make a placeholder pass</span>
                osg::Geode* geode = <a class="code" href="classMultiPassTerrainTechnique.html#a4cda8b087c77fb24528f69a2f2a11ac3">createPass</a>(0, 0L, masterLocator, centerModel, prototype.get());
                <a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a>-&gt;addChild( geode );
        }
    <span class="keywordflow">else</span>
    {
        <span class="keywordtype">int</span> defaultLayerOrder = 0;

        <span class="comment">// create a pass for each layer, and then add them in the proper order:</span>
        <span class="keywordflow">for</span>( ColorLayersByUID::const_iterator i = tilef._colorLayers.begin(); i != tilef._colorLayers.end(); ++i )
        {
            <span class="keyword">const</span> <a class="code" href="classCustomColorLayer.html">CustomColorLayer</a>&amp; layer = i-&gt;second;
            osg::Geometry* passGeom = <span class="keyword">new</span> osg::Geometry( *prototype.get() );
            <span class="keywordtype">int</span> index = <a class="code" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">_texCompositor</a>-&gt;getRenderOrder( layer.<a class="code" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed">getUID</a>() );
            <span class="keywordflow">if</span> ( index &lt; 0 ) <span class="comment">// true on first-time initialization</span>
                index = defaultLayerOrder++;
            osg::Geode* geode = <a class="code" href="classMultiPassTerrainTechnique.html#a4cda8b087c77fb24528f69a2f2a11ac3">createPass</a>( index, &amp;layer, masterLocator, centerModel, passGeom );
            order[index] = geode;

            <span class="comment">// record the UID in the geode for lookup later:</span>
            geode-&gt;setUserData( <span class="keyword">new</span> LayerData( layer.<a class="code" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed">getUID</a>() ) );
        }            

        <span class="keywordflow">for</span>( OrderedGeodes::const_iterator j = order.begin(); j != order.end(); ++j )
        {
            <a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a>-&gt;addChild( j-&gt;second.get() );
        }
    }

    osg::StateSet* stateset = <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;getOrCreateStateSet();
    stateset-&gt;setMode(GL_BLEND, osg::StateAttribute::ON);
    stateset-&gt;setRenderingHint(osg::StateSet::TRANSPARENT_BIN);
}
</pre></div>
<p><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_cgraph" id="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_cgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#a6a51f84834e74021f90e6e0a88e2e3c7" title="MultiPassTerrainTechnique::createGeometryPrototype" alt="" coords="351,112,687,141"/><area shape="rect" id="node13" href="classMultiPassTerrainTechnique.html#a4cda8b087c77fb24528f69a2f2a11ac3" title="MultiPassTerrainTechnique::createPass" alt="" coords="392,165,645,195"/><area shape="rect" id="node22" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed" title="CustomColorLayer::getUID" alt="" coords="745,325,927,355"/><area shape="rect" id="node5" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="759,165,913,195"/><area shape="rect" id="node7" href="classTerrain.html#afc533f56374093322731448e6a4b813e" title="Terrain::getSampleRatio" alt="" coords="755,5,917,35"/><area shape="rect" id="node9" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b" title="Tile::getTerrain" alt="" coords="781,59,891,88"/><area shape="rect" id="node11" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4" title="Terrain::getVerticalScale" alt="" coords="753,112,919,141"/><area shape="rect" id="node16" href="classCustomColorLayer.html#a761fdfb07388be6ac6438c2b96c7639d" title="CustomColorLayer::getImage" alt="" coords="740,272,932,301"/><area shape="rect" id="node18" href="classCustomColorLayer.html#ac9725adc85c194c7b4a4c99ed26d3d52" title="CustomColorLayer::getLocator" alt="" coords="736,219,936,248"/></map>
</div>
</p>

<p><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_icgraph" id="classMultiPassTerrainTechnique_acf8ea7a0066ff18041032c2eb92a9831_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#aa9b4f8a32c3e982c5f06d044d933ab1e" title="MultiPassTerrainTechnique::init" alt="" coords="349,5,555,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa9b4f8a32c3e982c5f06d044d933ab1e"></a><!-- doxytag: member="MultiPassTerrainTechnique::init" ref="aa9b4f8a32c3e982c5f06d044d933ab1e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="classTerrainTechnique.html#aea039a0faafda60832d0e948c78b8e29">TerrainTechnique</a>.</p>

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00098">98</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="HTTPClient_8cpp.html#ac6600c2662696d8b43a4deb6877c8591">OE_DEBUG</a>&lt;&lt;<span class="stringliteral">&quot;Doing MultiPassTerrainTechnique::init()&quot;</span>&lt;&lt;std::endl;
    
    <span class="keywordflow">if</span> (!<a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>) <span class="keywordflow">return</span>;
   
    osgTerrain::Locator* masterLocator = <a class="code" href="classMultiPassTerrainTechnique.html#a54f024654c8e5692b7cff298900c082e">computeMasterLocator</a>();
    
    osg::Vec3d centerModel = <a class="code" href="classMultiPassTerrainTechnique.html#ab072653160a22e1639eab3868754e2a1">computeCenterModel</a>(masterLocator);
    
    <a class="code" href="classMultiPassTerrainTechnique.html#acf8ea7a0066ff18041032c2eb92a9831">generateGeometry</a>(masterLocator, centerModel);   

    <span class="keywordflow">if</span> (<a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>.valid()) <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;setThreadSafeReferenceCounting(<span class="keyword">true</span>);
}
</pre></div>
<p><div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_aa9b4f8a32c3e982c5f06d044d933ab1e_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_aa9b4f8a32c3e982c5f06d044d933ab1e_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_aa9b4f8a32c3e982c5f06d044d933ab1e_cgraph" id="classMultiPassTerrainTechnique_aa9b4f8a32c3e982c5f06d044d933ab1e_cgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#ab072653160a22e1639eab3868754e2a1" title="MultiPassTerrainTechnique::computeCenterModel" alt="" coords="643,5,955,35"/><area shape="rect" id="node7" href="classMultiPassTerrainTechnique.html#a54f024654c8e5692b7cff298900c082e" title="MultiPassTerrainTechnique::computeMasterLocator" alt="" coords="260,57,580,87"/><area shape="rect" id="node10" href="classMultiPassTerrainTechnique.html#acf8ea7a0066ff18041032c2eb92a9831" title="MultiPassTerrainTechnique::generateGeometry" alt="" coords="273,139,567,168"/><area shape="rect" id="node5" href="classTile.html#a36219d91d8b17471099bcc5c4bc1b2ed" title="Tile::getElevationLayer" alt="" coords="1039,5,1193,35"/><area shape="rect" id="node12" href="classMultiPassTerrainTechnique.html#a6a51f84834e74021f90e6e0a88e2e3c7" title="MultiPassTerrainTechnique::createGeometryPrototype" alt="" coords="631,112,967,141"/><area shape="rect" id="node21" href="classMultiPassTerrainTechnique.html#a4cda8b087c77fb24528f69a2f2a11ac3" title="MultiPassTerrainTechnique::createPass" alt="" coords="672,165,925,195"/><area shape="rect" id="node30" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed" title="CustomColorLayer::getUID" alt="" coords="1025,325,1207,355"/><area shape="rect" id="node15" href="classTerrain.html#afc533f56374093322731448e6a4b813e" title="Terrain::getSampleRatio" alt="" coords="1035,59,1197,88"/><area shape="rect" id="node17" href="classTile.html#a7c0c83673975b5474d61a9845a0cd02b" title="Tile::getTerrain" alt="" coords="1061,112,1171,141"/><area shape="rect" id="node19" href="classTerrain.html#a9137bf26a5edaf11515e74aa58a6caf4" title="Terrain::getVerticalScale" alt="" coords="1033,165,1199,195"/><area shape="rect" id="node24" href="classCustomColorLayer.html#a761fdfb07388be6ac6438c2b96c7639d" title="CustomColorLayer::getImage" alt="" coords="1020,219,1212,248"/><area shape="rect" id="node26" href="classCustomColorLayer.html#ac9725adc85c194c7b4a4c99ed26d3d52" title="CustomColorLayer::getLocator" alt="" coords="1016,272,1216,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6d19c0ebf8fd483b1a0b1e0c6be367a3"></a><!-- doxytag: member="MultiPassTerrainTechnique::META_Object" ref="a6d19c0ebf8fd483b1a0b1e0c6be367a3" args="(osgEarth, MultiPassTerrainTechnique)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MultiPassTerrainTechnique::META_Object </td>
          <td>(</td>
          <td class="paramtype">osgEarth&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultiPassTerrainTechnique.html">MultiPassTerrainTechnique</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5c694f7e2aa6aa202b11a557bebef00c"></a><!-- doxytag: member="MultiPassTerrainTechnique::releaseGLObjects" ref="a5c694f7e2aa6aa202b11a557bebef00c" args="(osg::State *=0) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::releaseGLObjects </td>
          <td>(</td>
          <td class="paramtype">osg::State *&#160;</td>
          <td class="paramname"><em>state</em> = <code>0</code></td><td>)</td>
          <td> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If State is non-zero, this function releases any associated OpenGL objects for the specified graphics context. Otherwise, releases OpenGL objects for all graphics contexts. </p>

<p>Implements <a class="el" href="classTerrainTechnique.html#a70a7b972d036ee518bcbb6bb83047b26">TerrainTechnique</a>.</p>

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00936">936</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>.valid()) <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;releaseGLObjects( state );
}
</pre></div>
</div>
</div>
<a class="anchor" id="a38d481dd4dc82bf06ebd422983e87536"></a><!-- doxytag: member="MultiPassTerrainTechnique::traverse" ref="a38d481dd4dc82bf06ebd422983e87536" args="(osg::NodeVisitor &amp;nv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::traverse </td>
          <td>(</td>
          <td class="paramtype">osg::NodeVisitor &amp;&#160;</td>
          <td class="paramname"><em>nv</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Traverse the terain subgraph. </p>

<p>Implements <a class="el" href="classTerrainTechnique.html#a5735bb67b4765a485a1fb91de99de291">TerrainTechnique</a>.</p>

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00869">869</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (!<a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>) <span class="keywordflow">return</span>;

    <span class="comment">// initialize the terrain tile on startup</span>
    <span class="keywordflow">if</span> (<a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a46ee4a138b655f7b39d8de786a4eb080">getDirty</a>() &amp;&amp; !<a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a>) 
    {
        <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#a96ce55d5fcb4b12880531af2138ba6b2">init</a>();
        <a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a> = <span class="keyword">true</span>;

<span class="preprocessor">#if 0</span>
<span class="preprocessor"></span><span class="preprocessor">#if OSG_MIN_VERSION_REQUIRED(2,9,8)</span>
<span class="preprocessor"></span>        _terrainTile-&gt;init(~0x0, <span class="keyword">true</span>);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>        _terrainTile-&gt;init();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
        <a class="code" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">_terrainTileInitialized</a> = <span class="keyword">true</span>;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    }
    
    <span class="keywordflow">if</span> ( nv.getVisitorType() == osg::NodeVisitor::CULL_VISITOR )
    {
        <a class="code" href="classMultiPassTerrainTechnique.html#aa4691e3140cd2e2575a52c704f17f00b">updateTransparency</a>();
    }

    <span class="comment">// traverse the dynamically-generated geometry.</span>
    <span class="keywordflow">if</span> (<a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>.valid()) 
        <a class="code" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">_transform</a>-&gt;accept(nv);
}
</pre></div>
<p><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_a38d481dd4dc82bf06ebd422983e87536_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_a38d481dd4dc82bf06ebd422983e87536_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_a38d481dd4dc82bf06ebd422983e87536_cgraph" id="classMultiPassTerrainTechnique_a38d481dd4dc82bf06ebd422983e87536_cgraph">
<area shape="rect" id="node3" href="classTile.html#a46ee4a138b655f7b39d8de786a4eb080" title="Tile::getDirty" alt="" coords="393,32,489,61"/><area shape="rect" id="node5" href="classTile.html#a96ce55d5fcb4b12880531af2138ba6b2" title="Tile::init" alt="" coords="408,85,475,115"/><area shape="rect" id="node7" href="classMultiPassTerrainTechnique.html#aa4691e3140cd2e2575a52c704f17f00b" title="MultiPassTerrainTechnique::updateTransparency" alt="" coords="288,139,595,168"/><area shape="rect" id="node9" href="classTile.html#af8d69f8867f4fa143bf52ea4dbbd86b6" title="Tile::getCustomColorLayers" alt="" coords="791,5,975,35"/><area shape="rect" id="node11" href="classosgEarth_1_1TerrainLayer.html#a02f9aaac89492153b97433acddaaf915" title="osgEarth::TerrainLayer::getEnabled" alt="" coords="769,59,996,88"/><area shape="rect" id="node13" href="classCustomColorLayer.html#ad12227786b31ff5da2efd655bdcbba84" title="CustomColorLayer::getMapLayer" alt="" coords="776,112,989,141"/><area shape="rect" id="node15" href="classosgEarth_1_1ImageLayer.html#a66a16b3bc57ebeeff19acab52f4eae30" title="osgEarth::ImageLayer::getOpacity" alt="" coords="772,165,993,195"/><area shape="rect" id="node17" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed" title="CustomColorLayer::getUID" alt="" coords="792,219,973,248"/><area shape="rect" id="node19" href="namespaceanonymous__namespace_02MultiPassTerrainTechnique_8cpp_03.html#afad9f70bd9360ca82d332b39107a6454" title="anonymous_namespace\{MultiPassTerrainTechnique::cpp\}::s_findGeodeByUID" alt="" coords="644,272,1121,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7925e25c36484bbd58a87eba222388dc"></a><!-- doxytag: member="MultiPassTerrainTechnique::updateGeometry" ref="a7925e25c36484bbd58a87eba222388dc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::updateGeometry </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa4691e3140cd2e2575a52c704f17f00b"></a><!-- doxytag: member="MultiPassTerrainTechnique::updateTransparency" ref="aa4691e3140cd2e2575a52c704f17f00b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MultiPassTerrainTechnique::updateTransparency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html#l00900">900</a> of file <a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{       
    <span class="keywordflow">if</span> ( <a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a>.valid() )
    {
        <a class="code" href="CustomTile.html#a69e705aa9d311b81c5de241954028a6b">ColorLayersByUID</a> colorLayers;
        <a class="code" href="classTerrainTechnique.html#acfc47d91458541b74f3b60a7eede69a3">_tile</a>-&gt;<a class="code" href="classTile.html#af8d69f8867f4fa143bf52ea4dbbd86b6">getCustomColorLayers</a>( colorLayers );

        <span class="keywordflow">for</span>( ColorLayersByUID::const_iterator i = colorLayers.begin(); i != colorLayers.end(); ++i )
        {
            <span class="keyword">const</span> <a class="code" href="classCustomColorLayer.html">CustomColorLayer</a>&amp; colorLayer = i-&gt;second;

            <span class="keywordtype">float</span> opacity = colorLayer.<a class="code" href="classCustomColorLayer.html#ad12227786b31ff5da2efd655bdcbba84">getMapLayer</a>()-&gt;<a class="code" href="classosgEarth_1_1ImageLayer.html#a66a16b3bc57ebeeff19acab52f4eae30">getOpacity</a>();
            osg::Geode* geode = <a class="code" href="namespaceanonymous__namespace_02MultiPassTerrainTechnique_8cpp_03.html#afad9f70bd9360ca82d332b39107a6454">s_findGeodeByUID</a>( <a class="code" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">_passes</a>.get(), colorLayer.<a class="code" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed">getUID</a>() );
                        <span class="keywordflow">if</span> (geode)
                        {
                                osg::Geometry* geometry = geode-&gt;getDrawable(0)-&gt;asGeometry();
                                osg::Vec4Array* <a class="code" href="osgearth__tilesource_8cpp.html#a9e71186980a23d60f4d42454c5b968f3">colors</a> = <span class="keyword">static_cast&lt;</span>osg::Vec4Array*<span class="keyword">&gt;</span>(geometry-&gt;getColorArray());
                <span class="keywordflow">if</span> ( (*colors)[0].a() != opacity )
                {
                                    (*colors)[0] = osg::Vec4(1.0f, 1.0f, 1.0f, opacity);
                    colors-&gt;dirty();
                }

                                <span class="keywordflow">if</span> (colorLayer.<a class="code" href="classCustomColorLayer.html#ad12227786b31ff5da2efd655bdcbba84">getMapLayer</a>()-&gt;<a class="code" href="classosgEarth_1_1TerrainLayer.html#a02f9aaac89492153b97433acddaaf915">getEnabled</a>())
                                {
                                        geode-&gt;setNodeMask(0xffffffff);
                                }
                                <span class="keywordflow">else</span>
                                {
                                        geode-&gt;setNodeMask(0x0);
                                }
                        }
                }
        }
}
</pre></div>
<p><div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_cgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_cgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_cgraph" id="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_cgraph">
<area shape="rect" id="node3" href="classTile.html#af8d69f8867f4fa143bf52ea4dbbd86b6" title="Tile::getCustomColorLayers" alt="" coords="508,5,692,35"/><area shape="rect" id="node5" href="classosgEarth_1_1TerrainLayer.html#a02f9aaac89492153b97433acddaaf915" title="osgEarth::TerrainLayer::getEnabled" alt="" coords="487,59,713,88"/><area shape="rect" id="node7" href="classCustomColorLayer.html#ad12227786b31ff5da2efd655bdcbba84" title="CustomColorLayer::getMapLayer" alt="" coords="493,112,707,141"/><area shape="rect" id="node9" href="classosgEarth_1_1ImageLayer.html#a66a16b3bc57ebeeff19acab52f4eae30" title="osgEarth::ImageLayer::getOpacity" alt="" coords="489,165,711,195"/><area shape="rect" id="node11" href="classCustomColorLayer.html#af539b1957865fd51e5eb75ef7bd497ed" title="CustomColorLayer::getUID" alt="" coords="509,219,691,248"/><area shape="rect" id="node13" href="namespaceanonymous__namespace_02MultiPassTerrainTechnique_8cpp_03.html#afad9f70bd9360ca82d332b39107a6454" title="anonymous_namespace\{MultiPassTerrainTechnique::cpp\}::s_findGeodeByUID" alt="" coords="361,272,839,301"/></map>
</div>
</p>

<p><div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_icgraph.png" border="0" usemap="#classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_icgraph" alt=""/></div>
<map name="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_icgraph" id="classMultiPassTerrainTechnique_aa4691e3140cd2e2575a52c704f17f00b_icgraph">
<area shape="rect" id="node3" href="classMultiPassTerrainTechnique.html#a38d481dd4dc82bf06ebd422983e87536" title="MultiPassTerrainTechnique::traverse" alt="" coords="360,5,595,35"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aad85e790a0688050aa41bbfed9e5882d"></a><!-- doxytag: member="MultiPassTerrainTechnique::_passes" ref="aad85e790a0688050aa41bbfed9e5882d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::ref_ptr&lt;osg::Group&gt; <a class="el" href="classMultiPassTerrainTechnique.html#aad85e790a0688050aa41bbfed9e5882d">MultiPassTerrainTechnique::_passes</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_source.html#l00076">76</a> of file <a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a>.</p>

</div>
</div>
<a class="anchor" id="ab4c2b05bb1c51f9f4bdb6dfa04fb6c92"></a><!-- doxytag: member="MultiPassTerrainTechnique::_terrainTileInitialized" ref="ab4c2b05bb1c51f9f4bdb6dfa04fb6c92" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classMultiPassTerrainTechnique.html#ab4c2b05bb1c51f9f4bdb6dfa04fb6c92">MultiPassTerrainTechnique::_terrainTileInitialized</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_source.html#l00077">77</a> of file <a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a>.</p>

</div>
</div>
<a class="anchor" id="a3447fc0d459c93594bf9e7c31542eb14"></a><!-- doxytag: member="MultiPassTerrainTechnique::_texCompositor" ref="a3447fc0d459c93594bf9e7c31542eb14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::ref_ptr&lt;<a class="el" href="classosgEarth_1_1TextureCompositor.html">TextureCompositor</a>&gt; <a class="el" href="classMultiPassTerrainTechnique.html#a3447fc0d459c93594bf9e7c31542eb14">MultiPassTerrainTechnique::_texCompositor</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_source.html#l00078">78</a> of file <a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a>.</p>

</div>
</div>
<a class="anchor" id="a0f0f4f7a6212eef3303ff1ddbd2dc875"></a><!-- doxytag: member="MultiPassTerrainTechnique::_transform" ref="a0f0f4f7a6212eef3303ff1ddbd2dc875" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">osg::ref_ptr&lt;osg::MatrixTransform&gt; <a class="el" href="classMultiPassTerrainTechnique.html#a0f0f4f7a6212eef3303ff1ddbd2dc875">MultiPassTerrainTechnique::_transform</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="MultiPassTerrainTechnique_source.html#l00075">75</a> of file <a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/cube/sources/osgearth/src/osgEarthDrivers/engine_osgterrain/<a class="el" href="MultiPassTerrainTechnique_source.html">MultiPassTerrainTechnique</a></li>
<li>/home/cube/sources/osgearth/src/osgEarthDrivers/engine_osgterrain/<a class="el" href="MultiPassTerrainTechnique_8cpp_source.html">MultiPassTerrainTechnique.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jan 18 2012 15:02:45 for osgEarth by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
